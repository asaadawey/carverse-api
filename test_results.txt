
> carwash-api@1.0.0 test
> dotenv -e .env_test -- jest --verbose

  console.log
    ERROR-BUILDER [GET]  422, Bad request

      at errorMiddleware (src/middleware/error.middleware.ts:70:13)

  console.log
    {
      body: '{}',
      headers: {},
      req_id: undefined,
      additionalData: 'I am additional',
      originalError: 'Bad request'
    }

      at errorMiddleware (src/middleware/error.middleware.ts:71:13)

PASS src/middleware/error.middleware.spec.ts (9.582 s)
  error.middleware
    √ Should success and call res.json (47 ms)

FAIL src/config/environment.spec.ts (9.629 s)
  config/environment.ts
    × Should success if all process env values are present (34 ms)
    √ Should fail because not all env values are present (2 ms)

  ● config/environment.ts › Should success if all process env values are present

    expect(received).not.toThrowError()

    Error name:    "ValidationError"
    Error message: "FIREBASE_PRIVATE_KEY is a required field"

        [0m [90m 14 |[39m     })[33m;[39m
         [90m 15 |[39m     [36mconst[39m func [33m=[39m () [33m=>[39m {
        [31m[1m>[22m[39m[90m 16 |[39m       schema[33m.[39mvalidateSync(env)[33m;[39m
         [90m    |[39m              [31m[1m^[22m[39m
         [90m 17 |[39m     }[33m;[39m
         [90m 18 |[39m
         [90m 19 |[39m     expect(func)[33m.[39mnot[33m.[39mtoThrowError()[33m;[39m[0m

      at createError (node_modules/yup/lib/util/createValidation.js:54:21)
      at validate (node_modules/yup/lib/util/createValidation.js:96:83)
      at runTests (node_modules/yup/lib/util/runTests.js:39:5)
      at node_modules/yup/lib/schema.js:255:29
      at node_modules/yup/lib/util/runTests.js:17:5
      at finishTestRun (node_modules/yup/lib/util/runTests.js:67:9)
      at validate (node_modules/yup/lib/util/createValidation.js:96:103)
      at runTests (node_modules/yup/lib/util/runTests.js:39:5)
      at StringSchema._validate (node_modules/yup/lib/schema.js:246:27)
      at StringSchema.validate (node_modules/yup/lib/schema.js:271:51)
      at node_modules/yup/lib/object.js:182:17
      at runTests (node_modules/yup/lib/util/runTests.js:39:5)
      at node_modules/yup/lib/object.js:199:29
      at node_modules/yup/lib/util/runTests.js:17:5
      at finishTestRun (node_modules/yup/lib/util/runTests.js:67:9)
      at validate (node_modules/yup/lib/util/createValidation.js:96:103)
      at runTests (node_modules/yup/lib/util/runTests.js:39:5)
      at node_modules/yup/lib/schema.js:255:29
      at node_modules/yup/lib/util/runTests.js:17:5
      at finishTestRun (node_modules/yup/lib/util/runTests.js:67:9)
      at validate (node_modules/yup/lib/util/createValidation.js:96:103)
      at runTests (node_modules/yup/lib/util/runTests.js:39:5)
      at ObjectSchema._validate (node_modules/yup/lib/schema.js:246:27)
      at ObjectSchema._validate (node_modules/yup/lib/object.js:161:11)
      at ObjectSchema.validateSync (node_modules/yup/lib/schema.js:282:12)
      at func (src/config/environment.spec.ts:16:14)
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrowError] (node_modules/expect/build/index.js:320:21)
      at Object.<anonymous> (src/config/environment.spec.ts:19:22)
      at Object.<anonymous> (src/config/environment.spec.ts:19:22)

FAIL src/controllers/orders/confirmOrder.controller.spec.ts (9.795 s)
  users/confirmOrder
    × Should return addresses (8 ms)

  ● users/confirmOrder › Should return addresses

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

    [0m [90m  8 |[39m     [36mawait[39m confirmOrder(global[33m.[39mmockReq[33m,[39m global[33m.[39mmockRes[33m,[39m global[33m.[39mmockNext)[33m;[39m
     [90m  9 |[39m
    [31m[1m>[22m[39m[90m 10 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledTimes([35m1[39m)[33m;[39m
     [90m    |[39m                                   [31m[1m^[22m[39m
     [90m 11 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledWith(
     [90m 12 |[39m       global[33m.[39mmockReq[33m,[39m
     [90m 13 |[39m       global[33m.[39mmockRes[33m,[39m[0m

      at Object.<anonymous> (src/controllers/orders/confirmOrder.controller.spec.ts:10:35)

PASS src/controllers/providers/upsertProviderService.controller.spec.ts (9.812 s)
  providers/upsertProviderServices
    √ Should succeed without delete (8 ms)
    √ Should succeed with delete (2 ms)

PASS src/controllers/services/addService.controller.spec.ts (9.882 s)
  services/addService
    √ Should succeed and return all modules (7 ms)

FAIL src/controllers/services/getAllServices.controller.spec.ts (9.861 s)
  services/getAllServices
    × Should succeed and return all modules (11 ms)

  ● services/getAllServices › Should succeed and return all modules

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

    [0m [90m 12 |[39m     [36mawait[39m getAllServices(global[33m.[39mmockReq[33m,[39m global[33m.[39mmockRes[33m,[39m global[33m.[39mmockNext)[33m;[39m
     [90m 13 |[39m
    [31m[1m>[22m[39m[90m 14 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledTimes([35m1[39m)[33m;[39m
     [90m    |[39m                                   [31m[1m^[22m[39m
     [90m 15 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledWith(
     [90m 16 |[39m       global[33m.[39mmockReq[33m,[39m
     [90m 17 |[39m       global[33m.[39mmockRes[33m,[39m[0m

      at Object.<anonymous> (src/controllers/services/getAllServices.controller.spec.ts:14:35)

PASS src/controllers/providers/getAllProviders.controller.spec.ts (9.864 s)
  providers/getAllProviders
    √ Should success and return all providers with no avg (9 ms)

PASS src/controllers/modules/getAllModules.controller.spec.ts
  modules/getAllModules
    √ Should succeed and return all modules (2 ms)

PASS src/controllers/cars/getAllCars.controller.spec.ts (9.926 s)
  cars/getAllCars
    √ Should success and return all cars (10 ms)

PASS src/utils/encrypt.spec.ts (9.932 s)
  encrypt.ts
    √ It should decrypt and decrypt (10 ms)

PASS src/controllers/users/checkUserExist.controller.spec.ts (9.949 s)
  users/checkUserExist
    √ Should return user not exist (11 ms)
    √ Should return user  exist (3 ms)

PASS src/controllers/users/addDeleteRequest.controller.spec.ts
  users/addDeleteRequest
    √ Should success and add delete request for normal user (1 ms)
    √ Should success and add delete request for admin user user (6 ms)
    √ Should fail if body passed with wrong user (3 ms)

PASS src/controllers/cars/addCar.controller.spec.ts
  cars/addCar
    √ Should succeed (2 ms)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"supportId":"cm1a2b3c4d5e6f7g8h9i0j","userId":12345,"contactUserByRegisteredMobile":true,"sendEmail":false,"level":"info","message":"Support request created"}

    [0m [90m 121 |[39m     }
     [90m 122 |[39m
    [31m[1m>[22m[39m[90m 123 |[39m     logger[33m.[39minfo([32m'Support request created'[39m[33m,[39m {
     [90m     |[39m            [31m[1m^[22m[39m
     [90m 124 |[39m       supportId[33m:[39m supportRequest[33m.[39mid[33m,[39m
     [90m 125 |[39m       userId[33m,[39m
     [90m 126 |[39m       relatedOrderId[33m,[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as info] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at createSupportRequest (src/controllers/support/createSupportRequest.controller.ts:123:12)
      at Object.<anonymous> (src/controllers/support/createSupportRequest.controller.spec.ts:49:5)

PASS src/controllers/cars/getAllBodyTypes.controller.spec.ts
  cars/getAllBodyTypes
    √ Should return body types (1 ms)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"supportId":"cm1a2b3c4d5e6f7g8h9i0j","userEmail":"test@example.com","userId":12345,"level":"info","message":"Support request confirmation email sent"}

    [0m [90m 103 |[39m
     [90m 104 |[39m         [36mif[39m (emailSent) {
    [31m[1m>[22m[39m[90m 105 |[39m           logger[33m.[39minfo([32m'Support request confirmation email sent'[39m[33m,[39m {
     [90m     |[39m                  [31m[1m^[22m[39m
     [90m 106 |[39m             supportId[33m:[39m supportRequest[33m.[39mid[33m,[39m
     [90m 107 |[39m             userEmail[33m:[39m user[33m.[39m[33mEmail[39m[33m,[39m
     [90m 108 |[39m             userId[33m,[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as info] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at createSupportRequest (src/controllers/support/createSupportRequest.controller.ts:105:18)
      at Object.<anonymous> (src/controllers/support/createSupportRequest.controller.spec.ts:112:5)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"supportId":"cm1a2b3c4d5e6f7g8h9i0j","userId":12345,"contactUserByRegisteredMobile":false,"sendEmail":true,"level":"info","message":"Support request created"}

    [0m [90m 121 |[39m     }
     [90m 122 |[39m
    [31m[1m>[22m[39m[90m 123 |[39m     logger[33m.[39minfo([32m'Support request created'[39m[33m,[39m {
     [90m     |[39m            [31m[1m^[22m[39m
     [90m 124 |[39m       supportId[33m:[39m supportRequest[33m.[39mid[33m,[39m
     [90m 125 |[39m       userId[33m,[39m
     [90m 126 |[39m       relatedOrderId[33m,[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as info] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at createSupportRequest (src/controllers/support/createSupportRequest.controller.ts:123:12)
      at Object.<anonymous> (src/controllers/support/createSupportRequest.controller.spec.ts:112:5)

PASS src/controllers/users/getPreviousAddresses.controller.spec.ts
  users/getPreviousAddresses
    √ Should return addresses (1 ms)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"supportId":"cm1a2b3c4d5e6f7g8h9i0j","userId":12345,"relatedOrderId":999,"contactUserByRegisteredMobile":true,"sendEmail":false,"level":"info","message":"Support request created"}

    [0m [90m 121 |[39m     }
     [90m 122 |[39m
    [31m[1m>[22m[39m[90m 123 |[39m     logger[33m.[39minfo([32m'Support request created'[39m[33m,[39m {
     [90m     |[39m            [31m[1m^[22m[39m
     [90m 124 |[39m       supportId[33m:[39m supportRequest[33m.[39mid[33m,[39m
     [90m 125 |[39m       userId[33m,[39m
     [90m 126 |[39m       relatedOrderId[33m,[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as info] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at createSupportRequest (src/controllers/support/createSupportRequest.controller.ts:123:12)
      at Object.<anonymous> (src/controllers/support/createSupportRequest.controller.spec.ts:178:5)

PASS src/controllers/users/processDeleteRequest.controller.spec.ts
  users/addDeleteRequest
    √ Should success and add delete request for normal user (2 ms)
    √ Should success and add delete request for admin user user (2 ms)
    √ Should fail if body passed with wrong user (4 ms)

  console.log
    User Type: { userType: 'Customer' }

      at getUserType (src/middleware/allowedUserType.middleware.ts:7:11)
          at Array.some (<anonymous>)

  console.log
    User Type: { userType: 'Admin' }

      at getUserType (src/middleware/allowedUserType.middleware.ts:7:11)
          at Array.some (<anonymous>)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"supportId":"cm1a2b3c4d5e6f7g8h9i0j","userId":12345,"contactUserByRegisteredMobile":false,"sendEmail":true,"level":"info","message":"Support request created"}

    [0m [90m 121 |[39m     }
     [90m 122 |[39m
    [31m[1m>[22m[39m[90m 123 |[39m     logger[33m.[39minfo([32m'Support request created'[39m[33m,[39m {
     [90m     |[39m            [31m[1m^[22m[39m
     [90m 124 |[39m       supportId[33m:[39m supportRequest[33m.[39mid[33m,[39m
     [90m 125 |[39m       userId[33m,[39m
     [90m 126 |[39m       relatedOrderId[33m,[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as info] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at createSupportRequest (src/controllers/support/createSupportRequest.controller.ts:123:12)
      at Object.<anonymous> (src/controllers/support/createSupportRequest.controller.spec.ts:305:5)

PASS src/controllers/constants/getAllConstants.controller.spec.ts
  constants/getAllConstants
    √ Should succeed and return all constants (3 ms)

PASS src/middleware/allowedUserType.middleware.spec.ts (10.054 s)
  allowedClient.middlware
    √ Should success becuase allowed user type is right (44 ms)
    √ Should fail since user type is not right (2 ms)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"supportId":"cm1a2b3c4d5e6f7g8h9i0j","userEmail":"test@example.com","userId":12345,"error":{},"level":"error","message":"Failed to send support request email"}

    [0m [90m 110 |[39m         }
     [90m 111 |[39m       } [36mcatch[39m (emailError) {
    [31m[1m>[22m[39m[90m 112 |[39m         logger[33m.[39merror([32m'Failed to send support request email'[39m[33m,[39m {
     [90m     |[39m                [31m[1m^[22m[39m
     [90m 113 |[39m           supportId[33m:[39m supportRequest[33m.[39mid[33m,[39m
     [90m 114 |[39m           userEmail[33m:[39m user[33m.[39m[33mEmail[39m[33m,[39m
     [90m 115 |[39m           userId[33m,[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as error] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at createSupportRequest (src/controllers/support/createSupportRequest.controller.ts:112:16)
      at Object.<anonymous> (src/controllers/support/createSupportRequest.controller.spec.ts:349:5)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"supportId":"cm1a2b3c4d5e6f7g8h9i0j","userId":12345,"contactUserByRegisteredMobile":false,"sendEmail":true,"level":"info","message":"Support request created"}

    [0m [90m 121 |[39m     }
     [90m 122 |[39m
    [31m[1m>[22m[39m[90m 123 |[39m     logger[33m.[39minfo([32m'Support request created'[39m[33m,[39m {
     [90m     |[39m            [31m[1m^[22m[39m
     [90m 124 |[39m       supportId[33m:[39m supportRequest[33m.[39mid[33m,[39m
     [90m 125 |[39m       userId[33m,[39m
     [90m 126 |[39m       relatedOrderId[33m,[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as info] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at createSupportRequest (src/controllers/support/createSupportRequest.controller.ts:123:12)
      at Object.<anonymous> (src/controllers/support/createSupportRequest.controller.spec.ts:349:5)

PASS src/controllers/support/createSupportRequest.controller.spec.ts (10.062 s)
  support/createSupportRequest
    √ Should successfully create support request without email (52 ms)
    √ Should successfully create support request with email notification (11 ms)
    √ Should successfully create support request with related order (7 ms)
    √ Should fail when user is not authenticated (4 ms)
    √ Should fail when user is not found (4 ms)
    √ Should fail when related order does not exist or does not belong to user (5 ms)
    √ Should handle email service failure gracefully (12 ms)
    √ Should handle email service exception gracefully (8 ms)

PASS src/controllers/packages/getAllPackages.controller.spec.ts
  packages/getAllPackages
    √ Should succeed and return all packages (1 ms)
    √ Should succeed and empty packages (6 ms)

PASS src/controllers/attachments/getAllAttachmentTypes.controller.spec.ts
  attachment/getAllAttachmentTypes
    √ Should success (2 ms)

FAIL src/tests/web-socket/socketConnection.spec.ts
  ● Test suite failed to run

    Your test suite must contain at least one test.

      at onResult (node_modules/@jest/core/build/TestScheduler.js:133:18)
      at node_modules/@jest/core/build/TestScheduler.js:254:19
      at node_modules/emittery/index.js:363:13
          at Array.map (<anonymous>)
      at Emittery.emit (node_modules/emittery/index.js:361:23)

FAIL src/tests/web-socket/orderChat.spec.ts
  ● Test suite failed to run

    Your test suite must contain at least one test.

      at onResult (node_modules/@jest/core/build/TestScheduler.js:133:18)
      at node_modules/@jest/core/build/TestScheduler.js:254:19
      at node_modules/emittery/index.js:363:13
          at Array.map (<anonymous>)
      at Emittery.emit (node_modules/emittery/index.js:361:23)

PASS src/utils/schema.spec.ts
  schema.ts
    √ Should not accept any additional parameters (4 ms)
    √ Should success (1 ms)

PASS src/services/emailService.support.spec.ts
  emailService - Multiple Email Configurations
    √ Should have separate OTP and support email configurations (1 ms)
    √ Should return status for both email services (1 ms)
    √ Should validate environment variables are properly structured (1 ms)

PASS src/utils/amountUtils.spec.ts
  amountUtils.ts
    √ should return amount (1 ms)
    √ should return percentage (1 ms)

PASS src/controllers/cars/checkCarExist.controller.spec.ts
  cars/checkCarExist
    √ Should return car not exist (1 ms)
    √ Should return car exist (1 ms)

FAIL src/tests/web-socket/chatBasic.spec.ts
  ● Test suite failed to run

    Your test suite must contain at least one test.

      at onResult (node_modules/@jest/core/build/TestScheduler.js:133:18)
      at node_modules/@jest/core/build/TestScheduler.js:254:19
      at node_modules/emittery/index.js:363:13
          at Array.map (<anonymous>)
      at Emittery.emit (node_modules/emittery/index.js:361:23)

PASS src/controllers/constants/modifyConstant.controller.spec.ts
  constants/modifyConstant
    √ Should success and modify constant (1 ms)

PASS src/controllers/attachments/getListOfAttachments.controller.spec.ts
  attachments/getListOfAttachments
    √ Should success (1 ms)

FAIL src/controllers/users/verifyEmailOtp.controller.spec.ts
  ● Test suite failed to run

    Your test suite must contain at least one test.

      at onResult (node_modules/@jest/core/build/TestScheduler.js:133:18)
      at node_modules/@jest/core/build/TestScheduler.js:254:19
      at node_modules/emittery/index.js:363:13
          at Array.map (<anonymous>)
      at Emittery.emit (node_modules/emittery/index.js:361:23)

FAIL src/controllers/orders/getProviderRevenue.controller.spec.ts
  ● Test suite failed to run

    Your test suite must contain at least one test.

      at onResult (node_modules/@jest/core/build/TestScheduler.js:133:18)
      at node_modules/@jest/core/build/TestScheduler.js:254:19
      at node_modules/emittery/index.js:363:13
          at Array.map (<anonymous>)
      at Emittery.emit (node_modules/emittery/index.js:361:23)

FAIL src/controllers/users/sendEmailOtp.controller.spec.ts
  ● Test suite failed to run

    Your test suite must contain at least one test.

      at onResult (node_modules/@jest/core/build/TestScheduler.js:133:18)
      at node_modules/@jest/core/build/TestScheduler.js:254:19
      at node_modules/emittery/index.js:363:13
          at Array.map (<anonymous>)
      at Emittery.emit (node_modules/emittery/index.js:361:23)

FAIL src/controllers/orders/getOrderTotalAmountStatements.controller.spec.ts (10.251 s)
  orders/getOrderTotalAmount
    × Should success and return the order (12 ms)

  ● orders/getOrderTotalAmount › Should success and return the order

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

    [0m [90m 42 |[39m     [36mawait[39m getOrderTotalAmountStatements(global[33m.[39mmockReq[33m,[39m global[33m.[39mmockRes[33m,[39m global[33m.[39mmockNext)[33m;[39m
     [90m 43 |[39m
    [31m[1m>[22m[39m[90m 44 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledTimes([35m1[39m)[33m;[39m
     [90m    |[39m                                   [31m[1m^[22m[39m
     [90m 45 |[39m
     [90m 46 |[39m     [90m//@ts-ignore[39m
     [90m 47 |[39m     [36mconst[39m returnResult [33m=[39m createSuccessResponse[33m.[39mmock[33m.[39mcalls[[35m0[39m][[35m2[39m][33m;[39m[0m

      at Object.<anonymous> (src/controllers/orders/getOrderTotalAmountStatements.controller.spec.ts:44:35)

PASS src/middleware/apiAuth.middleware.spec.ts
  apiAuth.middleware
    √ Should fail becuase no auth key is passed
    √ Should fail becuase auth key is passed but its incorrect (1 ms)
    √ Should succeed

PASS src/controllers/users/getUserDetails.controller.spec.ts (10.166 s)
  users/getUserDetails
    √ Should success and return user details (6 ms)
    √ Should fail if body passed with wrong user (1 ms)

PASS src/controllers/providers/getOneProvider.controller.spec.ts (10.181 s)
  provider/getOneProvider
    √ Should success and return the order (8 ms)
    √ Should fail because no order (1 ms)

PASS src/middleware/mobileCookieInjector.middleware.spec.ts (10.227 s)
  mobileCookietInjector.middleware
    √ Should success and parse cookies from headers (10 ms)
    √ Should success and shouldnt parse cookies from headers (1 ms)

PASS src/middleware/allowedClient.middleware.spec.ts (10.229 s)
  allowedClient.middlware
    √ Should success becuase allowed client is right (10 ms)
    √ Should fail since client is not right (2 ms)

PASS src/controllers/attachments/uploadAttachment.controller.spec.ts (10.258 s)
  attachment/uploadAttachments
    √ Should success (9 ms)

PASS src/controllers/services/getAllProviderServices.controller.spec.ts
  services/getAllProviderServices
    √ Should succeed and return all modules (1 ms)
    √ Should fail because providerId dont belongs to the current user (2 ms)
    √ Should filter by bodyTypeId when provided (2 ms)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"method":"GET","path":"/api/non-existent-endpoint","originalUrl":"/api/non-existent-endpoint","ip":"::ffff:127.0.0.1","requestId":"","query":{},"headers":{},"level":"warn","message":"API endpoint not found"}

    [0m [90m 59 |[39m
     [90m 60 |[39m   [90m// Log the 404 attempt with details[39m
    [31m[1m>[22m[39m[90m 61 |[39m   logger[33m.[39mwarn([32m'API endpoint not found'[39m[33m,[39m {
     [90m    |[39m          [31m[1m^[22m[39m
     [90m 62 |[39m     method[33m:[39m req[33m.[39mmethod[33m,[39m
     [90m 63 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m
     [90m 64 |[39m     originalUrl[33m:[39m req[33m.[39moriginalUrl[33m,[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as warn] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at notFoundController (src/controllers/notFound.controller.ts:61:10)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at Route.dispatch (node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at node_modules/express/lib/router/index.js:284:15
      at param (node_modules/express/lib/router/index.js:365:14)
      at param (node_modules/express/lib/router/index.js:376:14)
      at Function.process_params (node_modules/express/lib/router/index.js:421:3)
      at next (node_modules/express/lib/router/index.js:280:10)
      at jsonParser (node_modules/body-parser/lib/types/json.js:113:7)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at expressInit (node_modules/express/lib/middleware/init.js:40:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at query (node_modules/express/lib/middleware/query.js:45:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Function.handle (node_modules/express/lib/router/index.js:175:3)
      at Function.handle (node_modules/express/lib/application.js:181:10)
      at Server.app (node_modules/express/lib/express.js:39:9)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"path":"/api/non-existent-endpoint","originalUrl":"/api/non-existent-endpoint","level":"debug","message":"Request path and originalUrl"}

    [0m [90m 74 |[39m
     [90m 75 |[39m   [90m// Log the values of req.path and req.originalUrl for debugging[39m
    [31m[1m>[22m[39m[90m 76 |[39m   logger[33m.[39mdebug([32m'Request path and originalUrl'[39m[33m,[39m {
     [90m    |[39m          [31m[1m^[22m[39m
     [90m 77 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m
     [90m 78 |[39m     originalUrl[33m:[39m req[33m.[39moriginalUrl[33m,[39m
     [90m 79 |[39m   })[33m;[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as debug] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at notFoundController (src/controllers/notFound.controller.ts:76:10)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at Route.dispatch (node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at node_modules/express/lib/router/index.js:284:15
      at param (node_modules/express/lib/router/index.js:365:14)
      at param (node_modules/express/lib/router/index.js:376:14)
      at Function.process_params (node_modules/express/lib/router/index.js:421:3)
      at next (node_modules/express/lib/router/index.js:280:10)
      at jsonParser (node_modules/body-parser/lib/types/json.js:113:7)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at expressInit (node_modules/express/lib/middleware/init.js:40:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at query (node_modules/express/lib/middleware/query.js:45:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Function.handle (node_modules/express/lib/router/index.js:175:3)
      at Function.handle (node_modules/express/lib/application.js:181:10)
      at Server.app (node_modules/express/lib/express.js:39:9)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"rawUrl":"/api/non-existent-endpoint","headers":{"host":"127.0.0.1:53284","accept-encoding":"gzip, deflate","connection":"close"},"level":"debug","message":"Raw request details"}

    [0m [90m 80 |[39m
     [90m 81 |[39m   [90m// Log raw request URL and headers for debugging[39m
    [31m[1m>[22m[39m[90m 82 |[39m   logger[33m.[39mdebug([32m'Raw request details'[39m[33m,[39m {
     [90m    |[39m          [31m[1m^[22m[39m
     [90m 83 |[39m     rawUrl[33m:[39m req[33m.[39murl[33m,[39m
     [90m 84 |[39m     headers[33m:[39m req[33m.[39mheaders[33m,[39m
     [90m 85 |[39m   })[33m;[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as debug] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at notFoundController (src/controllers/notFound.controller.ts:82:10)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at Route.dispatch (node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at node_modules/express/lib/router/index.js:284:15
      at param (node_modules/express/lib/router/index.js:365:14)
      at param (node_modules/express/lib/router/index.js:376:14)
      at Function.process_params (node_modules/express/lib/router/index.js:421:3)
      at next (node_modules/express/lib/router/index.js:280:10)
      at jsonParser (node_modules/body-parser/lib/types/json.js:113:7)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at expressInit (node_modules/express/lib/middleware/init.js:40:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at query (node_modules/express/lib/middleware/query.js:45:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Function.handle (node_modules/express/lib/router/index.js:175:3)
      at Function.handle (node_modules/express/lib/application.js:181:10)
      at Server.app (node_modules/express/lib/express.js:39:9)

FAIL src/controllers/users/updatePassword.controller.spec.ts (10.348 s)
  Update Password Controller
    × should successfully update password with valid data (8 ms)
    × should throw error when user not found (8 ms)
    × should throw error when user is inactive (12 ms)
    √ should throw error with invalid OTP (12 ms)
    √ should handle database errors gracefully (8 ms)

  ● Update Password Controller › should successfully update password with valid data

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: {"select": {"Email": true, "id": true, "isActive": true}, "where": {"Email": "test@example.com"}}

    Number of calls: 0

    [0m [90m 34 |[39m     [36mawait[39m updatePassword(global[33m.[39mmockReq[33m,[39m global[33m.[39mmockRes[33m,[39m global[33m.[39mmockNext)[33m;[39m
     [90m 35 |[39m
    [31m[1m>[22m[39m[90m 36 |[39m     expect(prismaMock[33m.[39musers[33m.[39mfindUnique)[33m.[39mtoHaveBeenCalledWith({
     [90m    |[39m                                         [31m[1m^[22m[39m
     [90m 37 |[39m       where[33m:[39m { [33mEmail[39m[33m:[39m [32m'test@example.com'[39m }[33m,[39m
     [90m 38 |[39m       select[33m:[39m {
     [90m 39 |[39m         id[33m:[39m [36mtrue[39m[33m,[39m[0m

      at Object.<anonymous> (src/controllers/users/updatePassword.controller.spec.ts:36:41)

  ● Update Password Controller › should throw error when user not found

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

      {"_addBody": [Function _addBody], "_events": {}, "_eventsCount": 0, "_maxListeners": undefined, "_setBaseUrl": [Function _setBaseUrl], "_setBody": [Function _setBody], "_setCookiesVariable": [Function _setCookiesVariable], "_setFilesVariable": [Function _setFilesVariable], "_setHeadersVariable": [Function _setHeadersVariable], "_setMethod": [Function _setMethod], "_setOriginalUrl": [Function _setOriginalUrl], "_setParameter": [Function _setParameter], "_setSessionVariable": [Function _setSessionVariable], "_setSignedCookiesVariable": [Function _setSignedCookiesVariable], "_setURL": [Function _setURL], "accepts": [Function acceptsTypes], "acceptsCharsets": [Function acceptsCharsets], "acceptsEncodings": [Function acceptsEncodings], "acceptsLanguages": [Function acceptsLanguages], "baseUrl": "", "body": {"email": "test@example.com", "newPassword": "newpassword123", "otp": "123456"}, "cookies": {}, "destroy": [Function anonymous], "files": {}, "get": [Function getHeader], "getHeader": [Function getHeader], "header": [Function getHeader], "headers": {"req_id": "test-request-id"}, "hostname": "", "ip": "127.0.0.1", "ips": ["127.0.0.1"], "is": [Function isContentType], "logger": {"error": [Function mockConstructor], "info": [Function mockConstructor], "warn": [Function mockConstructor]}, "method": "GET", "originalUrl": "", "param": [Function param], "params": {}, "path": "", "prisma": undefined, "query": {}, "range": [Function isRange], "send": [Function send], "socket": {}, "subdomains": [], "url": "", "user": {}, Symbol(shapeMode): false, Symbol(kCapture): false, Symbol(Symbol.asyncIterator): [Function asyncIterator]},
      {"_getBuffer": [Function _getBuffer], "_getChunks": [Function _getChunks], "_getData": [Function _getData], "_getHeaders": [Function _getHeaders], "_getJSONData": [Function _getJSONData], "_getLocals": [Function _getLocals], "_getRedirectUrl": [Function _getRedirectUrl], "_getRenderData": [Function _getRenderData], "_getRenderView": [Function _getRenderView], "_getStatusCode": [Function _getStatusCode], "_getStatusMessage": [Function _getStatusMessage], "_headers": {}, "_isDataLengthValid": [Function _isDataLengthValid], "_isEndCalled": [Function _isEndCalled], "_isJSON": [Function _isJSON], "_isUTF8": [Function _isUTF8], "append": [Function append], "appendHeader": [Function appendHeader], "attachment": [Function attachment], "clearCookie": [Function clearCookie], "contentType": [Function contentType], "cookie": [Function cookie], "cookies": {}, "destroy": [Function destroy], "destroySoon": [Function destroySoon], "end": [Function end], "finished": false, "format": [Function format], "get": [Function getHeader], "getEncoding": [Function getEncoding], "getHeader": [Function getHeader], "getHeaderNames": [Function getHeaderNames], "getHeaders": [Function getHeaders], "hasHeader": [Function hasHeader], "header": [Function header], "headersSent": false, "json": [Function json], "jsonp": [Function jsonp], "locals": {}, "location": [Function setLocation], "redirect": [Function redirect], "removeHeader": [Function removeHeader], "render": [Function render], "send": [Function send], "sendStatus": [Function sendStatus], "set": [Function header], "setEncoding": [Function setEncoding], "setHeader": [Function setHeader], "status": [Function status], "statusCode": 200, "statusMessage": "OK", "type": [Function contentType], "vary": [Function vary], "writableEnded": false, "writableFinished": false, "write": [Function write], "writeHead": [Function writeHead]},
    - [Error: Invalid username or password],
    + [Error: Invalid OTP],
      [Function mockConstructor],

    Number of calls: 1

    [0m [90m 70 |[39m     [36mawait[39m updatePassword(global[33m.[39mmockReq[33m,[39m global[33m.[39mmockRes[33m,[39m global[33m.[39mmockNext)[33m;[39m
     [90m 71 |[39m
    [31m[1m>[22m[39m[90m 72 |[39m     expect(createFailResponse)[33m.[39mtoHaveBeenCalledWith(
     [90m    |[39m                                [31m[1m^[22m[39m
     [90m 73 |[39m       global[33m.[39mmockReq[33m,[39m
     [90m 74 |[39m       global[33m.[39mmockRes[33m,[39m
     [90m 75 |[39m       [36mnew[39m [33mHttpException[39m([33mHTTPResponses[39m[33m.[39m[33mBusinessError[39m[33m,[39m [33mHTTPErrorMessages[39m[33m.[39m[33mInvalidUsernameOrPassowrd[39m[33m,[39m [32m'User not found'[39m)[33m,[39m[0m

      at Object.<anonymous> (src/controllers/users/updatePassword.controller.spec.ts:72:32)

  ● Update Password Controller › should throw error when user is inactive

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

      {"_addBody": [Function _addBody], "_events": {}, "_eventsCount": 0, "_maxListeners": undefined, "_setBaseUrl": [Function _setBaseUrl], "_setBody": [Function _setBody], "_setCookiesVariable": [Function _setCookiesVariable], "_setFilesVariable": [Function _setFilesVariable], "_setHeadersVariable": [Function _setHeadersVariable], "_setMethod": [Function _setMethod], "_setOriginalUrl": [Function _setOriginalUrl], "_setParameter": [Function _setParameter], "_setSessionVariable": [Function _setSessionVariable], "_setSignedCookiesVariable": [Function _setSignedCookiesVariable], "_setURL": [Function _setURL], "accepts": [Function acceptsTypes], "acceptsCharsets": [Function acceptsCharsets], "acceptsEncodings": [Function acceptsEncodings], "acceptsLanguages": [Function acceptsLanguages], "baseUrl": "", "body": {"email": "test@example.com", "newPassword": "newpassword123", "otp": "123456"}, "cookies": {}, "destroy": [Function anonymous], "files": {}, "get": [Function getHeader], "getHeader": [Function getHeader], "header": [Function getHeader], "headers": {"req_id": "test-request-id"}, "hostname": "", "ip": "127.0.0.1", "ips": ["127.0.0.1"], "is": [Function isContentType], "logger": {"error": [Function mockConstructor], "info": [Function mockConstructor], "warn": [Function mockConstructor]}, "method": "GET", "originalUrl": "", "param": [Function param], "params": {}, "path": "", "prisma": undefined, "query": {}, "range": [Function isRange], "send": [Function send], "socket": {}, "subdomains": [], "url": "", "user": {}, Symbol(shapeMode): false, Symbol(kCapture): false, Symbol(Symbol.asyncIterator): [Function asyncIterator]},
      {"_getBuffer": [Function _getBuffer], "_getChunks": [Function _getChunks], "_getData": [Function _getData], "_getHeaders": [Function _getHeaders], "_getJSONData": [Function _getJSONData], "_getLocals": [Function _getLocals], "_getRedirectUrl": [Function _getRedirectUrl], "_getRenderData": [Function _getRenderData], "_getRenderView": [Function _getRenderView], "_getStatusCode": [Function _getStatusCode], "_getStatusMessage": [Function _getStatusMessage], "_headers": {}, "_isDataLengthValid": [Function _isDataLengthValid], "_isEndCalled": [Function _isEndCalled], "_isJSON": [Function _isJSON], "_isUTF8": [Function _isUTF8], "append": [Function append], "appendHeader": [Function appendHeader], "attachment": [Function attachment], "clearCookie": [Function clearCookie], "contentType": [Function contentType], "cookie": [Function cookie], "cookies": {}, "destroy": [Function destroy], "destroySoon": [Function destroySoon], "end": [Function end], "finished": false, "format": [Function format], "get": [Function getHeader], "getEncoding": [Function getEncoding], "getHeader": [Function getHeader], "getHeaderNames": [Function getHeaderNames], "getHeaders": [Function getHeaders], "hasHeader": [Function hasHeader], "header": [Function header], "headersSent": false, "json": [Function json], "jsonp": [Function jsonp], "locals": {}, "location": [Function setLocation], "redirect": [Function redirect], "removeHeader": [Function removeHeader], "render": [Function render], "send": [Function send], "sendStatus": [Function sendStatus], "set": [Function header], "setEncoding": [Function setEncoding], "setHeader": [Function setHeader], "status": [Function status], "statusCode": 200, "statusMessage": "OK", "type": [Function contentType], "vary": [Function vary], "writableEnded": false, "writableFinished": false, "write": [Function write], "writeHead": [Function writeHead]},
    - [Error: Your account is still inactive/under processing],
    + [Error: Invalid OTP],
      [Function mockConstructor],

    Number of calls: 1

    [0m [90m 90 |[39m     [36mawait[39m updatePassword(global[33m.[39mmockReq[33m,[39m global[33m.[39mmockRes[33m,[39m global[33m.[39mmockNext)[33m;[39m
     [90m 91 |[39m
    [31m[1m>[22m[39m[90m 92 |[39m     expect(createFailResponse)[33m.[39mtoHaveBeenCalledWith(
     [90m    |[39m                                [31m[1m^[22m[39m
     [90m 93 |[39m       global[33m.[39mmockReq[33m,[39m
     [90m 94 |[39m       global[33m.[39mmockRes[33m,[39m
     [90m 95 |[39m       [36mnew[39m [33mHttpException[39m([33mHTTPResponses[39m[33m.[39m[33mBusinessError[39m[33m,[39m [33mHTTPErrorMessages[39m[33m.[39m[33mAccountInactive[39m[33m,[39m {[0m

      at Object.<anonymous> (src/controllers/users/updatePassword.controller.spec.ts:92:32)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"user":"test-otp@example.com","level":"info","message":"OTP email service initialized successfully"}

    [0m [90m 46 |[39m       otpTransporter [33m=[39m nodemailer[33m.[39mcreateTransport(otpConfig)[33m;[39m
     [90m 47 |[39m       isOtpConfigured [33m=[39m [36mtrue[39m[33m;[39m
    [31m[1m>[22m[39m[90m 48 |[39m       logger[33m.[39minfo([32m'OTP email service initialized successfully'[39m[33m,[39m {
     [90m    |[39m              [31m[1m^[22m[39m
     [90m 49 |[39m         user[33m:[39m environment[33m.[39motpEmail[33m.[39muser[33m,[39m
     [90m 50 |[39m       })[33m;[39m
     [90m 51 |[39m     } [36melse[39m {[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as info] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at initializeEmailService (src/services/emailService.ts:48:14)
      at Object.<anonymous> (src/services/emailService.ts:276:1)
      at Object.<anonymous> (src/controllers/users/register.controller.ts:7:1)
      at Object.<anonymous> (src/controllers/users/register.controller.spec.ts:2:1)

PASS src/controllers/attachments/getImage.controller.spec.ts (10.292 s)
  attachment/getImage
    √ Should success (9 ms)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"level":"debug","message":"Fetching all payment methods"}

    [0m [90m 26 |[39m [33m>[39m [33m=[39m [36masync[39m (req[33m,[39m res[33m,[39m next) [33m=>[39m {
     [90m 27 |[39m   [36mtry[39m {
    [31m[1m>[22m[39m[90m 28 |[39m     logger[33m.[39mdebug([32m'Fetching all payment methods'[39m[33m,[39m { reqId[33m:[39m req[33m.[39mheaders[[32m'req_id'[39m] })[33m;[39m
     [90m    |[39m            [31m[1m^[22m[39m
     [90m 29 |[39m
     [90m 30 |[39m     [36mconst[39m paymentMethods [33m=[39m [36mawait[39m req[33m.[39mprisma[33m.[39mpaymentMethods[33m.[39mfindMany({
     [90m 31 |[39m       select[33m:[39m { [33mMethodName[39m[33m:[39m [36mtrue[39m[33m,[39m id[33m:[39m [36mtrue[39m[33m,[39m [33mMethodDescription[39m[33m:[39m [36mtrue[39m }[33m,[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as debug] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at getAllPaymentMethods (src/controllers/payment/getAllPaymentMethods.controller.ts:28:12)
      at Object.<anonymous> (src/controllers/payment/getAllPaymentMethods.controller.spec.ts:8:31)

FAIL src/middleware/auth.middleware.spec.ts (10.292 s)
  auth.middleware
    auth
      √ Should fail becuase no auth token is passed (9 ms)
      √ Should fail becuase auth token is passed but its incorrect(name is incorrect) (1 ms)
      √ Should fail becuase auth token is expired (1 ms)
      × Should fail because allowed client is not right (4 ms)
      √ Should fail because verson is different than application version
      √ Should success
    authRoute
      √ Should call next in case of headers is sent (1 ms)
      √ Should call fail response with right parameterds (2 ms)
      √ Should inject user id in case of skip auth (1 ms)

  ● auth.middleware › auth › Should fail because allowed client is not right

    expect(received).toEqual(expected) // deep equality

    Expected: "Allowed Client is not right"
    Received: undefined

    [0m [90m 75 |[39m         [36mawait[39m auth([32m'wrong'[39m[33m,[39m [32m'wrong client'[39m)[33m;[39m
     [90m 76 |[39m       } [36mcatch[39m (error[33m:[39m any) {
    [31m[1m>[22m[39m[90m 77 |[39m         expect(error[33m.[39madditionalParameters)[33m.[39mtoEqual([32m'Allowed Client is not right'[39m)[33m;[39m
     [90m    |[39m                                            [31m[1m^[22m[39m
     [90m 78 |[39m       }
     [90m 79 |[39m     })[33m;[39m
     [90m 80 |[39m[0m

      at Object.<anonymous> (src/middleware/auth.middleware.spec.ts:77:44)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"count":1,"level":"debug","message":"Payment methods retrieved successfully"}

    [0m [90m 32 |[39m     })[33m;[39m
     [90m 33 |[39m
    [31m[1m>[22m[39m[90m 34 |[39m     logger[33m.[39mdebug([32m'Payment methods retrieved successfully'[39m[33m,[39m {
     [90m    |[39m            [31m[1m^[22m[39m
     [90m 35 |[39m       count[33m:[39m paymentMethods[33m.[39mlength[33m,[39m
     [90m 36 |[39m       reqId[33m:[39m req[33m.[39mheaders[[32m'req_id'[39m][33m,[39m
     [90m 37 |[39m     })[33m;[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as debug] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at getAllPaymentMethods (src/controllers/payment/getAllPaymentMethods.controller.ts:34:12)
      at Object.<anonymous> (src/controllers/payment/getAllPaymentMethods.controller.spec.ts:8:5)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"user":"test-support@example.com","level":"info","message":"Support email service initialized successfully"}

    [0m [90m 59 |[39m       supportTransporter [33m=[39m nodemailer[33m.[39mcreateTransport(supportConfig)[33m;[39m
     [90m 60 |[39m       isSupportConfigured [33m=[39m [36mtrue[39m[33m;[39m
    [31m[1m>[22m[39m[90m 61 |[39m       logger[33m.[39minfo([32m'Support email service initialized successfully'[39m[33m,[39m {
     [90m    |[39m              [31m[1m^[22m[39m
     [90m 62 |[39m         user[33m:[39m environment[33m.[39msupportEmail[33m.[39muser[33m,[39m
     [90m 63 |[39m       })[33m;[39m
     [90m 64 |[39m     } [36melse[39m {[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as info] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at initializeEmailService (src/services/emailService.ts:61:14)
      at Object.<anonymous> (src/services/emailService.ts:276:1)
      at Object.<anonymous> (src/controllers/users/register.controller.ts:7:1)
      at Object.<anonymous> (src/controllers/users/register.controller.spec.ts:2:1)

PASS src/controllers/payment/getAllPaymentMethods.controller.spec.ts (10.311 s)
  payment/getAllPaymentMethods
    √ Should return payment methods (50 ms)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"method":"POST","path":"/api/invalid-endpoint","originalUrl":"/api/invalid-endpoint","ip":"::ffff:127.0.0.1","requestId":"","query":{},"headers":{},"level":"warn","message":"API endpoint not found"}

    [0m [90m 59 |[39m
     [90m 60 |[39m   [90m// Log the 404 attempt with details[39m
    [31m[1m>[22m[39m[90m 61 |[39m   logger[33m.[39mwarn([32m'API endpoint not found'[39m[33m,[39m {
     [90m    |[39m          [31m[1m^[22m[39m
     [90m 62 |[39m     method[33m:[39m req[33m.[39mmethod[33m,[39m
     [90m 63 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m
     [90m 64 |[39m     originalUrl[33m:[39m req[33m.[39moriginalUrl[33m,[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as warn] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at notFoundController (src/controllers/notFound.controller.ts:61:10)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at Route.dispatch (node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at node_modules/express/lib/router/index.js:284:15
      at param (node_modules/express/lib/router/index.js:365:14)
      at param (node_modules/express/lib/router/index.js:376:14)
      at Function.process_params (node_modules/express/lib/router/index.js:421:3)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/body-parser/lib/read.js:137:5
      at invokeCallback (node_modules/raw-body/index.js:238:16)
      at done (node_modules/raw-body/index.js:227:7)
      at IncomingMessage.onEnd (node_modules/raw-body/index.js:287:7)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"path":"/api/invalid-endpoint","originalUrl":"/api/invalid-endpoint","level":"debug","message":"Request path and originalUrl"}

    [0m [90m 74 |[39m
     [90m 75 |[39m   [90m// Log the values of req.path and req.originalUrl for debugging[39m
    [31m[1m>[22m[39m[90m 76 |[39m   logger[33m.[39mdebug([32m'Request path and originalUrl'[39m[33m,[39m {
     [90m    |[39m          [31m[1m^[22m[39m
     [90m 77 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m
     [90m 78 |[39m     originalUrl[33m:[39m req[33m.[39moriginalUrl[33m,[39m
     [90m 79 |[39m   })[33m;[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as debug] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at notFoundController (src/controllers/notFound.controller.ts:76:10)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at Route.dispatch (node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at node_modules/express/lib/router/index.js:284:15
      at param (node_modules/express/lib/router/index.js:365:14)
      at param (node_modules/express/lib/router/index.js:376:14)
      at Function.process_params (node_modules/express/lib/router/index.js:421:3)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/body-parser/lib/read.js:137:5
      at invokeCallback (node_modules/raw-body/index.js:238:16)
      at done (node_modules/raw-body/index.js:227:7)
      at IncomingMessage.onEnd (node_modules/raw-body/index.js:287:7)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"rawUrl":"/api/invalid-endpoint","headers":{"host":"127.0.0.1:53286","accept-encoding":"gzip, deflate","content-type":"application/json","content-length":"15","connection":"close"},"level":"debug","message":"Raw request details"}

    [0m [90m 80 |[39m
     [90m 81 |[39m   [90m// Log raw request URL and headers for debugging[39m
    [31m[1m>[22m[39m[90m 82 |[39m   logger[33m.[39mdebug([32m'Raw request details'[39m[33m,[39m {
     [90m    |[39m          [31m[1m^[22m[39m
     [90m 83 |[39m     rawUrl[33m:[39m req[33m.[39murl[33m,[39m
     [90m 84 |[39m     headers[33m:[39m req[33m.[39mheaders[33m,[39m
     [90m 85 |[39m   })[33m;[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as debug] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at notFoundController (src/controllers/notFound.controller.ts:82:10)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at Route.dispatch (node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at node_modules/express/lib/router/index.js:284:15
      at param (node_modules/express/lib/router/index.js:365:14)
      at param (node_modules/express/lib/router/index.js:376:14)
      at Function.process_params (node_modules/express/lib/router/index.js:421:3)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/body-parser/lib/read.js:137:5
      at invokeCallback (node_modules/raw-body/index.js:238:16)
      at done (node_modules/raw-body/index.js:227:7)
      at IncomingMessage.onEnd (node_modules/raw-body/index.js:287:7)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"method":"PUT","path":"/api/fake-resource/123","originalUrl":"/api/fake-resource/123","ip":"::ffff:127.0.0.1","requestId":"","query":{},"headers":{},"level":"warn","message":"API endpoint not found"}

    [0m [90m 59 |[39m
     [90m 60 |[39m   [90m// Log the 404 attempt with details[39m
    [31m[1m>[22m[39m[90m 61 |[39m   logger[33m.[39mwarn([32m'API endpoint not found'[39m[33m,[39m {
     [90m    |[39m          [31m[1m^[22m[39m
     [90m 62 |[39m     method[33m:[39m req[33m.[39mmethod[33m,[39m
     [90m 63 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m
     [90m 64 |[39m     originalUrl[33m:[39m req[33m.[39moriginalUrl[33m,[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as warn] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at notFoundController (src/controllers/notFound.controller.ts:61:10)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at Route.dispatch (node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at node_modules/express/lib/router/index.js:284:15
      at param (node_modules/express/lib/router/index.js:365:14)
      at param (node_modules/express/lib/router/index.js:376:14)
      at Function.process_params (node_modules/express/lib/router/index.js:421:3)
      at next (node_modules/express/lib/router/index.js:280:10)
      at jsonParser (node_modules/body-parser/lib/types/json.js:122:7)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at expressInit (node_modules/express/lib/middleware/init.js:40:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at query (node_modules/express/lib/middleware/query.js:45:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Function.handle (node_modules/express/lib/router/index.js:175:3)
      at Function.handle (node_modules/express/lib/application.js:181:10)
      at Server.app (node_modules/express/lib/express.js:39:9)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"path":"/api/fake-resource/123","originalUrl":"/api/fake-resource/123","level":"debug","message":"Request path and originalUrl"}

    [0m [90m 74 |[39m
     [90m 75 |[39m   [90m// Log the values of req.path and req.originalUrl for debugging[39m
    [31m[1m>[22m[39m[90m 76 |[39m   logger[33m.[39mdebug([32m'Request path and originalUrl'[39m[33m,[39m {
     [90m    |[39m          [31m[1m^[22m[39m
     [90m 77 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m
     [90m 78 |[39m     originalUrl[33m:[39m req[33m.[39moriginalUrl[33m,[39m
     [90m 79 |[39m   })[33m;[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as debug] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at notFoundController (src/controllers/notFound.controller.ts:76:10)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at Route.dispatch (node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at node_modules/express/lib/router/index.js:284:15
      at param (node_modules/express/lib/router/index.js:365:14)
      at param (node_modules/express/lib/router/index.js:376:14)
      at Function.process_params (node_modules/express/lib/router/index.js:421:3)
      at next (node_modules/express/lib/router/index.js:280:10)
      at jsonParser (node_modules/body-parser/lib/types/json.js:122:7)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at expressInit (node_modules/express/lib/middleware/init.js:40:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at query (node_modules/express/lib/middleware/query.js:45:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Function.handle (node_modules/express/lib/router/index.js:175:3)
      at Function.handle (node_modules/express/lib/application.js:181:10)
      at Server.app (node_modules/express/lib/express.js:39:9)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"rawUrl":"/api/fake-resource/123","headers":{"host":"127.0.0.1:53288","accept-encoding":"gzip, deflate","connection":"close","content-length":"0"},"level":"debug","message":"Raw request details"}

    [0m [90m 80 |[39m
     [90m 81 |[39m   [90m// Log raw request URL and headers for debugging[39m
    [31m[1m>[22m[39m[90m 82 |[39m   logger[33m.[39mdebug([32m'Raw request details'[39m[33m,[39m {
     [90m    |[39m          [31m[1m^[22m[39m
     [90m 83 |[39m     rawUrl[33m:[39m req[33m.[39murl[33m,[39m
     [90m 84 |[39m     headers[33m:[39m req[33m.[39mheaders[33m,[39m
     [90m 85 |[39m   })[33m;[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as debug] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at notFoundController (src/controllers/notFound.controller.ts:82:10)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at Route.dispatch (node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at node_modules/express/lib/router/index.js:284:15
      at param (node_modules/express/lib/router/index.js:365:14)
      at param (node_modules/express/lib/router/index.js:376:14)
      at Function.process_params (node_modules/express/lib/router/index.js:421:3)
      at next (node_modules/express/lib/router/index.js:280:10)
      at jsonParser (node_modules/body-parser/lib/types/json.js:122:7)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at expressInit (node_modules/express/lib/middleware/init.js:40:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at query (node_modules/express/lib/middleware/query.js:45:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Function.handle (node_modules/express/lib/router/index.js:175:3)
      at Function.handle (node_modules/express/lib/application.js:181:10)
      at Server.app (node_modules/express/lib/express.js:39:9)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"method":"DELETE","path":"/api/missing-resource","originalUrl":"/api/missing-resource","ip":"::ffff:127.0.0.1","requestId":"","query":{},"headers":{},"level":"warn","message":"API endpoint not found"}

    [0m [90m 59 |[39m
     [90m 60 |[39m   [90m// Log the 404 attempt with details[39m
    [31m[1m>[22m[39m[90m 61 |[39m   logger[33m.[39mwarn([32m'API endpoint not found'[39m[33m,[39m {
     [90m    |[39m          [31m[1m^[22m[39m
     [90m 62 |[39m     method[33m:[39m req[33m.[39mmethod[33m,[39m
     [90m 63 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m
     [90m 64 |[39m     originalUrl[33m:[39m req[33m.[39moriginalUrl[33m,[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as warn] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at notFoundController (src/controllers/notFound.controller.ts:61:10)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at Route.dispatch (node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at node_modules/express/lib/router/index.js:284:15
      at param (node_modules/express/lib/router/index.js:365:14)
      at param (node_modules/express/lib/router/index.js:376:14)
      at Function.process_params (node_modules/express/lib/router/index.js:421:3)
      at next (node_modules/express/lib/router/index.js:280:10)
      at jsonParser (node_modules/body-parser/lib/types/json.js:113:7)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at expressInit (node_modules/express/lib/middleware/init.js:40:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at query (node_modules/express/lib/middleware/query.js:45:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Function.handle (node_modules/express/lib/router/index.js:175:3)
      at Function.handle (node_modules/express/lib/application.js:181:10)
      at Server.app (node_modules/express/lib/express.js:39:9)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"path":"/api/missing-resource","originalUrl":"/api/missing-resource","level":"debug","message":"Request path and originalUrl"}

    [0m [90m 74 |[39m
     [90m 75 |[39m   [90m// Log the values of req.path and req.originalUrl for debugging[39m
    [31m[1m>[22m[39m[90m 76 |[39m   logger[33m.[39mdebug([32m'Request path and originalUrl'[39m[33m,[39m {
     [90m    |[39m          [31m[1m^[22m[39m
     [90m 77 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m
     [90m 78 |[39m     originalUrl[33m:[39m req[33m.[39moriginalUrl[33m,[39m
     [90m 79 |[39m   })[33m;[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as debug] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at notFoundController (src/controllers/notFound.controller.ts:76:10)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at Route.dispatch (node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at node_modules/express/lib/router/index.js:284:15
      at param (node_modules/express/lib/router/index.js:365:14)
      at param (node_modules/express/lib/router/index.js:376:14)
      at Function.process_params (node_modules/express/lib/router/index.js:421:3)
      at next (node_modules/express/lib/router/index.js:280:10)
      at jsonParser (node_modules/body-parser/lib/types/json.js:113:7)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at expressInit (node_modules/express/lib/middleware/init.js:40:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at query (node_modules/express/lib/middleware/query.js:45:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Function.handle (node_modules/express/lib/router/index.js:175:3)
      at Function.handle (node_modules/express/lib/application.js:181:10)
      at Server.app (node_modules/express/lib/express.js:39:9)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"rawUrl":"/api/missing-resource","headers":{"host":"127.0.0.1:53290","accept-encoding":"gzip, deflate","connection":"close"},"level":"debug","message":"Raw request details"}

    [0m [90m 80 |[39m
     [90m 81 |[39m   [90m// Log raw request URL and headers for debugging[39m
    [31m[1m>[22m[39m[90m 82 |[39m   logger[33m.[39mdebug([32m'Raw request details'[39m[33m,[39m {
     [90m    |[39m          [31m[1m^[22m[39m
     [90m 83 |[39m     rawUrl[33m:[39m req[33m.[39murl[33m,[39m
     [90m 84 |[39m     headers[33m:[39m req[33m.[39mheaders[33m,[39m
     [90m 85 |[39m   })[33m;[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as debug] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at notFoundController (src/controllers/notFound.controller.ts:82:10)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at Route.dispatch (node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at node_modules/express/lib/router/index.js:284:15
      at param (node_modules/express/lib/router/index.js:365:14)
      at param (node_modules/express/lib/router/index.js:376:14)
      at Function.process_params (node_modules/express/lib/router/index.js:421:3)
      at next (node_modules/express/lib/router/index.js:280:10)
      at jsonParser (node_modules/body-parser/lib/types/json.js:113:7)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at expressInit (node_modules/express/lib/middleware/init.js:40:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at query (node_modules/express/lib/middleware/query.js:45:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Function.handle (node_modules/express/lib/router/index.js:175:3)
      at Function.handle (node_modules/express/lib/application.js:181:10)
      at Server.app (node_modules/express/lib/express.js:39:9)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"method":"GET","path":"/api/nowhere","originalUrl":"/api/nowhere","ip":"::ffff:127.0.0.1","requestId":"test-request-123","query":{},"headers":{},"level":"warn","message":"API endpoint not found"}

    [0m [90m 59 |[39m
     [90m 60 |[39m   [90m// Log the 404 attempt with details[39m
    [31m[1m>[22m[39m[90m 61 |[39m   logger[33m.[39mwarn([32m'API endpoint not found'[39m[33m,[39m {
     [90m    |[39m          [31m[1m^[22m[39m
     [90m 62 |[39m     method[33m:[39m req[33m.[39mmethod[33m,[39m
     [90m 63 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m
     [90m 64 |[39m     originalUrl[33m:[39m req[33m.[39moriginalUrl[33m,[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as warn] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at notFoundController (src/controllers/notFound.controller.ts:61:10)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at Route.dispatch (node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at node_modules/express/lib/router/index.js:284:15
      at param (node_modules/express/lib/router/index.js:365:14)
      at param (node_modules/express/lib/router/index.js:376:14)
      at Function.process_params (node_modules/express/lib/router/index.js:421:3)
      at next (node_modules/express/lib/router/index.js:280:10)
      at jsonParser (node_modules/body-parser/lib/types/json.js:113:7)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at expressInit (node_modules/express/lib/middleware/init.js:40:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at query (node_modules/express/lib/middleware/query.js:45:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Function.handle (node_modules/express/lib/router/index.js:175:3)
      at Function.handle (node_modules/express/lib/application.js:181:10)
      at Server.app (node_modules/express/lib/express.js:39:9)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"path":"/api/nowhere","originalUrl":"/api/nowhere","level":"debug","message":"Request path and originalUrl"}

    [0m [90m 74 |[39m
     [90m 75 |[39m   [90m// Log the values of req.path and req.originalUrl for debugging[39m
    [31m[1m>[22m[39m[90m 76 |[39m   logger[33m.[39mdebug([32m'Request path and originalUrl'[39m[33m,[39m {
     [90m    |[39m          [31m[1m^[22m[39m
     [90m 77 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m
     [90m 78 |[39m     originalUrl[33m:[39m req[33m.[39moriginalUrl[33m,[39m
     [90m 79 |[39m   })[33m;[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as debug] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at notFoundController (src/controllers/notFound.controller.ts:76:10)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at Route.dispatch (node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at node_modules/express/lib/router/index.js:284:15
      at param (node_modules/express/lib/router/index.js:365:14)
      at param (node_modules/express/lib/router/index.js:376:14)
      at Function.process_params (node_modules/express/lib/router/index.js:421:3)
      at next (node_modules/express/lib/router/index.js:280:10)
      at jsonParser (node_modules/body-parser/lib/types/json.js:113:7)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at expressInit (node_modules/express/lib/middleware/init.js:40:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at query (node_modules/express/lib/middleware/query.js:45:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Function.handle (node_modules/express/lib/router/index.js:175:3)
      at Function.handle (node_modules/express/lib/application.js:181:10)
      at Server.app (node_modules/express/lib/express.js:39:9)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"rawUrl":"/api/nowhere","headers":{"host":"127.0.0.1:53292","accept-encoding":"gzip, deflate","req_id":"test-request-123","connection":"close"},"level":"debug","message":"Raw request details"}

    [0m [90m 80 |[39m
     [90m 81 |[39m   [90m// Log raw request URL and headers for debugging[39m
    [31m[1m>[22m[39m[90m 82 |[39m   logger[33m.[39mdebug([32m'Raw request details'[39m[33m,[39m {
     [90m    |[39m          [31m[1m^[22m[39m
     [90m 83 |[39m     rawUrl[33m:[39m req[33m.[39murl[33m,[39m
     [90m 84 |[39m     headers[33m:[39m req[33m.[39mheaders[33m,[39m
     [90m 85 |[39m   })[33m;[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as debug] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at notFoundController (src/controllers/notFound.controller.ts:82:10)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at Route.dispatch (node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at node_modules/express/lib/router/index.js:284:15
      at param (node_modules/express/lib/router/index.js:365:14)
      at param (node_modules/express/lib/router/index.js:376:14)
      at Function.process_params (node_modules/express/lib/router/index.js:421:3)
      at next (node_modules/express/lib/router/index.js:280:10)
      at jsonParser (node_modules/body-parser/lib/types/json.js:113:7)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at expressInit (node_modules/express/lib/middleware/init.js:40:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at query (node_modules/express/lib/middleware/query.js:45:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Function.handle (node_modules/express/lib/router/index.js:175:3)
      at Function.handle (node_modules/express/lib/application.js:181:10)
      at Server.app (node_modules/express/lib/express.js:39:9)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"method":"GET","path":"/api/missing","originalUrl":"/api/missing?param1=value1&param2=value2","ip":"::ffff:127.0.0.1","requestId":"","query":{"param1":"value1","param2":"value2"},"headers":{},"level":"warn","message":"API endpoint not found"}

    [0m [90m 59 |[39m
     [90m 60 |[39m   [90m// Log the 404 attempt with details[39m
    [31m[1m>[22m[39m[90m 61 |[39m   logger[33m.[39mwarn([32m'API endpoint not found'[39m[33m,[39m {
     [90m    |[39m          [31m[1m^[22m[39m
     [90m 62 |[39m     method[33m:[39m req[33m.[39mmethod[33m,[39m
     [90m 63 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m
     [90m 64 |[39m     originalUrl[33m:[39m req[33m.[39moriginalUrl[33m,[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as warn] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at notFoundController (src/controllers/notFound.controller.ts:61:10)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at Route.dispatch (node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at node_modules/express/lib/router/index.js:284:15
      at param (node_modules/express/lib/router/index.js:365:14)
      at param (node_modules/express/lib/router/index.js:376:14)
      at Function.process_params (node_modules/express/lib/router/index.js:421:3)
      at next (node_modules/express/lib/router/index.js:280:10)
      at jsonParser (node_modules/body-parser/lib/types/json.js:113:7)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at expressInit (node_modules/express/lib/middleware/init.js:40:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at query (node_modules/express/lib/middleware/query.js:45:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Function.handle (node_modules/express/lib/router/index.js:175:3)
      at Function.handle (node_modules/express/lib/application.js:181:10)
      at Server.app (node_modules/express/lib/express.js:39:9)

PASS src/controllers/notFound.controller.spec.ts (10.357 s)
  404 Not Found Controller
    GET /api/non-existent-endpoint
      √ should return 404 with proper structure for non-existent API endpoint (74 ms)
      √ should return 404 for POST requests to non-existent endpoints (22 ms)
      √ should return 404 for PUT requests to non-existent endpoints (8 ms)
      √ should return 404 for DELETE requests to non-existent endpoints (7 ms)
      √ should include request ID in the response header (12 ms)
      √ should handle query parameters in 404 response (5 ms)
    Edge Cases
      √ should handle very long invalid paths (3 ms)
      √ should handle paths with special characters (2 ms)
      √ should not interfere with existing valid endpoints (1 ms)

FAIL src/controllers/orders/getOneOrder.controller.spec.ts (10.406 s)
  orders/getOneOrder
    × Should success and return the order (5 ms)
    × Should fail because no order (3 ms)

  ● orders/getOneOrder › Should success and return the order

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

    [0m [90m 16 |[39m     [36mawait[39m getOneOrder(global[33m.[39mmockReq[33m,[39m global[33m.[39mmockRes[33m,[39m global[33m.[39mmockNext)[33m;[39m
     [90m 17 |[39m
    [31m[1m>[22m[39m[90m 18 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledTimes([35m1[39m)[33m;[39m
     [90m    |[39m                                   [31m[1m^[22m[39m
     [90m 19 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledWith(global[33m.[39mmockReq[33m,[39m global[33m.[39mmockRes[33m,[39m { 
     [90m 20 |[39m       id[33m:[39m [35m111[39m[33m,[39m
     [90m 21 |[39m       paymentMethods[33m:[39m {[0m

      at Object.<anonymous> (src/controllers/orders/getOneOrder.controller.spec.ts:18:35)

  ● orders/getOneOrder › Should fail because no order

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

    [0m [90m 32 |[39m     [36mawait[39m getOneOrder(global[33m.[39mmockReq[33m,[39m global[33m.[39mmockRes[33m,[39m global[33m.[39mmockNext)[33m;[39m
     [90m 33 |[39m
    [31m[1m>[22m[39m[90m 34 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledTimes([35m1[39m)[33m;[39m
     [90m    |[39m                                   [31m[1m^[22m[39m
     [90m 35 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledWith(global[33m.[39mmockReq[33m,[39m global[33m.[39mmockRes[33m,[39m {}[33m,[39m global[33m.[39mmockNext)[33m;[39m
     [90m 36 |[39m   })[33m;[39m
     [90m 37 |[39m })[33m;[39m[0m

      at Object.<anonymous> (src/controllers/orders/getOneOrder.controller.spec.ts:34:35)

PASS src/controllers/orders/getAllOrders.controller.spec.ts (10.425 s)
  Get All Orders Controller
    √ should successfully get all orders without filters (5 ms)
    √ should handle database errors gracefully (1 ms)

FAIL src/controllers/orders/addOrder.controller.spec.ts (10.489 s)
  orders/addOrder
    × Should succeed (7 ms)
    √ Should fail when payment is not active (2 ms)

  ● orders/addOrder › Should succeed

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

    [0m [90m 35 |[39m     [36mawait[39m addOrder(global[33m.[39mmockReq[33m,[39m global[33m.[39mmockRes[33m,[39m global[33m.[39mmockNext)[33m;[39m
     [90m 36 |[39m
    [31m[1m>[22m[39m[90m 37 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledTimes([35m1[39m)[33m;[39m
     [90m    |[39m                                   [31m[1m^[22m[39m
     [90m 38 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledWith(
     [90m 39 |[39m       global[33m.[39mmockReq[33m,[39m
     [90m 40 |[39m       global[33m.[39mmockRes[33m,[39m[0m

      at Object.<anonymous> (src/controllers/orders/addOrder.controller.spec.ts:37:35)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"type":"EMAIL_VERIFICATION","expiresAt":"2025-08-24T13:46:36.101Z","otpLength":6,"level":"info","message":"OTP generated successfully"}

    [0m [90m 67 |[39m     })[33m;[39m
     [90m 68 |[39m
    [31m[1m>[22m[39m[90m 69 |[39m     logger[33m.[39minfo([32m'OTP generated successfully'[39m[33m,[39m {
     [90m    |[39m            [31m[1m^[22m[39m
     [90m 70 |[39m       email[33m,[39m
     [90m 71 |[39m       type[33m,[39m
     [90m 72 |[39m       expiresAt[33m,[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as info] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at generateOtp (src/services/otpService.ts:69:12)
      at registerUser (src/controllers/users/register.controller.ts:100:23)
      at Object.<anonymous> (src/controllers/users/register.controller.spec.ts:9:5)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"type":"EMAIL_VERIFICATION","error":{"errno":-4078,"code":"ESOCKET","syscall":"connect","address":"::1","port":587,"command":"CONN"},"level":"error","message":"Failed to send OTP email"}

    [0m [90m 148 |[39m     }
     [90m 149 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 150 |[39m     logger[33m.[39merror([32m'Failed to send OTP email'[39m[33m,[39m {
     [90m     |[39m            [31m[1m^[22m[39m
     [90m 151 |[39m       to[33m:[39m email[33m,[39m
     [90m 152 |[39m       type[33m,[39m
     [90m 153 |[39m       error[33m:[39m error [36minstanceof[39m [33mError[39m [33m?[39m error[33m.[39mmessage [33m:[39m error[33m,[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as error] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at sendOTPEmail (src/services/emailService.ts:150:12)
      at registerUser (src/controllers/users/register.controller.ts:111:23)
      at Object.<anonymous> (src/controllers/users/register.controller.spec.ts:9:5)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"event":"Login failed - Invalid password","success":false,"timestamp":"2025-08-24T13:36:36.097Z","email":"1","level":"warn","message":"[AUTH] Login failed - Invalid password"}

    [0m [90m 253 |[39m   logAuthEvent[33m:[39m (event[33m:[39m string[33m,[39m userId[33m?[39m[33m:[39m number[33m,[39m success[33m:[39m boolean [33m=[39m [36mtrue[39m[33m,[39m meta[33m?[39m[33m:[39m any) [33m=>[39m {
     [90m 254 |[39m     [36mconst[39m level [33m=[39m success [33m?[39m [32m'info'[39m [33m:[39m [32m'warn'[39m[33m;[39m
    [31m[1m>[22m[39m[90m 255 |[39m     enhancedLogger[33m.[39mlog(level[33m,[39m [32m`[AUTH] ${event}`[39m[33m,[39m {
     [90m     |[39m                    [31m[1m^[22m[39m
     [90m 256 |[39m       event[33m,[39m
     [90m 257 |[39m       userId[33m,[39m
     [90m 258 |[39m       success[33m,[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at Object.logAuthEvent (src/utils/logger.ts:255:20)
      at login (src/controllers/users/login.controller.ts:102:19)
      at Object.<anonymous> (src/controllers/users/login.controller.spec.ts:27:5)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"error":{"status":422,"additionalParameters":"Password incorrect"},"stack":"Error: Invalid username or password\n    at login (K:\\0-CarWashProject\\api\\src\\controllers\\users\\login.controller.ts:103:13)\n    at Object.<anonymous> (K:\\0-CarWashProject\\api\\src\\controllers\\users\\login.controller.spec.ts:27:5)","context":"Login Controller","timestamp":"2025-08-24T13:36:36.130Z","email":"1","level":"error","message":"[Login Controller] Invalid username or password"}

    [0m [90m 228 |[39m     }
     [90m 229 |[39m
    [31m[1m>[22m[39m[90m 230 |[39m     enhancedLogger[33m.[39merror([32m`${context ? `[${context}] ` : ''}${error.message}`[39m[33m,[39m {
     [90m     |[39m                    [31m[1m^[22m[39m
     [90m 231 |[39m       error[33m:[39m {
     [90m 232 |[39m         name[33m:[39m error[33m.[39mname[33m,[39m
     [90m 233 |[39m         message[33m:[39m error[33m.[39mmessage[33m,[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as error] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at Object.logError (src/utils/logger.ts:230:20)
      at login (src/controllers/users/login.controller.ts:210:17)
      at Object.<anonymous> (src/controllers/users/login.controller.spec.ts:27:5)

FAIL src/controllers/users/register.controller.spec.ts (10.506 s)
  users/register
    × Should success (193 ms)

  ● users/register › Should success

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

      {"_addBody": [Function _addBody], "_events": {}, "_eventsCount": 0, "_maxListeners": undefined, "_setBaseUrl": [Function _setBaseUrl], "_setBody": [Function _setBody], "_setCookiesVariable": [Function _setCookiesVariable], "_setFilesVariable": [Function _setFilesVariable], "_setHeadersVariable": [Function _setHeadersVariable], "_setMethod": [Function _setMethod], "_setOriginalUrl": [Function _setOriginalUrl], "_setParameter": [Function _setParameter], "_setSessionVariable": [Function _setSessionVariable], "_setSignedCookiesVariable": [Function _setSignedCookiesVariable], "_setURL": [Function _setURL], "accepts": [Function acceptsTypes], "acceptsCharsets": [Function acceptsCharsets], "acceptsEncodings": [Function acceptsEncodings], "acceptsLanguages": [Function acceptsLanguages], "baseUrl": "", "body": {"Password": "Test", "UserTypeName": "Test"}, "cookies": {}, "destroy": [Function anonymous], "files": {}, "get": [Function getHeader], "getHeader": [Function getHeader], "header": [Function getHeader], "headers": {}, "hostname": "", "ip": "127.0.0.1", "ips": ["127.0.0.1"], "is": [Function isContentType], "logger": {"error": [Function mockConstructor], "info": [Function mockConstructor], "warn": [Function mockConstructor]}, "method": "GET", "originalUrl": "", "param": [Function param], "params": {}, "path": "", "prisma": undefined, "query": {}, "range": [Function isRange], "send": [Function send], "socket": {}, "subdomains": [], "url": "", "user": {}, Symbol(shapeMode): false, Symbol(kCapture): false, Symbol(Symbol.asyncIterator): [Function asyncIterator]},
      {"_getBuffer": [Function _getBuffer], "_getChunks": [Function _getChunks], "_getData": [Function _getData], "_getHeaders": [Function _getHeaders], "_getJSONData": [Function _getJSONData], "_getLocals": [Function _getLocals], "_getRedirectUrl": [Function _getRedirectUrl], "_getRenderData": [Function _getRenderData], "_getRenderView": [Function _getRenderView], "_getStatusCode": [Function _getStatusCode], "_getStatusMessage": [Function _getStatusMessage], "_headers": {}, "_isDataLengthValid": [Function _isDataLengthValid], "_isEndCalled": [Function _isEndCalled], "_isJSON": [Function _isJSON], "_isUTF8": [Function _isUTF8], "append": [Function append], "appendHeader": [Function appendHeader], "attachment": [Function attachment], "clearCookie": [Function clearCookie], "contentType": [Function contentType], "cookie": [Function cookie], "cookies": {}, "destroy": [Function destroy], "destroySoon": [Function destroySoon], "end": [Function end], "finished": false, "format": [Function format], "get": [Function getHeader], "getEncoding": [Function getEncoding], "getHeader": [Function getHeader], "getHeaderNames": [Function getHeaderNames], "getHeaders": [Function getHeaders], "hasHeader": [Function hasHeader], "header": [Function header], "headersSent": false, "json": [Function json], "jsonp": [Function jsonp], "locals": {}, "location": [Function setLocation], "redirect": [Function redirect], "removeHeader": [Function removeHeader], "render": [Function render], "send": [Function send], "sendStatus": [Function sendStatus], "set": [Function header], "setEncoding": [Function setEncoding], "setHeader": [Function setHeader], "status": [Function status], "statusCode": 200, "statusMessage": "OK", "type": [Function contentType], "vary": [Function vary], "writableEnded": false, "writableFinished": false, "write": [Function write], "writeHead": [Function writeHead]},
      Object {
    +   "emailSent": false,
        "id": 1,
        "result": true,
      },
      [Function mockConstructor],

    Number of calls: 1

    [0m [90m 10 |[39m
     [90m 11 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledTimes([35m1[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 12 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledWith(
     [90m    |[39m                                   [31m[1m^[22m[39m
     [90m 13 |[39m       global[33m.[39mmockReq[33m,[39m
     [90m 14 |[39m       global[33m.[39mmockRes[33m,[39m
     [90m 15 |[39m       { result[33m:[39m [36mtrue[39m[33m,[39m id[33m:[39m [35m1[39m }[33m,[39m[0m

      at Object.<anonymous> (src/controllers/users/register.controller.spec.ts:12:35)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"event":"Login failed - User not found","success":false,"timestamp":"2025-08-24T13:36:36.135Z","level":"warn","message":"[AUTH] Login failed - User not found"}

    [0m [90m 253 |[39m   logAuthEvent[33m:[39m (event[33m:[39m string[33m,[39m userId[33m?[39m[33m:[39m number[33m,[39m success[33m:[39m boolean [33m=[39m [36mtrue[39m[33m,[39m meta[33m?[39m[33m:[39m any) [33m=>[39m {
     [90m 254 |[39m     [36mconst[39m level [33m=[39m success [33m?[39m [32m'info'[39m [33m:[39m [32m'warn'[39m[33m;[39m
    [31m[1m>[22m[39m[90m 255 |[39m     enhancedLogger[33m.[39mlog(level[33m,[39m [32m`[AUTH] ${event}`[39m[33m,[39m {
     [90m     |[39m                    [31m[1m^[22m[39m
     [90m 256 |[39m       event[33m,[39m
     [90m 257 |[39m       userId[33m,[39m
     [90m 258 |[39m       success[33m,[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at Object.logAuthEvent (src/utils/logger.ts:255:20)
      at login (src/controllers/users/login.controller.ts:91:19)
      at Object.<anonymous> (src/controllers/users/login.controller.spec.ts:46:5)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"error":{"status":422,"additionalParameters":"No user found"},"stack":"Error: Invalid username or password\n    at login (K:\\0-CarWashProject\\api\\src\\controllers\\users\\login.controller.ts:92:13)\n    at Object.<anonymous> (K:\\0-CarWashProject\\api\\src\\controllers\\users\\login.controller.spec.ts:46:5)","context":"Login Controller","timestamp":"2025-08-24T13:36:36.137Z","level":"error","message":"[Login Controller] Invalid username or password"}

    [0m [90m 228 |[39m     }
     [90m 229 |[39m
    [31m[1m>[22m[39m[90m 230 |[39m     enhancedLogger[33m.[39merror([32m`${context ? `[${context}] ` : ''}${error.message}`[39m[33m,[39m {
     [90m     |[39m                    [31m[1m^[22m[39m
     [90m 231 |[39m       error[33m:[39m {
     [90m 232 |[39m         name[33m:[39m error[33m.[39mname[33m,[39m
     [90m 233 |[39m         message[33m:[39m error[33m.[39mmessage[33m,[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as error] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at Object.logError (src/utils/logger.ts:230:20)
      at login (src/controllers/users/login.controller.ts:210:17)
      at Object.<anonymous> (src/controllers/users/login.controller.spec.ts:46:5)

  console.log
    ORDER_TIMEOUT_SECONDS: 3

      at Object.<anonymous> (src/web-socket/index.ts:316:9)

  console.log
    Redis adapter not available - running in single-process mode

      at Object.<anonymous> (src/web-socket/index.ts:365:11)

  console.log
    [SOCKET] Chat functions initialized successfully

      at src/web-socket/index.ts:404:13

  console.log
    [SOCKET] Redis manager initialized successfully - 0 providers, 0 orders

      at src/web-socket/index.ts:379:13

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"socketId":"qmERa52LaR99oIdzAAAC","level":"info","message":"Socket connected successfully"}

    [0m [90m 984 |[39m     [90m// inject user id coming from socket[39m
     [90m 985 |[39m     socket[33m.[39mdata[33m.[39muserInfo [33m=[39m socket[33m.[39mhandshake[33m.[39mauth[[32m'userInfo'[39m][33m;[39m
    [31m[1m>[22m[39m[90m 986 |[39m     logger[33m.[39minfo([32m'Socket connected successfully'[39m[33m,[39m {
     [90m     |[39m            [31m[1m^[22m[39m
     [90m 987 |[39m       socketId[33m:[39m socket[33m.[39mid[33m,[39m
     [90m 988 |[39m       userId[33m:[39m socket[33m.[39mdata[33m.[39muserInfo[33m?[39m[33m.[39mid[33m,[39m
     [90m 989 |[39m     })[33m;[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as info] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at Array.<anonymous> (src/web-socket/index.ts:986:12)
      at run (node_modules/socket.io/dist/namespace.js:130:19)
      at Namespace.run (node_modules/socket.io/dist/namespace.js:141:9)
      at Namespace._add (node_modules/socket.io/dist/namespace.js:218:14)

  console.log
    user undefined

      at Namespace.<anonymous> (src/web-socket/index.ts:1003:11)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"socketId":"-V715fkkDk78HZrQAAAD","level":"info","message":"Socket connected successfully"}

    [0m [90m 984 |[39m     [90m// inject user id coming from socket[39m
     [90m 985 |[39m     socket[33m.[39mdata[33m.[39muserInfo [33m=[39m socket[33m.[39mhandshake[33m.[39mauth[[32m'userInfo'[39m][33m;[39m
    [31m[1m>[22m[39m[90m 986 |[39m     logger[33m.[39minfo([32m'Socket connected successfully'[39m[33m,[39m {
     [90m     |[39m            [31m[1m^[22m[39m
     [90m 987 |[39m       socketId[33m:[39m socket[33m.[39mid[33m,[39m
     [90m 988 |[39m       userId[33m:[39m socket[33m.[39mdata[33m.[39muserInfo[33m?[39m[33m.[39mid[33m,[39m
     [90m 989 |[39m     })[33m;[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as info] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at Array.<anonymous> (src/web-socket/index.ts:986:12)
      at run (node_modules/socket.io/dist/namespace.js:130:19)
      at Namespace.run (node_modules/socket.io/dist/namespace.js:141:9)
      at Namespace._add (node_modules/socket.io/dist/namespace.js:218:14)

  console.log
    user undefined

      at Namespace.<anonymous> (src/web-socket/index.ts:1003:11)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"error":{"status":422,"additionalParameters":"Email not verified"},"stack":"Error: Email not verified\n    at login (K:\\0-CarWashProject\\api\\src\\controllers\\users\\login.controller.ts:132:13)\n    at Object.<anonymous> (K:\\0-CarWashProject\\api\\src\\controllers\\users\\login.controller.spec.ts:74:5)","context":"Login Controller","timestamp":"2025-08-24T13:36:36.450Z","email":"1","level":"error","message":"[Login Controller] Email not verified"}

    [0m [90m 228 |[39m     }
     [90m 229 |[39m
    [31m[1m>[22m[39m[90m 230 |[39m     enhancedLogger[33m.[39merror([32m`${context ? `[${context}] ` : ''}${error.message}`[39m[33m,[39m {
     [90m     |[39m                    [31m[1m^[22m[39m
     [90m 231 |[39m       error[33m:[39m {
     [90m 232 |[39m         name[33m:[39m error[33m.[39mname[33m,[39m
     [90m 233 |[39m         message[33m:[39m error[33m.[39mmessage[33m,[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as error] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at Object.logError (src/utils/logger.ts:230:20)
      at login (src/controllers/users/login.controller.ts:210:17)
      at Object.<anonymous> (src/controllers/users/login.controller.spec.ts:74:5)

  console.log
    Start 1

      at Object.<anonymous> (src/web-socket/index.spec.ts:200:13)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"error":"Unauthorised","socketId":"S1WQCGO1U8O0ERYJAAAF","level":"error","message":"Socket connection error"}

    [0m [90m 990 |[39m     next()[33m;[39m
     [90m 991 |[39m   } [36mcatch[39m (error[33m:[39m any) {
    [31m[1m>[22m[39m[90m 992 |[39m     logger[33m.[39merror([32m'Socket connection error'[39m[33m,[39m {
     [90m     |[39m            [31m[1m^[22m[39m
     [90m 993 |[39m       error[33m:[39m error[33m?[39m[33m.[39mmessage [33m||[39m error[33m,[39m
     [90m 994 |[39m       socketId[33m:[39m socket[33m.[39mid[33m,[39m
     [90m 995 |[39m     })[33m;[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as error] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at Array.<anonymous> (src/web-socket/index.ts:992:12)
      at run (node_modules/socket.io/dist/namespace.js:130:19)
      at Namespace.run (node_modules/socket.io/dist/namespace.js:141:9)
      at Namespace._add (node_modules/socket.io/dist/namespace.js:218:14)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"socketId":"ffeT9TAIyT34oy0rAAAI","level":"info","message":"Socket connected successfully"}

    [0m [90m 984 |[39m     [90m// inject user id coming from socket[39m
     [90m 985 |[39m     socket[33m.[39mdata[33m.[39muserInfo [33m=[39m socket[33m.[39mhandshake[33m.[39mauth[[32m'userInfo'[39m][33m;[39m
    [31m[1m>[22m[39m[90m 986 |[39m     logger[33m.[39minfo([32m'Socket connected successfully'[39m[33m,[39m {
     [90m     |[39m            [31m[1m^[22m[39m
     [90m 987 |[39m       socketId[33m:[39m socket[33m.[39mid[33m,[39m
     [90m 988 |[39m       userId[33m:[39m socket[33m.[39mdata[33m.[39muserInfo[33m?[39m[33m.[39mid[33m,[39m
     [90m 989 |[39m     })[33m;[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as info] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at Array.<anonymous> (src/web-socket/index.ts:986:12)
      at run (node_modules/socket.io/dist/namespace.js:130:19)
      at Namespace.run (node_modules/socket.io/dist/namespace.js:141:9)
      at Namespace._add (node_modules/socket.io/dist/namespace.js:218:14)

  console.log
    user undefined

      at Namespace.<anonymous> (src/web-socket/index.ts:1003:11)

  console.log
    ORDER_TIMEOUT_SECONDS: 3

      at Object.<anonymous> (src/web-socket/index.ts:316:9)

  console.log
    Redis adapter not available - running in single-process mode

      at Object.<anonymous> (src/web-socket/index.ts:365:11)

  console.log
    [SOCKET-REDIS] Test environment - using in-memory storage

      at Object.initializeSocketData (src/utils/socketRedisManager.ts:35:13)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"socketId":"Fw85ZPGoL5ptnkF7AAAJ","level":"info","message":"Socket connected successfully"}

    [0m [90m 984 |[39m     [90m// inject user id coming from socket[39m
     [90m 985 |[39m     socket[33m.[39mdata[33m.[39muserInfo [33m=[39m socket[33m.[39mhandshake[33m.[39mauth[[32m'userInfo'[39m][33m;[39m
    [31m[1m>[22m[39m[90m 986 |[39m     logger[33m.[39minfo([32m'Socket connected successfully'[39m[33m,[39m {
     [90m     |[39m            [31m[1m^[22m[39m
     [90m 987 |[39m       socketId[33m:[39m socket[33m.[39mid[33m,[39m
     [90m 988 |[39m       userId[33m:[39m socket[33m.[39mdata[33m.[39muserInfo[33m?[39m[33m.[39mid[33m,[39m
     [90m 989 |[39m     })[33m;[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as info] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at Array.<anonymous> (src/web-socket/index.ts:986:12)
      at run (node_modules/socket.io/dist/namespace.js:130:19)
      at Namespace.run (node_modules/socket.io/dist/namespace.js:141:9)
      at Namespace._add (node_modules/socket.io/dist/namespace.js:218:14)

  console.log
    user undefined

      at Namespace.<anonymous> (src/web-socket/index.ts:1003:11)

  console.log
    [SOCKET] Chat functions initialized successfully

      at src/web-socket/index.ts:404:13

  console.log
    [SOCKET] Redis manager initialized successfully - 0 providers, 0 orders

      at src/web-socket/index.ts:379:13

  console.log
    Start 2

      at Object.<anonymous> (src/web-socket/index.spec.ts:213:13)

  console.log
    [SOCKET] [Provider] [Add] => Adding new provdider {"newArgs":{"latitude":10,"longitude":10,"notifcationToken":"","providerId":1,"status":"Online","userId":1,"uuid":"Fw85ZPGoL5ptnkF7AAAJ","moduleId":1}}

      at addProvider (src/web-socket/index.ts:642:11)

  console.log
    [SOCKET - Broadcast online providers] Broadcasting online providers, Total Online Providers : 1

      at broadcastOnlineProvider (src/web-socket/index.ts:502:11)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"reason":"Accepted","notes":"","level":"info","message":"Adding order history"}

    [0m [90m 467 |[39m [36mexport[39m [36mconst[39m addOrderHistory [33m=[39m [36masync[39m (order[33m:[39m [33mActiveOrders[39m[33m,[39m reason[33m:[39m [33mOrderHistory[39m[33m,[39m notes[33m:[39m string [33m|[39m undefined) [33m=>[39m {
     [90m 468 |[39m   [36mtry[39m {
    [31m[1m>[22m[39m[90m 469 |[39m     logger[33m.[39minfo([32m'Adding order history'[39m[33m,[39m {
     [90m     |[39m            [31m[1m^[22m[39m
     [90m 470 |[39m       orderId[33m:[39m order[33m.[39morderId[33m,[39m
     [90m 471 |[39m       reason[33m:[39m reason[33m.[39mtoString()[33m,[39m
     [90m 472 |[39m       providerUuid[33m:[39m order[33m.[39mproviderUuid[33m,[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as info] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at Object.addOrderHistory (src/web-socket/index.ts:469:12)
      at Object.<anonymous> (src/web-socket/index.functions.spec.ts:27:27)

  console.log
    [SOCKET - Broadcast online providers] Broadcasting online providers, Total Online Providers : 0

      at Object.broadcastOnlineProvider (src/web-socket/index.ts:502:11)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"socketId":"ffeT9TAIyT34oy0rAAAI","reason":"client namespace disconnect","level":"info","message":"Socket disconnected:"}

    [0m [90m 1214 |[39m       }
     [90m 1215 |[39m
    [31m[1m>[22m[39m[90m 1216 |[39m       logger[33m.[39minfo([32m'Socket disconnected:'[39m[33m,[39m {
     [90m      |[39m              [31m[1m^[22m[39m
     [90m 1217 |[39m         socketId[33m:[39m socket[33m.[39mid[33m,[39m
     [90m 1218 |[39m         reason[33m,[39m
     [90m 1219 |[39m         userId[33m:[39m socket[33m.[39mdata[33m?[39m[33m.[39muserInfo[33m?[39m[33m.[39mid [33m||[39m userId[33m,[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as info] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at Socket.<anonymous> (src/web-socket/index.ts:1216:14)
      at Socket.emitReserved (node_modules/socket.io/dist/typed-events.js:56:22)
      at Socket._onclose (node_modules/socket.io/dist/socket.js:554:14)
      at Socket.ondisconnect (node_modules/socket.io/dist/socket.js:513:14)
      at Socket._onpacket (node_modules/socket.io/dist/socket.js:442:22)
      at node_modules/socket.io/dist/client.js:214:24

  console.log
    [SOCKET] Socket disconnected: client namespace disconnect

      at Socket.<anonymous> (src/web-socket/index.ts:1221:15)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"socketId":"qmERa52LaR99oIdzAAAC","reason":"client namespace disconnect","level":"info","message":"Socket disconnected:"}

    [0m [90m 1214 |[39m       }
     [90m 1215 |[39m
    [31m[1m>[22m[39m[90m 1216 |[39m       logger[33m.[39minfo([32m'Socket disconnected:'[39m[33m,[39m {
     [90m      |[39m              [31m[1m^[22m[39m
     [90m 1217 |[39m         socketId[33m:[39m socket[33m.[39mid[33m,[39m
     [90m 1218 |[39m         reason[33m,[39m
     [90m 1219 |[39m         userId[33m:[39m socket[33m.[39mdata[33m?[39m[33m.[39muserInfo[33m?[39m[33m.[39mid [33m||[39m userId[33m,[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as info] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at Socket.<anonymous> (src/web-socket/index.ts:1216:14)
      at Socket.emitReserved (node_modules/socket.io/dist/typed-events.js:56:22)
      at Socket._onclose (node_modules/socket.io/dist/socket.js:554:14)
      at Socket.ondisconnect (node_modules/socket.io/dist/socket.js:513:14)
      at Socket._onpacket (node_modules/socket.io/dist/socket.js:442:22)
      at node_modules/socket.io/dist/client.js:214:24

  console.log
    [SOCKET] Socket disconnected: client namespace disconnect

      at Socket.<anonymous> (src/web-socket/index.ts:1221:15)

FAIL src/web-socket/index.functions.spec.ts (10.922 s)
  web-socket/index.ts [Socket functions]
    √ [addOrderHistory] Should pass and call orderHistory (17 ms)
    × [broadcastOnlineProviders] Should pass and send online providers to all online users (5 ms)

  ● web-socket/index.ts [Socket functions] › [broadcastOnlineProviders] Should pass and send online providers to all online users

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "online-users", Anything

    Number of calls: 0

    [0m [90m 32 |[39m   it([32m'[broadcastOnlineProviders] Should pass and send online providers to all online users'[39m[33m,[39m () [33m=>[39m {
     [90m 33 |[39m     socketFunctions[33m.[39mbroadcastOnlineProvider(mockSocket [36mas[39m any)[33m;[39m
    [31m[1m>[22m[39m[90m 34 |[39m     expect(mockSocket[33m.[39mbroadcast[33m.[39memit)[33m.[39mtoHaveBeenCalledWith([32m'online-users'[39m[33m,[39m expect[33m.[39manything())[33m;[39m
     [90m    |[39m                                       [31m[1m^[22m[39m
     [90m 35 |[39m     expect(mockSocket[33m.[39memit)[33m.[39mtoHaveBeenCalledWith([32m'online-users'[39m[33m,[39m expect[33m.[39manything())[33m;[39m
     [90m 36 |[39m   })[33m;[39m
     [90m 37 |[39m })[33m;[39m[0m

      at Object.<anonymous> (src/web-socket/index.functions.spec.ts:34:39)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"socketId":"-V715fkkDk78HZrQAAAD","reason":"client namespace disconnect","level":"info","message":"Socket disconnected:"}

    [0m [90m 1214 |[39m       }
     [90m 1215 |[39m
    [31m[1m>[22m[39m[90m 1216 |[39m       logger[33m.[39minfo([32m'Socket disconnected:'[39m[33m,[39m {
     [90m      |[39m              [31m[1m^[22m[39m
     [90m 1217 |[39m         socketId[33m:[39m socket[33m.[39mid[33m,[39m
     [90m 1218 |[39m         reason[33m,[39m
     [90m 1219 |[39m         userId[33m:[39m socket[33m.[39mdata[33m?[39m[33m.[39muserInfo[33m?[39m[33m.[39mid [33m||[39m userId[33m,[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as info] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at Socket.<anonymous> (src/web-socket/index.ts:1216:14)
      at Socket.emitReserved (node_modules/socket.io/dist/typed-events.js:56:22)
      at Socket._onclose (node_modules/socket.io/dist/socket.js:554:14)
      at Socket.ondisconnect (node_modules/socket.io/dist/socket.js:513:14)
      at Socket._onpacket (node_modules/socket.io/dist/socket.js:442:22)
      at node_modules/socket.io/dist/client.js:214:24

  console.log
    [SOCKET] Socket disconnected: client namespace disconnect

      at Socket.<anonymous> (src/web-socket/index.ts:1221:15)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"socketId":"Fw85ZPGoL5ptnkF7AAAJ","reason":"client namespace disconnect","level":"info","message":"Socket disconnected:"}

    [0m [90m 1214 |[39m       }
     [90m 1215 |[39m
    [31m[1m>[22m[39m[90m 1216 |[39m       logger[33m.[39minfo([32m'Socket disconnected:'[39m[33m,[39m {
     [90m      |[39m              [31m[1m^[22m[39m
     [90m 1217 |[39m         socketId[33m:[39m socket[33m.[39mid[33m,[39m
     [90m 1218 |[39m         reason[33m,[39m
     [90m 1219 |[39m         userId[33m:[39m socket[33m.[39mdata[33m?[39m[33m.[39muserInfo[33m?[39m[33m.[39mid [33m||[39m userId[33m,[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as info] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at Socket.<anonymous> (src/web-socket/index.ts:1216:14)
      at Socket.emitReserved (node_modules/socket.io/dist/typed-events.js:56:22)
      at Socket._onclose (node_modules/socket.io/dist/socket.js:554:14)
      at Socket.ondisconnect (node_modules/socket.io/dist/socket.js:513:14)
      at Socket._onpacket (node_modules/socket.io/dist/socket.js:442:22)
      at node_modules/socket.io/dist/client.js:214:24

  console.log
    [SOCKET] Socket disconnected: client namespace disconnect

      at Socket.<anonymous> (src/web-socket/index.ts:1221:15)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"socketId":"ZsiYtUPJm-lyHjOrAAAM","level":"info","message":"Socket connected successfully"}

    [0m [90m 984 |[39m     [90m// inject user id coming from socket[39m
     [90m 985 |[39m     socket[33m.[39mdata[33m.[39muserInfo [33m=[39m socket[33m.[39mhandshake[33m.[39mauth[[32m'userInfo'[39m][33m;[39m
    [31m[1m>[22m[39m[90m 986 |[39m     logger[33m.[39minfo([32m'Socket connected successfully'[39m[33m,[39m {
     [90m     |[39m            [31m[1m^[22m[39m
     [90m 987 |[39m       socketId[33m:[39m socket[33m.[39mid[33m,[39m
     [90m 988 |[39m       userId[33m:[39m socket[33m.[39mdata[33m.[39muserInfo[33m?[39m[33m.[39mid[33m,[39m
     [90m 989 |[39m     })[33m;[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as info] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at Array.<anonymous> (src/web-socket/index.ts:986:12)
      at run (node_modules/socket.io/dist/namespace.js:130:19)
      at Namespace.run (node_modules/socket.io/dist/namespace.js:141:9)
      at Namespace._add (node_modules/socket.io/dist/namespace.js:218:14)

  console.log
    user undefined

      at Namespace.<anonymous> (src/web-socket/index.ts:1003:11)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"socketId":"Km62Mel7772Hmmn_AAAN","level":"info","message":"Socket connected successfully"}

    [0m [90m 984 |[39m     [90m// inject user id coming from socket[39m
     [90m 985 |[39m     socket[33m.[39mdata[33m.[39muserInfo [33m=[39m socket[33m.[39mhandshake[33m.[39mauth[[32m'userInfo'[39m][33m;[39m
    [31m[1m>[22m[39m[90m 986 |[39m     logger[33m.[39minfo([32m'Socket connected successfully'[39m[33m,[39m {
     [90m     |[39m            [31m[1m^[22m[39m
     [90m 987 |[39m       socketId[33m:[39m socket[33m.[39mid[33m,[39m
     [90m 988 |[39m       userId[33m:[39m socket[33m.[39mdata[33m.[39muserInfo[33m?[39m[33m.[39mid[33m,[39m
     [90m 989 |[39m     })[33m;[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as info] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at Array.<anonymous> (src/web-socket/index.ts:986:12)
      at run (node_modules/socket.io/dist/namespace.js:130:19)
      at Namespace.run (node_modules/socket.io/dist/namespace.js:141:9)
      at Namespace._add (node_modules/socket.io/dist/namespace.js:218:14)

  console.log
    user undefined

      at Namespace.<anonymous> (src/web-socket/index.ts:1003:11)

  console.log
    Start 3

      at Object.<anonymous> (src/web-socket/index.spec.ts:229:13)

  console.log
    No enough args  {
      args: {
        latitude: 10,
        longitude: 10,
        notifcationToken: '',
        providerId: 0,
        status: 'Online',
        userId: 1,
        uuid: 'Km62Mel7772Hmmn_AAAN',
        moduleId: 1
      }
    }

      at Socket.<anonymous> (src/web-socket/index.ts:1245:19)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"socketId":"ZsiYtUPJm-lyHjOrAAAM","reason":"client namespace disconnect","level":"info","message":"Socket disconnected:"}

    [0m [90m 1214 |[39m       }
     [90m 1215 |[39m
    [31m[1m>[22m[39m[90m 1216 |[39m       logger[33m.[39minfo([32m'Socket disconnected:'[39m[33m,[39m {
     [90m      |[39m              [31m[1m^[22m[39m
     [90m 1217 |[39m         socketId[33m:[39m socket[33m.[39mid[33m,[39m
     [90m 1218 |[39m         reason[33m,[39m
     [90m 1219 |[39m         userId[33m:[39m socket[33m.[39mdata[33m?[39m[33m.[39muserInfo[33m?[39m[33m.[39mid [33m||[39m userId[33m,[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as info] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at Socket.<anonymous> (src/web-socket/index.ts:1216:14)
      at Socket.emitReserved (node_modules/socket.io/dist/typed-events.js:56:22)
      at Socket._onclose (node_modules/socket.io/dist/socket.js:554:14)
      at Socket.ondisconnect (node_modules/socket.io/dist/socket.js:513:14)
      at Socket._onpacket (node_modules/socket.io/dist/socket.js:442:22)
      at node_modules/socket.io/dist/client.js:214:24

  console.log
    [SOCKET] Socket disconnected: client namespace disconnect

      at Socket.<anonymous> (src/web-socket/index.ts:1221:15)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"socketId":"-LpSDO9aTE8kh2viAAAQ","level":"info","message":"Socket connected successfully"}

    [0m [90m 984 |[39m     [90m// inject user id coming from socket[39m
     [90m 985 |[39m     socket[33m.[39mdata[33m.[39muserInfo [33m=[39m socket[33m.[39mhandshake[33m.[39mauth[[32m'userInfo'[39m][33m;[39m
    [31m[1m>[22m[39m[90m 986 |[39m     logger[33m.[39minfo([32m'Socket connected successfully'[39m[33m,[39m {
     [90m     |[39m            [31m[1m^[22m[39m
     [90m 987 |[39m       socketId[33m:[39m socket[33m.[39mid[33m,[39m
     [90m 988 |[39m       userId[33m:[39m socket[33m.[39mdata[33m.[39muserInfo[33m?[39m[33m.[39mid[33m,[39m
     [90m 989 |[39m     })[33m;[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as info] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at Array.<anonymous> (src/web-socket/index.ts:986:12)
      at run (node_modules/socket.io/dist/namespace.js:130:19)
      at Namespace.run (node_modules/socket.io/dist/namespace.js:141:9)
      at Namespace._add (node_modules/socket.io/dist/namespace.js:218:14)

  console.log
    user undefined

      at Namespace.<anonymous> (src/web-socket/index.ts:1003:11)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"socketId":"t12X42WrvbOXyjgKAAAR","level":"info","message":"Socket connected successfully"}

    [0m [90m 984 |[39m     [90m// inject user id coming from socket[39m
     [90m 985 |[39m     socket[33m.[39mdata[33m.[39muserInfo [33m=[39m socket[33m.[39mhandshake[33m.[39mauth[[32m'userInfo'[39m][33m;[39m
    [31m[1m>[22m[39m[90m 986 |[39m     logger[33m.[39minfo([32m'Socket connected successfully'[39m[33m,[39m {
     [90m     |[39m            [31m[1m^[22m[39m
     [90m 987 |[39m       socketId[33m:[39m socket[33m.[39mid[33m,[39m
     [90m 988 |[39m       userId[33m:[39m socket[33m.[39mdata[33m.[39muserInfo[33m?[39m[33m.[39mid[33m,[39m
     [90m 989 |[39m     })[33m;[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as info] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at Array.<anonymous> (src/web-socket/index.ts:986:12)
      at run (node_modules/socket.io/dist/namespace.js:130:19)
      at Namespace.run (node_modules/socket.io/dist/namespace.js:141:9)
      at Namespace._add (node_modules/socket.io/dist/namespace.js:218:14)

  console.log
    user undefined

      at Namespace.<anonymous> (src/web-socket/index.ts:1003:11)

  console.log
    Start 4

      at Object.<anonymous> (src/web-socket/index.spec.ts:246:13)

  console.log
    [SOCKET - Broadcast online providers] Broadcasting online providers, Total Online Providers : 1

      at broadcastOnlineProvider (src/web-socket/index.ts:502:11)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"socketId":"Km62Mel7772Hmmn_AAAN","reason":"client namespace disconnect","level":"info","message":"Socket disconnected:"}

    [0m [90m 1214 |[39m       }
     [90m 1215 |[39m
    [31m[1m>[22m[39m[90m 1216 |[39m       logger[33m.[39minfo([32m'Socket disconnected:'[39m[33m,[39m {
     [90m      |[39m              [31m[1m^[22m[39m
     [90m 1217 |[39m         socketId[33m:[39m socket[33m.[39mid[33m,[39m
     [90m 1218 |[39m         reason[33m,[39m
     [90m 1219 |[39m         userId[33m:[39m socket[33m.[39mdata[33m?[39m[33m.[39muserInfo[33m?[39m[33m.[39mid [33m||[39m userId[33m,[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as info] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at Socket.<anonymous> (src/web-socket/index.ts:1216:14)
      at Socket.emitReserved (node_modules/socket.io/dist/typed-events.js:56:22)
      at Socket._onclose (node_modules/socket.io/dist/socket.js:554:14)
      at Socket.ondisconnect (node_modules/socket.io/dist/socket.js:513:14)
      at Socket._onpacket (node_modules/socket.io/dist/socket.js:442:22)
      at node_modules/socket.io/dist/client.js:214:24

  console.log
    [SOCKET] Socket disconnected: client namespace disconnect

      at Socket.<anonymous> (src/web-socket/index.ts:1221:15)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"error":{"status":422,"additionalParameters":"Email not verified"},"stack":"Error: Email not verified\n    at login (K:\\0-CarWashProject\\api\\src\\controllers\\users\\login.controller.ts:132:13)\n    at Object.<anonymous> (K:\\0-CarWashProject\\api\\src\\controllers\\users\\login.controller.spec.ts:105:5)","context":"Login Controller","timestamp":"2025-08-24T13:36:36.776Z","email":"1","level":"error","message":"[Login Controller] Email not verified"}

    [0m [90m 228 |[39m     }
     [90m 229 |[39m
    [31m[1m>[22m[39m[90m 230 |[39m     enhancedLogger[33m.[39merror([32m`${context ? `[${context}] ` : ''}${error.message}`[39m[33m,[39m {
     [90m     |[39m                    [31m[1m^[22m[39m
     [90m 231 |[39m       error[33m:[39m {
     [90m 232 |[39m         name[33m:[39m error[33m.[39mname[33m,[39m
     [90m 233 |[39m         message[33m:[39m error[33m.[39mmessage[33m,[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as error] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at Object.logError (src/utils/logger.ts:230:20)
      at login (src/controllers/users/login.controller.ts:210:17)
      at Object.<anonymous> (src/controllers/users/login.controller.spec.ts:105:5)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"error":{"status":422,"additionalParameters":"Email not verified"},"stack":"Error: Email not verified\n    at login (K:\\0-CarWashProject\\api\\src\\controllers\\users\\login.controller.ts:132:13)\n    at Object.<anonymous> (K:\\0-CarWashProject\\api\\src\\controllers\\users\\login.controller.spec.ts:135:5)","context":"Login Controller","timestamp":"2025-08-24T13:36:37.093Z","email":"1","level":"error","message":"[Login Controller] Email not verified"}

    [0m [90m 228 |[39m     }
     [90m 229 |[39m
    [31m[1m>[22m[39m[90m 230 |[39m     enhancedLogger[33m.[39merror([32m`${context ? `[${context}] ` : ''}${error.message}`[39m[33m,[39m {
     [90m     |[39m                    [31m[1m^[22m[39m
     [90m 231 |[39m       error[33m:[39m {
     [90m 232 |[39m         name[33m:[39m error[33m.[39mname[33m,[39m
     [90m 233 |[39m         message[33m:[39m error[33m.[39mmessage[33m,[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as error] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at Object.logError (src/utils/logger.ts:230:20)
      at login (src/controllers/users/login.controller.ts:210:17)
      at Object.<anonymous> (src/controllers/users/login.controller.spec.ts:135:5)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"error":{"status":422,"additionalParameters":"Email not verified"},"stack":"Error: Email not verified\n    at login (K:\\0-CarWashProject\\api\\src\\controllers\\users\\login.controller.ts:132:13)\n    at Object.<anonymous> (K:\\0-CarWashProject\\api\\src\\controllers\\users\\login.controller.spec.ts:169:5)","context":"Login Controller","timestamp":"2025-08-24T13:36:37.413Z","email":"1","level":"error","message":"[Login Controller] Email not verified"}

    [0m [90m 228 |[39m     }
     [90m 229 |[39m
    [31m[1m>[22m[39m[90m 230 |[39m     enhancedLogger[33m.[39merror([32m`${context ? `[${context}] ` : ''}${error.message}`[39m[33m,[39m {
     [90m     |[39m                    [31m[1m^[22m[39m
     [90m 231 |[39m       error[33m:[39m {
     [90m 232 |[39m         name[33m:[39m error[33m.[39mname[33m,[39m
     [90m 233 |[39m         message[33m:[39m error[33m.[39mmessage[33m,[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as error] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at Object.logError (src/utils/logger.ts:230:20)
      at login (src/controllers/users/login.controller.ts:210:17)
      at Object.<anonymous> (src/controllers/users/login.controller.spec.ts:169:5)

FAIL src/controllers/users/login.controller.spec.ts (11.857 s)
  users/login
    √ Should return fail because password is incorrect (362 ms)
    √ Should return fail because no user found (4 ms)
    × Should return fail because allowed clients is not right (316 ms)
    × Should succeed (324 ms)
    × Should succeed and return isUserActive as atrue (317 ms)
    × Should succeed and return isUserActive as true and document fullfilled true (320 ms)

  ● users/login › Should return fail because allowed clients is not right

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

      {"_addBody": [Function _addBody], "_events": {}, "_eventsCount": 0, "_maxListeners": undefined, "_setBaseUrl": [Function _setBaseUrl], "_setBody": [Function _setBody], "_setCookiesVariable": [Function _setCookiesVariable], "_setFilesVariable": [Function _setFilesVariable], "_setHeadersVariable": [Function _setHeadersVariable], "_setMethod": [Function _setMethod], "_setOriginalUrl": [Function _setOriginalUrl], "_setParameter": [Function _setParameter], "_setSessionVariable": [Function _setSessionVariable], "_setSignedCookiesVariable": [Function _setSignedCookiesVariable], "_setURL": [Function _setURL], "accepts": [Function acceptsTypes], "acceptsCharsets": [Function acceptsCharsets], "acceptsEncodings": [Function acceptsEncodings], "acceptsLanguages": [Function acceptsLanguages], "baseUrl": "", "body": {"email": "1", "password": "1"}, "cookies": {}, "destroy": [Function anonymous], "files": {}, "get": [Function getHeader], "getHeader": [Function getHeader], "header": [Function getHeader], "headers": {"allowed-client": "U2FsdGVkX19yIFZOGOgAtoOuBv2pgI4eGsNM1H4IGT8="}, "hostname": "", "ip": "127.0.0.1", "ips": ["127.0.0.1"], "is": [Function isContentType], "logger": {"error": [Function mockConstructor], "info": [Function mockConstructor], "warn": [Function mockConstructor]}, "method": "GET", "originalUrl": "", "param": [Function param], "params": {}, "path": "", "prisma": undefined, "query": {}, "range": [Function isRange], "send": [Function send], "socket": {}, "subdomains": [], "url": "", "user": {}, Symbol(shapeMode): false, Symbol(kCapture): false, Symbol(Symbol.asyncIterator): [Function asyncIterator]},
      {"_getBuffer": [Function _getBuffer], "_getChunks": [Function _getChunks], "_getData": [Function _getData], "_getHeaders": [Function _getHeaders], "_getJSONData": [Function _getJSONData], "_getLocals": [Function _getLocals], "_getRedirectUrl": [Function _getRedirectUrl], "_getRenderData": [Function _getRenderData], "_getRenderView": [Function _getRenderView], "_getStatusCode": [Function _getStatusCode], "_getStatusMessage": [Function _getStatusMessage], "_headers": {}, "_isDataLengthValid": [Function _isDataLengthValid], "_isEndCalled": [Function _isEndCalled], "_isJSON": [Function _isJSON], "_isUTF8": [Function _isUTF8], "append": [Function append], "appendHeader": [Function appendHeader], "attachment": [Function attachment], "clearCookie": [Function clearCookie], "contentType": [Function contentType], "cookie": [Function cookie], "cookies": {}, "destroy": [Function destroy], "destroySoon": [Function destroySoon], "end": [Function end], "finished": false, "format": [Function format], "get": [Function getHeader], "getEncoding": [Function getEncoding], "getHeader": [Function getHeader], "getHeaderNames": [Function getHeaderNames], "getHeaders": [Function getHeaders], "hasHeader": [Function hasHeader], "header": [Function header], "headersSent": false, "json": [Function json], "jsonp": [Function jsonp], "locals": {}, "location": [Function setLocation], "redirect": [Function redirect], "removeHeader": [Function removeHeader], "render": [Function render], "send": [Function send], "sendStatus": [Function sendStatus], "set": [Function header], "setEncoding": [Function setEncoding], "setHeader": [Function setHeader], "status": [Function status], "statusCode": 200, "statusMessage": "OK", "type": [Function contentType], "vary": [Function vary], "writableEnded": false, "writableFinished": false, "write": [Function write], "writeHead": [Function writeHead]},
    - [Error: No sufficient permission],
    + [Error: Email not verified],
      [Function mockConstructor],

    Number of calls: 1

    [0m [90m 75 |[39m
     [90m 76 |[39m     expect(createFailResponse)[33m.[39mtoHaveBeenCalledTimes([35m1[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 77 |[39m     expect(createFailResponse)[33m.[39mtoHaveBeenCalledWith(
     [90m    |[39m                                [31m[1m^[22m[39m
     [90m 78 |[39m       global[33m.[39mmockReq[33m,[39m
     [90m 79 |[39m       global[33m.[39mmockRes[33m,[39m
     [90m 80 |[39m[0m

      at Object.<anonymous> (src/controllers/users/login.controller.spec.ts:77:32)

  ● users/login › Should succeed

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

    [0m [90m 105 |[39m     [36mawait[39m login(global[33m.[39mmockReq[33m,[39m global[33m.[39mmockRes[33m,[39m global[33m.[39mmockNext)[33m;[39m
     [90m 106 |[39m
    [31m[1m>[22m[39m[90m 107 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledTimes([35m1[39m)[33m;[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 108 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledWith(
     [90m 109 |[39m       global[33m.[39mmockReq[33m,[39m
     [90m 110 |[39m       global[33m.[39mmockRes[33m,[39m[0m

      at Object.<anonymous> (src/controllers/users/login.controller.spec.ts:107:35)

  ● users/login › Should succeed and return isUserActive as atrue

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

    [0m [90m 135 |[39m     [36mawait[39m login(global[33m.[39mmockReq[33m,[39m global[33m.[39mmockRes[33m,[39m global[33m.[39mmockNext)[33m;[39m
     [90m 136 |[39m
    [31m[1m>[22m[39m[90m 137 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledTimes([35m1[39m)[33m;[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 138 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledWith(
     [90m 139 |[39m       global[33m.[39mmockReq[33m,[39m
     [90m 140 |[39m       global[33m.[39mmockRes[33m,[39m[0m

      at Object.<anonymous> (src/controllers/users/login.controller.spec.ts:137:35)

  ● users/login › Should succeed and return isUserActive as true and document fullfilled true

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

    [0m [90m 169 |[39m     [36mawait[39m login(global[33m.[39mmockReq[33m,[39m global[33m.[39mmockRes[33m,[39m global[33m.[39mmockNext)[33m;[39m
     [90m 170 |[39m     [32m``[39m[33m;[39m
    [31m[1m>[22m[39m[90m 171 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledTimes([35m1[39m)[33m;[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 172 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledWith(
     [90m 173 |[39m       global[33m.[39mmockReq[33m,[39m
     [90m 174 |[39m       global[33m.[39mmockRes[33m,[39m[0m

      at Object.<anonymous> (src/controllers/users/login.controller.spec.ts:171:35)

  console.error
    Send message error: Error: Order not found
        at Proxy.<anonymous> (K:\0-CarWashProject\api\src\web-socket\orderChat.spec.ts:377:31)
        at K:\0-CarWashProject\api\node_modules\jest-mock\build\index.js:397:39
        at Proxy.<anonymous> (K:\0-CarWashProject\api\node_modules\jest-mock\build\index.js:404:13)
        at Proxy.mockConstructor (K:\0-CarWashProject\api\node_modules\jest-mock\build\index.js:148:19)
        at sendMessage (K:\0-CarWashProject\api\src\web-socket\chatSocket.ts:141:48)
        at Socket.<anonymous> (K:\0-CarWashProject\api\src\web-socket\orderChat.spec.ts:183:43)
        at Socket.emit (node:events:518:28)
        at Socket.emitUntyped (K:\0-CarWashProject\api\node_modules\socket.io\dist\typed-events.js:69:22)
        at K:\0-CarWashProject\api\node_modules\socket.io\dist\socket.js:697:39
        at processTicksAndRejections (node:internal/process/task_queues:85:11)

    [0m [90m 193 |[39m     }[33m;[39m
     [90m 194 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 195 |[39m     console[33m.[39merror([32m'Send message error:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 196 |[39m     [36mreturn[39m [36mnull[39m[33m;[39m
     [90m 197 |[39m   }
     [90m 198 |[39m }[0m

      at sendMessage (src/web-socket/chatSocket.ts:195:13)
      at Socket.<anonymous> (src/web-socket/orderChat.spec.ts:183:26)

  console.error
    Send message error: Error: Order not found
        at Proxy.<anonymous> (K:\0-CarWashProject\api\src\web-socket\orderChat.spec.ts:377:31)
        at K:\0-CarWashProject\api\node_modules\jest-mock\build\index.js:397:39
        at Proxy.<anonymous> (K:\0-CarWashProject\api\node_modules\jest-mock\build\index.js:404:13)
        at Proxy.mockConstructor (K:\0-CarWashProject\api\node_modules\jest-mock\build\index.js:148:19)
        at sendMessage (K:\0-CarWashProject\api\src\web-socket\chatSocket.ts:141:48)
        at Socket.<anonymous> (K:\0-CarWashProject\api\src\web-socket\orderChat.spec.ts:183:43)
        at Socket.emit (node:events:518:28)
        at Socket.emitUntyped (K:\0-CarWashProject\api\node_modules\socket.io\dist\typed-events.js:69:22)
        at K:\0-CarWashProject\api\node_modules\socket.io\dist\socket.js:697:39
        at processTicksAndRejections (node:internal/process/task_queues:85:11)

    [0m [90m 193 |[39m     }[33m;[39m
     [90m 194 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 195 |[39m     console[33m.[39merror([32m'Send message error:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 196 |[39m     [36mreturn[39m [36mnull[39m[33m;[39m
     [90m 197 |[39m   }
     [90m 198 |[39m }[0m

      at sendMessage (src/web-socket/chatSocket.ts:195:13)
      at Socket.<anonymous> (src/web-socket/orderChat.spec.ts:183:26)

  console.log
    Chat: User 2 disconnected

      at handleUserDisconnect (src/web-socket/chatSocket.ts:282:11)
          at Map.forEach (<anonymous>)
          at Array.map (<anonymous>)

  console.log
    Chat: User 1 disconnected

      at handleUserDisconnect (src/web-socket/chatSocket.ts:282:11)
          at Map.forEach (<anonymous>)
          at Array.map (<anonymous>)

FAIL src/web-socket/orderChat.spec.ts (13.493 s)
  OrderChatHandler
    Authentication
      √ should authenticate customer successfully (64 ms)
      √ should authenticate provider successfully (3 ms)
      √ should fail authentication for invalid user (1 ms)
    Order Chat
      √ should allow customer to join order chat (6 ms)
      √ should allow provider to join order chat (4 ms)
      √ should notify when user joins order chat (4 ms)
      √ should send and receive messages in order chat (115 ms)
      √ should handle typing indicators (109 ms)
      √ should auto-stop typing after timeout (3121 ms)
      √ should retrieve chat history (1 ms)
      √ should prevent unauthorized users from joining order chat (16 ms)
    Online Status
      √ should broadcast online status when user authenticates (1 ms)
      √ should track online users correctly
    System Messages
      √ should send system messages to order chat (1 ms)
    Error Handling
      × should handle database errors gracefully (40 ms)
      √ should handle invalid order IDs (3 ms)

  ● OrderChatHandler › Error Handling › should handle database errors gracefully

    Expected done to be called once, but it was called multiple times.

    [0m [90m 694 |[39m           clientSocket1[33m.[39moff([32m'chat-error'[39m[33m,[39m onError)[33m;[39m [90m// Remove listener after first call[39m
     [90m 695 |[39m           clientSocket1[33m.[39moff([32m'chat-authenticated'[39m[33m,[39m onAuthenticated)[33m;[39m [90m// Clean up[39m
    [31m[1m>[22m[39m[90m 696 |[39m           done()[33m;[39m
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 697 |[39m         }[33m;[39m
     [90m 698 |[39m         clientSocket1[33m.[39mon([32m'chat-error'[39m[33m,[39m onError)[33m;[39m
     [90m 699 |[39m       }[33m;[39m[0m

      at Socket.onError (src/web-socket/orderChat.spec.ts:696:11)
      at Socket.Object.<anonymous>.Emitter.emit (node_modules/@socket.io/component-emitter/lib/cjs/index.js:143:20)
      at Socket.emitEvent (node_modules/socket.io-client/build/cjs/socket.js:559:20)
      at Socket.onevent (node_modules/socket.io-client/build/cjs/socket.js:546:18)
      at Socket.onpacket (node_modules/socket.io-client/build/cjs/socket.js:514:22)
      at Manager.Object.<anonymous>.Emitter.emit (node_modules/@socket.io/component-emitter/lib/cjs/index.js:143:20)
      at node_modules/socket.io-client/build/cjs/manager.js:246:18

  ● OrderChatHandler › Error Handling › should handle database errors gracefully

    Expected done to be called once, but it was called multiple times.

    [0m [90m 694 |[39m           clientSocket1[33m.[39moff([32m'chat-error'[39m[33m,[39m onError)[33m;[39m [90m// Remove listener after first call[39m
     [90m 695 |[39m           clientSocket1[33m.[39moff([32m'chat-authenticated'[39m[33m,[39m onAuthenticated)[33m;[39m [90m// Clean up[39m
    [31m[1m>[22m[39m[90m 696 |[39m           done()[33m;[39m
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 697 |[39m         }[33m;[39m
     [90m 698 |[39m         clientSocket1[33m.[39mon([32m'chat-error'[39m[33m,[39m onError)[33m;[39m
     [90m 699 |[39m       }[33m;[39m[0m

      at Socket.onError (src/web-socket/orderChat.spec.ts:696:11)
      at Socket.Object.<anonymous>.Emitter.emit (node_modules/@socket.io/component-emitter/lib/cjs/index.js:143:20)
      at Socket.emitEvent (node_modules/socket.io-client/build/cjs/socket.js:559:20)
      at Socket.onevent (node_modules/socket.io-client/build/cjs/socket.js:546:18)
      at Socket.onpacket (node_modules/socket.io-client/build/cjs/socket.js:514:22)
      at Manager.Object.<anonymous>.Emitter.emit (node_modules/@socket.io/component-emitter/lib/cjs/index.js:143:20)
      at node_modules/socket.io-client/build/cjs/manager.js:246:18

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"socketId":"-LpSDO9aTE8kh2viAAAQ","reason":"client namespace disconnect","level":"info","message":"Socket disconnected:"}

    [0m [90m 1214 |[39m       }
     [90m 1215 |[39m
    [31m[1m>[22m[39m[90m 1216 |[39m       logger[33m.[39minfo([32m'Socket disconnected:'[39m[33m,[39m {
     [90m      |[39m              [31m[1m^[22m[39m
     [90m 1217 |[39m         socketId[33m:[39m socket[33m.[39mid[33m,[39m
     [90m 1218 |[39m         reason[33m,[39m
     [90m 1219 |[39m         userId[33m:[39m socket[33m.[39mdata[33m?[39m[33m.[39muserInfo[33m?[39m[33m.[39mid [33m||[39m userId[33m,[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as info] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at Socket.<anonymous> (src/web-socket/index.ts:1216:14)
      at Socket.emitReserved (node_modules/socket.io/dist/typed-events.js:56:22)
      at Socket._onclose (node_modules/socket.io/dist/socket.js:554:14)
      at Socket.ondisconnect (node_modules/socket.io/dist/socket.js:513:14)
      at Socket._onpacket (node_modules/socket.io/dist/socket.js:442:22)
      at node_modules/socket.io/dist/client.js:214:24

  console.log
    [SOCKET] Socket disconnected: client namespace disconnect

      at Socket.<anonymous> (src/web-socket/index.ts:1221:15)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"socketId":"t12X42WrvbOXyjgKAAAR","reason":"client namespace disconnect","level":"info","message":"Socket disconnected:"}

    [0m [90m 1214 |[39m       }
     [90m 1215 |[39m
    [31m[1m>[22m[39m[90m 1216 |[39m       logger[33m.[39minfo([32m'Socket disconnected:'[39m[33m,[39m {
     [90m      |[39m              [31m[1m^[22m[39m
     [90m 1217 |[39m         socketId[33m:[39m socket[33m.[39mid[33m,[39m
     [90m 1218 |[39m         reason[33m,[39m
     [90m 1219 |[39m         userId[33m:[39m socket[33m.[39mdata[33m?[39m[33m.[39muserInfo[33m?[39m[33m.[39mid [33m||[39m userId[33m,[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as info] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at Socket.<anonymous> (src/web-socket/index.ts:1216:14)
      at Socket.emitReserved (node_modules/socket.io/dist/typed-events.js:56:22)
      at Socket._onclose (node_modules/socket.io/dist/socket.js:554:14)
      at Socket.ondisconnect (node_modules/socket.io/dist/socket.js:513:14)
      at Socket._onpacket (node_modules/socket.io/dist/socket.js:442:22)
      at node_modules/socket.io/dist/client.js:214:24

  console.log
    [SOCKET] Socket disconnected: client namespace disconnect

      at Socket.<anonymous> (src/web-socket/index.ts:1221:15)

  console.log
    user undefined

      at Namespace.<anonymous> (src/web-socket/index.ts:1003:11)

  console.log
    user undefined

      at Namespace.<anonymous> (src/web-socket/index.ts:1003:11)

  console.log
    Start 5

      at Object.<anonymous> (src/web-socket/index.spec.ts:256:13)

  console.log
    [SOCKET] [Provider] [Update] => Update provider {"newValues":{"uuid":"ksLDhTX64-uTkbUTAAAV","notifcationToken":"","status":"Online"},"searchKey":"userId","searchValue":1}

      at updateProvider (src/web-socket/index.ts:663:11)

  console.log
    [SOCKET - Broadcast online providers] Broadcasting online providers, Total Online Providers : 1

      at broadcastOnlineProvider (src/web-socket/index.ts:502:11)

  console.log
    [SOCKET] [Provider] [Remove] => Remove provider {"searchKey":"uuid","searchValue":"ksLDhTX64-uTkbUTAAAV"}

      at removeProvider (src/web-socket/index.ts:682:11)

  console.log
    [SOCKET - Broadcast online providers] Broadcasting online providers, Total Online Providers : 0

      at broadcastOnlineProvider (src/web-socket/index.ts:502:11)

  console.log
    [SOCKET] Socket disconnected: client namespace disconnect

      at Socket.<anonymous> (src/web-socket/index.ts:1221:15)

  console.log
    [SOCKET] Socket disconnected: client namespace disconnect

      at Socket.<anonymous> (src/web-socket/index.ts:1221:15)

  console.log
    user undefined

      at Namespace.<anonymous> (src/web-socket/index.ts:1003:11)

  console.log
    user undefined

      at Namespace.<anonymous> (src/web-socket/index.ts:1003:11)

  console.log
    Start 6

      at Object.<anonymous> (src/web-socket/index.spec.ts:270:13)

  console.log
    [SOCKET] [Provider] [Add] => Adding new provdider {"newArgs":{"latitude":10,"longitude":10,"notifcationToken":"","providerId":1,"status":"Online","userId":1,"uuid":"htEMcCja7N_IetbRAAAZ","moduleId":1}}

      at addProvider (src/web-socket/index.ts:642:11)

  console.log
    [SOCKET - Broadcast online providers] Broadcasting online providers, Total Online Providers : 1

      at broadcastOnlineProvider (src/web-socket/index.ts:502:11)

  console.log
    [SOCKET] [Order] [Add] => Adding new Order {"newArgs":{"arrivalThreshold":2,"orderPaymentMethod":"Cash","orderSubmissionType":"provider-select","orderTimeoutSeconds":{"seconds":2,"dateAfterAddingSeconds":1756042619729},"customerUuid":"sFadzop29PG_Ur3sAAAY","orderId":123,"customerUserId":1,"customerNotificationToken":"123","providerUserId":1,"providerUuid":"htEMcCja7N_IetbRAAAZ","orderStep":0}}

      at addOrder (src/web-socket/index.ts:712:11)

  console.log
    [SOCKET] [NEW-ORDER] Scheduling timeout job {
      orderId: 123,
      providerId: 1,
      timeoutSeconds: 2,
      timeoutDate: 2025-08-24T13:36:59.730Z,
      jobId: 'order-timeout-123'
    }

      at Socket.<anonymous> (src/web-socket/index.ts:1404:17)

  console.log
    [SOCKET] Socket disconnected: client namespace disconnect

      at Socket.<anonymous> (src/web-socket/index.ts:1221:15)

  console.log
    [SOCKET] Socket disconnected: client namespace disconnect

      at Socket.<anonymous> (src/web-socket/index.ts:1221:15)

  console.log
    user undefined

      at Namespace.<anonymous> (src/web-socket/index.ts:1003:11)

  console.log
    user undefined

      at Namespace.<anonymous> (src/web-socket/index.ts:1003:11)

  console.log
    [SOCKET] [Provider] [Add] => Adding new provdider {"newArgs":{"latitude":10,"longitude":10,"notifcationToken":"","providerId":24234222,"status":"Online","userId":1,"uuid":"h7JfnP0ztELN2KimAAAd","moduleId":1}}

      at addProvider (src/web-socket/index.ts:642:11)

  console.log
    [SOCKET - Broadcast online providers] Broadcasting online providers, Total Online Providers : 1

      at broadcastOnlineProvider (src/web-socket/index.ts:502:11)

  console.log
    [SOCKET] Socket disconnected: client namespace disconnect

      at Socket.<anonymous> (src/web-socket/index.ts:1221:15)

  console.log
    [SOCKET] Socket disconnected: client namespace disconnect

      at Socket.<anonymous> (src/web-socket/index.ts:1221:15)

  console.log
    user undefined

      at Namespace.<anonymous> (src/web-socket/index.ts:1003:11)

  console.log
    user undefined

      at Namespace.<anonymous> (src/web-socket/index.ts:1003:11)

  console.log
    [SOCKET] [Provider] [Add] => Adding new provdider {"newArgs":{"latitude":10,"longitude":10,"notifcationToken":"","providerId":1,"status":"Online","userId":1,"uuid":"PVFfBLhTsJnd4HLFAAAh","moduleId":1}}

      at addProvider (src/web-socket/index.ts:642:11)

  console.log
    [SOCKET - Broadcast online providers] Broadcasting online providers, Total Online Providers : 1

      at broadcastOnlineProvider (src/web-socket/index.ts:502:11)

  console.log
    [SOCKET] Customer already has an order that is not accepted by provider

      at Socket.<anonymous> (src/web-socket/index.ts:1350:21)

  console.log
    [SOCKET] [Order] [Remove] => Remove Order {"searchKey":"orderId","searchValue":123}

      at removeOrder (src/web-socket/index.ts:747:11)

  console.log
    [SOCKET] [Order] [Add] => Adding new Order {"newArgs":{"arrivalThreshold":2,"orderPaymentMethod":"Cash","orderSubmissionType":"provider-select","orderTimeoutSeconds":{"seconds":2,"dateAfterAddingSeconds":1756042620799},"customerUuid":"F3bZ1nreKt1n8QtPAAAg","orderId":123,"customerUserId":1,"customerNotificationToken":"123","providerUserId":1,"providerUuid":"PVFfBLhTsJnd4HLFAAAh","orderStep":0}}

      at addOrder (src/web-socket/index.ts:712:11)

  console.log
    [SOCKET] [NEW-ORDER] Scheduling timeout job {
      orderId: 123,
      providerId: 1,
      timeoutSeconds: 2,
      timeoutDate: 2025-08-24T13:37:00.799Z,
      jobId: 'order-timeout-123'
    }

      at Socket.<anonymous> (src/web-socket/index.ts:1404:17)

  console.log
    [SOCKET] [ORDER-ACCEPT] Order found , OrderID : 123

      at Socket.<anonymous> (src/web-socket/index.ts:1635:17)

  console.log
    [SOCKET] [ORDER-ACCEPT] Cancelled regular timeout job { orderId: 123, regularTimeoutJobId: 'order-timeout-123' }

      at Socket.<anonymous> (src/web-socket/index.ts:1643:19)

  console.log
    [SOCKET] [Provider] [Update] => Update provider {"newValues":{"status":"Have order"},"searchKey":"uuid","searchValue":"PVFfBLhTsJnd4HLFAAAh"}

      at updateProvider (src/web-socket/index.ts:663:11)

  console.log
    [SOCKET - Broadcast online providers] Broadcasting online providers, Total Online Providers : 0

      at broadcastOnlineProvider (src/web-socket/index.ts:502:11)

  console.log
    [SOCKET] [Order] [Update] => Update Order {"newValues":{"orderStep":1},"searchKey":"orderId","searchValue":123}

      at updateOrder (src/web-socket/index.ts:729:11)

  console.log
    [SOCKET] [ORDER-ACCEPT] Provider updated {
      provider: {
        latitude: 10,
        longitude: 10,
        notifcationToken: '',
        providerId: 1,
        status: 'Have order',
        userId: 1,
        uuid: 'PVFfBLhTsJnd4HLFAAAh',
        moduleId: 1
      },
      updatedOrder: {
        arrivalThreshold: 2,
        orderPaymentMethod: 'Cash',
        orderSubmissionType: 'provider-select',
        orderTimeoutSeconds: { seconds: 2, dateAfterAddingSeconds: 1756042620799 },
        customerUuid: 'F3bZ1nreKt1n8QtPAAAg',
        orderId: 123,
        customerUserId: 1,
        customerNotificationToken: '123',
        providerUserId: 1,
        providerUuid: 'PVFfBLhTsJnd4HLFAAAh',
        orderStep: 1
      }
    }

      at Socket.<anonymous> (src/web-socket/index.ts:1708:17)

  console.log
    [SOCKET] [ORDER-ACCEPT] Notifying customer about order acceptance { orderId: 123, providerId: 1, userId: 1, orderStep: 1 }

      at Socket.<anonymous> (src/web-socket/index.ts:1711:19)

  console.error
    System user not found. Please run database seeding.

    [0m [90m 402 |[39m
     [90m 403 |[39m     [36mif[39m ([33m![39msystemUser) {
    [31m[1m>[22m[39m[90m 404 |[39m       console[33m.[39merror([32m'System user not found. Please run database seeding.'[39m)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 405 |[39m
     [90m 406 |[39m       [90m// During tests, fall back to a synthetic system user to avoid failing the test suite[39m
     [90m 407 |[39m       [36mif[39m (process[33m.[39menv[33m.[39m[33mNODE_ENV[39m [33m===[39m [32m'test'[39m [33m||[39m process[33m.[39menv[33m.[39m[33mCI[39m [33m===[39m [32m'true'[39m) {[0m

      at sendSystemMessage (src/web-socket/chatSocket.ts:404:15)

  console.warn
    [TEST] Using fallback system user for sendSystemMessage

    [0m [90m 407 |[39m       [36mif[39m (process[33m.[39menv[33m.[39m[33mNODE_ENV[39m [33m===[39m [32m'test'[39m [33m||[39m process[33m.[39menv[33m.[39m[33mCI[39m [33m===[39m [32m'true'[39m) {
     [90m 408 |[39m         [36mconst[39m fallbackSystemUser[33m:[39m any [33m=[39m { id[33m:[39m [35m999999[39m[33m,[39m [33mFirstName[39m[33m:[39m [32m'System'[39m[33m,[39m [33mLastName[39m[33m:[39m [32m'Bot'[39m }[33m;[39m
    [31m[1m>[22m[39m[90m 409 |[39m         console[33m.[39mwarn([32m'[TEST] Using fallback system user for sendSystemMessage'[39m)[33m;[39m
     [90m     |[39m                 [31m[1m^[22m[39m
     [90m 410 |[39m         systemUser [33m=[39m fallbackSystemUser[33m;[39m
     [90m 411 |[39m       } [36melse[39m {
     [90m 412 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m([32m'System user not found'[39m)[33m;[39m[0m

      at sendSystemMessage (src/web-socket/chatSocket.ts:409:17)

  console.log
    [SOCKET] [NEW-ORDER] Timeout job executing { orderId: 123, providerId: 1, jobId: 'order-timeout-123' }

      at Job.job (src/web-socket/index.ts:1413:19)

  console.log
    [SOCKET] [NEW-ORDER] Timeout job - checking order state {
      orderId: 123,
      orderExists: true,
      orderStep: 1,
      providerExists: true,
      providerId: 1
    }

      at Job.job (src/web-socket/index.ts:1422:19)

  console.log
    [SOCKET] [NEW-ORDER] Timeout job cancelled - order was accepted or removed { orderId: 123, orderExists: true, orderStep: 1, providerId: 1 }

      at Job.job (src/web-socket/index.ts:1452:21)

  console.log
    [SOCKET] Socket disconnected: client namespace disconnect

      at Socket.<anonymous> (src/web-socket/index.ts:1221:15)

  console.log
    [SOCKET] Socket disconnected: client namespace disconnect

      at Socket.<anonymous> (src/web-socket/index.ts:1221:15)

  console.log
    user undefined

      at Namespace.<anonymous> (src/web-socket/index.ts:1003:11)

  console.log
    user undefined

      at Namespace.<anonymous> (src/web-socket/index.ts:1003:11)

  console.log
    [SOCKET] [PROVIDER-ONLINE-START] Checking active session {
      online: {
        latitude: 10,
        longitude: 10,
        notifcationToken: '',
        providerId: 1,
        status: 'Have order',
        userId: 1,
        uuid: 'PVFfBLhTsJnd4HLFAAAh',
        moduleId: 1
      }
    }

      at Socket.<anonymous> (src/web-socket/index.ts:1258:21)

  console.log
    [SOCKET] Restoring active session [ORDER FOUND] {
      order: {
        arrivalThreshold: 2,
        orderPaymentMethod: 'Cash',
        orderSubmissionType: 'provider-select',
        orderTimeoutSeconds: { seconds: 2, dateAfterAddingSeconds: 1756042620799 },
        customerUuid: 'F3bZ1nreKt1n8QtPAAAg',
        orderId: 123,
        customerUserId: 1,
        customerNotificationToken: '123',
        providerUserId: 1,
        providerUuid: 'PVFfBLhTsJnd4HLFAAAh',
        orderStep: 1
      },
      user: { id: 1, UserTypeName: 'Provider' },
      provider: {
        latitude: 10,
        longitude: 10,
        notifcationToken: '',
        providerId: 1,
        status: 'Have order',
        userId: 1,
        uuid: 'PVFfBLhTsJnd4HLFAAAh',
        moduleId: 1
      }
    }

      at checkActiveSession (src/web-socket/index.ts:550:13)

  console.log
    [SOCKET] [ACTIVE-SESSION] Provider PVFfBLhTsJnd4HLFAAAh is going offline. Since they are differnet

      at checkActiveSession (src/web-socket/index.ts:554:17)

  console.log
    [SOCKET] Restoring active session [UPDATE PROVIDER] {
      order: {
        arrivalThreshold: 2,
        orderPaymentMethod: 'Cash',
        orderSubmissionType: 'provider-select',
        orderTimeoutSeconds: { seconds: 2, dateAfterAddingSeconds: 1756042620799 },
        customerUuid: 'F3bZ1nreKt1n8QtPAAAg',
        orderId: 123,
        customerUserId: 1,
        customerNotificationToken: '123',
        providerUserId: 1,
        providerUuid: 'PVFfBLhTsJnd4HLFAAAh',
        orderStep: 1
      },
      user: { id: 1, UserTypeName: 'Provider' },
      provider: {
        latitude: 10,
        longitude: 10,
        notifcationToken: '',
        providerId: 1,
        status: 'Have order',
        userId: 1,
        uuid: 'PVFfBLhTsJnd4HLFAAAh',
        moduleId: 1
      }
    }

      at checkActiveSession (src/web-socket/index.ts:559:15)

  console.log
    [SOCKET] [Provider] [Update] => Update provider {"newValues":{"latitude":10,"longitude":10,"notifcationToken":"","providerId":1,"status":"Have order","userId":1,"uuid":"aA3dJSjSra3B4rMoAAAl","moduleId":1},"searchKey":"userId","searchValue":1}

      at updateProvider (src/web-socket/index.ts:663:11)

  console.log
    [SOCKET - Broadcast online providers] Broadcasting online providers, Total Online Providers : 0

      at broadcastOnlineProvider (src/web-socket/index.ts:502:11)

  console.log
    [SOCKET] [Order] [Update] => Update Order {"newValues":{"providerUuid":"aA3dJSjSra3B4rMoAAAl"},"searchKey":"orderId","searchValue":123}

      at updateOrder (src/web-socket/index.ts:729:11)

  console.log
    [SOCKET] [Order] [Remove] => Remove Order {"searchKey":"orderId","searchValue":123}

      at removeOrder (src/web-socket/index.ts:747:11)

  console.log
    [SOCKET] Socket disconnected: client namespace disconnect

      at Socket.<anonymous> (src/web-socket/index.ts:1221:15)

  console.log
    [SOCKET] Socket disconnected: client namespace disconnect

      at Socket.<anonymous> (src/web-socket/index.ts:1221:15)

  console.log
    user undefined

      at Namespace.<anonymous> (src/web-socket/index.ts:1003:11)

  console.log
    user undefined

      at Namespace.<anonymous> (src/web-socket/index.ts:1003:11)

  console.log
    [SOCKET] [Provider] [Update] => Update provider {"newValues":{"uuid":"7wmxfgiOwneTTpEFAAAp","notifcationToken":"","status":"Online"},"searchKey":"userId","searchValue":1}

      at updateProvider (src/web-socket/index.ts:663:11)

  console.log
    [SOCKET - Broadcast online providers] Broadcasting online providers, Total Online Providers : 1

      at broadcastOnlineProvider (src/web-socket/index.ts:502:11)

  console.log
    [SOCKET] [Order] [Add] => Adding new Order {"newArgs":{"arrivalThreshold":2,"orderPaymentMethod":"Cash","orderSubmissionType":"provider-select","orderTimeoutSeconds":{"seconds":2,"dateAfterAddingSeconds":1756042630896},"customerUuid":"wxSf3VFD3i6ijZxpAAAo","orderId":123,"customerUserId":1,"customerNotificationToken":"123","providerUserId":1,"providerUuid":"7wmxfgiOwneTTpEFAAAp","orderStep":0}}

      at addOrder (src/web-socket/index.ts:712:11)

  console.log
    [SOCKET] [NEW-ORDER] Scheduling timeout job {
      orderId: 123,
      providerId: 1,
      timeoutSeconds: 2,
      timeoutDate: 2025-08-24T13:37:10.896Z,
      jobId: 'order-timeout-123'
    }

      at Socket.<anonymous> (src/web-socket/index.ts:1404:17)

  console.log
    [SOCKET] [ORDER-ACCEPT] Order found , OrderID : 123

      at Socket.<anonymous> (src/web-socket/index.ts:1635:17)

  console.log
    [SOCKET] [ORDER-ACCEPT] Cancelled regular timeout job { orderId: 123, regularTimeoutJobId: 'order-timeout-123' }

      at Socket.<anonymous> (src/web-socket/index.ts:1643:19)

  console.log
    [SOCKET] [Provider] [Update] => Update provider {"newValues":{"status":"Have order"},"searchKey":"uuid","searchValue":"7wmxfgiOwneTTpEFAAAp"}

      at updateProvider (src/web-socket/index.ts:663:11)

  console.log
    [SOCKET - Broadcast online providers] Broadcasting online providers, Total Online Providers : 0

      at broadcastOnlineProvider (src/web-socket/index.ts:502:11)

  console.log
    [SOCKET] [Order] [Update] => Update Order {"newValues":{"orderStep":1},"searchKey":"orderId","searchValue":123}

      at updateOrder (src/web-socket/index.ts:729:11)

  console.log
    [SOCKET] [ORDER-ACCEPT] Provider updated {
      provider: {
        latitude: 10,
        longitude: 10,
        notifcationToken: '',
        providerId: 1,
        status: 'Have order',
        userId: 1,
        uuid: '7wmxfgiOwneTTpEFAAAp',
        moduleId: 1
      },
      updatedOrder: {
        arrivalThreshold: 2,
        orderPaymentMethod: 'Cash',
        orderSubmissionType: 'provider-select',
        orderTimeoutSeconds: { seconds: 2, dateAfterAddingSeconds: 1756042630896 },
        customerUuid: 'wxSf3VFD3i6ijZxpAAAo',
        orderId: 123,
        customerUserId: 1,
        customerNotificationToken: '123',
        providerUserId: 1,
        providerUuid: '7wmxfgiOwneTTpEFAAAp',
        orderStep: 1
      }
    }

      at Socket.<anonymous> (src/web-socket/index.ts:1708:17)

  console.log
    [SOCKET] [ORDER-ACCEPT] Notifying customer about order acceptance { orderId: 123, providerId: 1, userId: 1, orderStep: 1 }

      at Socket.<anonymous> (src/web-socket/index.ts:1711:19)

  console.error
    System user not found. Please run database seeding.

    [0m [90m 402 |[39m
     [90m 403 |[39m     [36mif[39m ([33m![39msystemUser) {
    [31m[1m>[22m[39m[90m 404 |[39m       console[33m.[39merror([32m'System user not found. Please run database seeding.'[39m)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 405 |[39m
     [90m 406 |[39m       [90m// During tests, fall back to a synthetic system user to avoid failing the test suite[39m
     [90m 407 |[39m       [36mif[39m (process[33m.[39menv[33m.[39m[33mNODE_ENV[39m [33m===[39m [32m'test'[39m [33m||[39m process[33m.[39menv[33m.[39m[33mCI[39m [33m===[39m [32m'true'[39m) {[0m

      at sendSystemMessage (src/web-socket/chatSocket.ts:404:15)

  console.warn
    [TEST] Using fallback system user for sendSystemMessage

    [0m [90m 407 |[39m       [36mif[39m (process[33m.[39menv[33m.[39m[33mNODE_ENV[39m [33m===[39m [32m'test'[39m [33m||[39m process[33m.[39menv[33m.[39m[33mCI[39m [33m===[39m [32m'true'[39m) {
     [90m 408 |[39m         [36mconst[39m fallbackSystemUser[33m:[39m any [33m=[39m { id[33m:[39m [35m999999[39m[33m,[39m [33mFirstName[39m[33m:[39m [32m'System'[39m[33m,[39m [33mLastName[39m[33m:[39m [32m'Bot'[39m }[33m;[39m
    [31m[1m>[22m[39m[90m 409 |[39m         console[33m.[39mwarn([32m'[TEST] Using fallback system user for sendSystemMessage'[39m)[33m;[39m
     [90m     |[39m                 [31m[1m^[22m[39m
     [90m 410 |[39m         systemUser [33m=[39m fallbackSystemUser[33m;[39m
     [90m 411 |[39m       } [36melse[39m {
     [90m 412 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m([32m'System user not found'[39m)[33m;[39m[0m

      at sendSystemMessage (src/web-socket/chatSocket.ts:409:17)

  console.log
    [SOCKET - Broadcast online providers] Broadcasting online providers, Total Online Providers : 0

      at broadcastOnlineProvider (src/web-socket/index.ts:502:11)

  console.log
    [SOCKET] Socket disconnected: client namespace disconnect

      at Socket.<anonymous> (src/web-socket/index.ts:1221:15)

  console.log
    [SOCKET] Socket disconnected: client namespace disconnect

      at Socket.<anonymous> (src/web-socket/index.ts:1221:15)

  console.log
    user undefined

      at Namespace.<anonymous> (src/web-socket/index.ts:1003:11)

  console.log
    user undefined

      at Namespace.<anonymous> (src/web-socket/index.ts:1003:11)

  console.log
    [SOCKET] [PROVIDER-ONLINE-START] Checking active session {
      online: {
        latitude: 10,
        longitude: 10,
        notifcationToken: '',
        providerId: 1,
        status: 'Have order',
        userId: 1,
        uuid: '7wmxfgiOwneTTpEFAAAp',
        moduleId: 1
      }
    }

      at Socket.<anonymous> (src/web-socket/index.ts:1258:21)

  console.log
    [SOCKET] Restoring active session [ORDER FOUND] {
      order: {
        arrivalThreshold: 2,
        orderPaymentMethod: 'Cash',
        orderSubmissionType: 'provider-select',
        orderTimeoutSeconds: { seconds: 2, dateAfterAddingSeconds: 1756042630896 },
        customerUuid: 'wxSf3VFD3i6ijZxpAAAo',
        orderId: 123,
        customerUserId: 1,
        customerNotificationToken: '123',
        providerUserId: 1,
        providerUuid: '7wmxfgiOwneTTpEFAAAp',
        orderStep: 1
      },
      user: { id: 1, UserTypeName: 'Provider' },
      provider: {
        latitude: 10,
        longitude: 10,
        notifcationToken: '',
        providerId: 1,
        status: 'Have order',
        userId: 1,
        uuid: '7wmxfgiOwneTTpEFAAAp',
        moduleId: 1
      }
    }

      at checkActiveSession (src/web-socket/index.ts:550:13)

  console.log
    [SOCKET] [ACTIVE-SESSION] Provider 7wmxfgiOwneTTpEFAAAp is going offline. Since they are differnet

      at checkActiveSession (src/web-socket/index.ts:554:17)

  console.log
    [SOCKET] Restoring active session [UPDATE PROVIDER] {
      order: {
        arrivalThreshold: 2,
        orderPaymentMethod: 'Cash',
        orderSubmissionType: 'provider-select',
        orderTimeoutSeconds: { seconds: 2, dateAfterAddingSeconds: 1756042630896 },
        customerUuid: 'wxSf3VFD3i6ijZxpAAAo',
        orderId: 123,
        customerUserId: 1,
        customerNotificationToken: '123',
        providerUserId: 1,
        providerUuid: '7wmxfgiOwneTTpEFAAAp',
        orderStep: 1
      },
      user: { id: 1, UserTypeName: 'Provider' },
      provider: {
        latitude: 10,
        longitude: 10,
        notifcationToken: '',
        providerId: 1,
        status: 'Have order',
        userId: 1,
        uuid: '7wmxfgiOwneTTpEFAAAp',
        moduleId: 1
      }
    }

      at checkActiveSession (src/web-socket/index.ts:559:15)

  console.log
    [SOCKET] [Provider] [Update] => Update provider {"newValues":{"latitude":10,"longitude":10,"notifcationToken":"","providerId":1,"status":"Have order","userId":1,"uuid":"Rm0xLO9FV5H_wpNMAAAt","moduleId":1},"searchKey":"userId","searchValue":1}

      at updateProvider (src/web-socket/index.ts:663:11)

  console.log
    [SOCKET - Broadcast online providers] Broadcasting online providers, Total Online Providers : 0

      at broadcastOnlineProvider (src/web-socket/index.ts:502:11)

  console.log
    [SOCKET] [Order] [Update] => Update Order {"newValues":{"providerUuid":"Rm0xLO9FV5H_wpNMAAAt"},"searchKey":"orderId","searchValue":123}

      at updateOrder (src/web-socket/index.ts:729:11)

  console.log
    [SOCKET] [ORDER-ACCEPT] Order found , OrderID : 123

      at Socket.<anonymous> (src/web-socket/index.ts:1635:17)

  console.log
    [SOCKET] [ORDER-ACCEPT] Cancelled regular timeout job { orderId: 123, regularTimeoutJobId: 'order-timeout-123' }

      at Socket.<anonymous> (src/web-socket/index.ts:1643:19)

  console.log
    [SOCKET] [Provider] [Update] => Update provider {"newValues":{"status":"Have order"},"searchKey":"uuid","searchValue":"Rm0xLO9FV5H_wpNMAAAt"}

      at updateProvider (src/web-socket/index.ts:663:11)

  console.log
    [SOCKET - Broadcast online providers] Broadcasting online providers, Total Online Providers : 0

      at broadcastOnlineProvider (src/web-socket/index.ts:502:11)

  console.log
    [SOCKET] [Order] [Update] => Update Order {"newValues":{"orderStep":1},"searchKey":"orderId","searchValue":123}

      at updateOrder (src/web-socket/index.ts:729:11)

  console.log
    [SOCKET] [ORDER-ACCEPT] Provider updated {
      provider: {
        latitude: 10,
        longitude: 10,
        notifcationToken: '',
        providerId: 1,
        status: 'Have order',
        userId: 1,
        uuid: 'Rm0xLO9FV5H_wpNMAAAt',
        moduleId: 1
      },
      updatedOrder: {
        arrivalThreshold: 2,
        orderPaymentMethod: 'Cash',
        orderSubmissionType: 'provider-select',
        orderTimeoutSeconds: { seconds: 2, dateAfterAddingSeconds: 1756042630896 },
        customerUuid: 'wxSf3VFD3i6ijZxpAAAo',
        orderId: 123,
        customerUserId: 1,
        customerNotificationToken: '123',
        providerUserId: 1,
        providerUuid: 'Rm0xLO9FV5H_wpNMAAAt',
        orderStep: 1
      }
    }

      at Socket.<anonymous> (src/web-socket/index.ts:1708:17)

  console.log
    [SOCKET] [ORDER-ACCEPT] Notifying customer about order acceptance { orderId: 123, providerId: 1, userId: 1, orderStep: 1 }

      at Socket.<anonymous> (src/web-socket/index.ts:1711:19)

  console.error
    System user not found. Please run database seeding.

    [0m [90m 402 |[39m
     [90m 403 |[39m     [36mif[39m ([33m![39msystemUser) {
    [31m[1m>[22m[39m[90m 404 |[39m       console[33m.[39merror([32m'System user not found. Please run database seeding.'[39m)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 405 |[39m
     [90m 406 |[39m       [90m// During tests, fall back to a synthetic system user to avoid failing the test suite[39m
     [90m 407 |[39m       [36mif[39m (process[33m.[39menv[33m.[39m[33mNODE_ENV[39m [33m===[39m [32m'test'[39m [33m||[39m process[33m.[39menv[33m.[39m[33mCI[39m [33m===[39m [32m'true'[39m) {[0m

      at sendSystemMessage (src/web-socket/chatSocket.ts:404:15)

  console.warn
    [TEST] Using fallback system user for sendSystemMessage

    [0m [90m 407 |[39m       [36mif[39m (process[33m.[39menv[33m.[39m[33mNODE_ENV[39m [33m===[39m [32m'test'[39m [33m||[39m process[33m.[39menv[33m.[39m[33mCI[39m [33m===[39m [32m'true'[39m) {
     [90m 408 |[39m         [36mconst[39m fallbackSystemUser[33m:[39m any [33m=[39m { id[33m:[39m [35m999999[39m[33m,[39m [33mFirstName[39m[33m:[39m [32m'System'[39m[33m,[39m [33mLastName[39m[33m:[39m [32m'Bot'[39m }[33m;[39m
    [31m[1m>[22m[39m[90m 409 |[39m         console[33m.[39mwarn([32m'[TEST] Using fallback system user for sendSystemMessage'[39m)[33m;[39m
     [90m     |[39m                 [31m[1m^[22m[39m
     [90m 410 |[39m         systemUser [33m=[39m fallbackSystemUser[33m;[39m
     [90m 411 |[39m       } [36melse[39m {
     [90m 412 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m([32m'System user not found'[39m)[33m;[39m[0m

      at sendSystemMessage (src/web-socket/chatSocket.ts:409:17)

  console.log
    [SOCKET] Customer rejected in progress order { args: { orderId: 123, providerId: 1 } }

      at Socket.<anonymous> (src/web-socket/index.ts:1826:15)

  console.log
    [SOCKET] [Order] [Remove] => Remove Order {"searchKey":"orderId","searchValue":123}

      at removeOrder (src/web-socket/index.ts:747:11)

  console.log
    [SOCKET] Order found  123

      at Socket.<anonymous> (src/web-socket/index.ts:1834:17)

  console.log
    [SOCKET] [Provider] [Update] => Update provider {"newValues":{"status":"Online"},"searchKey":"providerId","searchValue":1}

      at updateProvider (src/web-socket/index.ts:663:11)

  console.log
    [SOCKET - Broadcast online providers] Broadcasting online providers, Total Online Providers : 1

      at broadcastOnlineProvider (src/web-socket/index.ts:502:11)

  console.log
    [SOCKET] Notifying provider about order removal {
      provider: {
        latitude: 10,
        longitude: 10,
        notifcationToken: '',
        providerId: 1,
        status: 'Online',
        userId: 1,
        uuid: 'Rm0xLO9FV5H_wpNMAAAt',
        moduleId: 1
      },
      order: {
        arrivalThreshold: 2,
        orderPaymentMethod: 'Cash',
        orderSubmissionType: 'provider-select',
        orderTimeoutSeconds: { seconds: 2, dateAfterAddingSeconds: 1756042630896 },
        customerUuid: 'wxSf3VFD3i6ijZxpAAAo',
        orderId: 123,
        customerUserId: 1,
        customerNotificationToken: '123',
        providerUserId: 1,
        providerUuid: 'Rm0xLO9FV5H_wpNMAAAt',
        orderStep: 1
      }
    }

      at Socket.<anonymous> (src/web-socket/index.ts:1863:19)


  ●  Cannot log after tests are done. Did you forget to wait for something async in your test?
    Attempted to log "[SOCKET] Socket disconnected: client namespace disconnect".

    [0m [90m 1219 |[39m         userId[33m:[39m socket[33m.[39mdata[33m?[39m[33m.[39muserInfo[33m?[39m[33m.[39mid [33m||[39m userId[33m,[39m
     [90m 1220 |[39m       })[33m;[39m
    [31m[1m>[22m[39m[90m 1221 |[39m       console[33m.[39mlog([32m'[SOCKET] Socket disconnected:'[39m[33m,[39m reason)[33m;[39m
     [90m      |[39m               [31m[1m^[22m[39m
     [90m 1222 |[39m     })[33m;[39m
     [90m 1223 |[39m
     [90m 1224 |[39m     [90m// socket.on('connect', () => {[39m[0m

      at console.log (node_modules/@jest/console/build/CustomConsole.js:141:10)
      at Socket.<anonymous> (src/web-socket/index.ts:1221:15)
      at Socket.emitReserved (node_modules/socket.io/dist/typed-events.js:56:22)
      at Socket._onclose (node_modules/socket.io/dist/socket.js:554:14)
      at Socket.ondisconnect (node_modules/socket.io/dist/socket.js:513:14)
      at Socket._onpacket (node_modules/socket.io/dist/socket.js:442:22)
      at node_modules/socket.io/dist/client.js:214:24


  ●  Cannot log after tests are done. Did you forget to wait for something async in your test?
    Attempted to log "[SOCKET] Socket disconnected: client namespace disconnect".

    [0m [90m 1219 |[39m         userId[33m:[39m socket[33m.[39mdata[33m?[39m[33m.[39muserInfo[33m?[39m[33m.[39mid [33m||[39m userId[33m,[39m
     [90m 1220 |[39m       })[33m;[39m
    [31m[1m>[22m[39m[90m 1221 |[39m       console[33m.[39mlog([32m'[SOCKET] Socket disconnected:'[39m[33m,[39m reason)[33m;[39m
     [90m      |[39m               [31m[1m^[22m[39m
     [90m 1222 |[39m     })[33m;[39m
     [90m 1223 |[39m
     [90m 1224 |[39m     [90m// socket.on('connect', () => {[39m[0m

      at console.log (node_modules/@jest/console/build/CustomConsole.js:141:10)
      at Socket.<anonymous> (src/web-socket/index.ts:1221:15)
      at Socket.emitReserved (node_modules/socket.io/dist/typed-events.js:56:22)
      at Socket._onclose (node_modules/socket.io/dist/socket.js:554:14)
      at Socket.ondisconnect (node_modules/socket.io/dist/socket.js:513:14)
      at Socket._onpacket (node_modules/socket.io/dist/socket.js:442:22)
      at node_modules/socket.io/dist/client.js:214:24

FAIL src/web-socket/index.spec.ts (50.933 s)
  web-socket/index.ts [Socket logic]
    √ Should fail because authentication failed (75 ms)
    √ [Provider-online] Should pass and make provider online (46 ms)
    √ [Provider-online] Should fail because no id or provider id (78 ms)
    × [Provider-online] get all online providers (20042 ms)
    √ [Provider-offline] remove provider from online users (553 ms)
    √ [New-order] should pass and create order (538 ms)
    √ [New-order] should return order timeout because no right provider passed (531 ms)
    √ [New-order] should set active order to provider when accepting order (5033 ms)
    √ [New-order] should remove order when rejected (5048 ms)
    √ [New-order] should remove the provider from online user when accepting order (2064 ms)
    √ [New-order] should remove order and set provider online when customer reject in progress order (6033 ms)

  ● web-socket/index.ts [Socket logic] › [Provider-online] get all online providers

    expect(received).toEqual(expected) // deep equality

    Expected: 0
    Received: 1

    [0m [90m 247 |[39m     [90m// Broadcast online user[39m
     [90m 248 |[39m     socketClientCustomer[33m.[39mon([32m'online-users'[39m[33m,[39m (online) [33m=>[39m {
    [31m[1m>[22m[39m[90m 249 |[39m       expect(online[33m.[39mlength)[33m.[39mtoEqual([35m0[39m)[33m;[39m
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 250 |[39m       done()[33m;[39m
     [90m 251 |[39m     })[33m;[39m
     [90m 252 |[39m     socketClientCustomer[33m.[39memit([32m'all-online-providers'[39m[33m,[39m [35m1[39m)[33m;[39m[0m

      at Socket.<anonymous> (src/web-socket/index.spec.ts:249:29)
      at Socket.Object.<anonymous>.Emitter.emit (node_modules/@socket.io/component-emitter/lib/cjs/index.js:143:20)
      at Socket.emitEvent (node_modules/socket.io-client/build/cjs/socket.js:559:20)
      at Socket.onevent (node_modules/socket.io-client/build/cjs/socket.js:546:18)
      at Socket.onpacket (node_modules/socket.io-client/build/cjs/socket.js:514:22)
      at Manager.Object.<anonymous>.Emitter.emit (node_modules/@socket.io/component-emitter/lib/cjs/index.js:143:20)
      at node_modules/socket.io-client/build/cjs/manager.js:246:18

  ● web-socket/index.ts [Socket logic] › [Provider-online] get all online providers

    thrown: "Exceeded timeout of 20000 ms for a test while waiting for `done()` to be called.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 243 |[39m   })[33m;[39m
     [90m 244 |[39m
    [31m[1m>[22m[39m[90m 245 |[39m   it([32m'[Provider-online] get all online providers'[39m[33m,[39m (done) [33m=>[39m {
     [90m     |[39m   [31m[1m^[22m[39m
     [90m 246 |[39m     console[33m.[39mlog([32m'Start 4'[39m)[33m;[39m
     [90m 247 |[39m     [90m// Broadcast online user[39m
     [90m 248 |[39m     socketClientCustomer[33m.[39mon([32m'online-users'[39m[33m,[39m (online) [33m=>[39m {[0m

      at src/web-socket/index.spec.ts:245:3
      at Object.<anonymous> (src/web-socket/index.spec.ts:94:1)

A worker process has failed to exit gracefully and has been force exited. This is likely caused by tests leaking due to improper teardown. Try running with --detectOpenHandles to find leaks. Active timers can also cause this, ensure that .unref() was called on them.
Summary of all failing tests
FAIL src/config/environment.spec.ts (9.629 s)
  ● config/environment.ts › Should success if all process env values are present

    expect(received).not.toThrowError()

    Error name:    "ValidationError"
    Error message: "FIREBASE_PRIVATE_KEY is a required field"

        [0m [90m 14 |[39m     })[33m;[39m
         [90m 15 |[39m     [36mconst[39m func [33m=[39m () [33m=>[39m {
        [31m[1m>[22m[39m[90m 16 |[39m       schema[33m.[39mvalidateSync(env)[33m;[39m
         [90m    |[39m              [31m[1m^[22m[39m
         [90m 17 |[39m     }[33m;[39m
         [90m 18 |[39m
         [90m 19 |[39m     expect(func)[33m.[39mnot[33m.[39mtoThrowError()[33m;[39m[0m

      at createError (node_modules/yup/lib/util/createValidation.js:54:21)
      at validate (node_modules/yup/lib/util/createValidation.js:96:83)
      at runTests (node_modules/yup/lib/util/runTests.js:39:5)
      at node_modules/yup/lib/schema.js:255:29
      at node_modules/yup/lib/util/runTests.js:17:5
      at finishTestRun (node_modules/yup/lib/util/runTests.js:67:9)
      at validate (node_modules/yup/lib/util/createValidation.js:96:103)
      at runTests (node_modules/yup/lib/util/runTests.js:39:5)
      at StringSchema._validate (node_modules/yup/lib/schema.js:246:27)
      at StringSchema.validate (node_modules/yup/lib/schema.js:271:51)
      at node_modules/yup/lib/object.js:182:17
      at runTests (node_modules/yup/lib/util/runTests.js:39:5)
      at node_modules/yup/lib/object.js:199:29
      at node_modules/yup/lib/util/runTests.js:17:5
      at finishTestRun (node_modules/yup/lib/util/runTests.js:67:9)
      at validate (node_modules/yup/lib/util/createValidation.js:96:103)
      at runTests (node_modules/yup/lib/util/runTests.js:39:5)
      at node_modules/yup/lib/schema.js:255:29
      at node_modules/yup/lib/util/runTests.js:17:5
      at finishTestRun (node_modules/yup/lib/util/runTests.js:67:9)
      at validate (node_modules/yup/lib/util/createValidation.js:96:103)
      at runTests (node_modules/yup/lib/util/runTests.js:39:5)
      at ObjectSchema._validate (node_modules/yup/lib/schema.js:246:27)
      at ObjectSchema._validate (node_modules/yup/lib/object.js:161:11)
      at ObjectSchema.validateSync (node_modules/yup/lib/schema.js:282:12)
      at func (src/config/environment.spec.ts:16:14)
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrowError] (node_modules/expect/build/index.js:320:21)
      at Object.<anonymous> (src/config/environment.spec.ts:19:22)
      at Object.<anonymous> (src/config/environment.spec.ts:19:22)

FAIL src/controllers/orders/confirmOrder.controller.spec.ts (9.795 s)
  ● users/confirmOrder › Should return addresses

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

    [0m [90m  8 |[39m     [36mawait[39m confirmOrder(global[33m.[39mmockReq[33m,[39m global[33m.[39mmockRes[33m,[39m global[33m.[39mmockNext)[33m;[39m
     [90m  9 |[39m
    [31m[1m>[22m[39m[90m 10 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledTimes([35m1[39m)[33m;[39m
     [90m    |[39m                                   [31m[1m^[22m[39m
     [90m 11 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledWith(
     [90m 12 |[39m       global[33m.[39mmockReq[33m,[39m
     [90m 13 |[39m       global[33m.[39mmockRes[33m,[39m[0m

      at Object.<anonymous> (src/controllers/orders/confirmOrder.controller.spec.ts:10:35)

FAIL src/controllers/services/getAllServices.controller.spec.ts (9.861 s)
  ● services/getAllServices › Should succeed and return all modules

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

    [0m [90m 12 |[39m     [36mawait[39m getAllServices(global[33m.[39mmockReq[33m,[39m global[33m.[39mmockRes[33m,[39m global[33m.[39mmockNext)[33m;[39m
     [90m 13 |[39m
    [31m[1m>[22m[39m[90m 14 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledTimes([35m1[39m)[33m;[39m
     [90m    |[39m                                   [31m[1m^[22m[39m
     [90m 15 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledWith(
     [90m 16 |[39m       global[33m.[39mmockReq[33m,[39m
     [90m 17 |[39m       global[33m.[39mmockRes[33m,[39m[0m

      at Object.<anonymous> (src/controllers/services/getAllServices.controller.spec.ts:14:35)

FAIL src/tests/web-socket/socketConnection.spec.ts
  ● Test suite failed to run

    Your test suite must contain at least one test.

      at onResult (node_modules/@jest/core/build/TestScheduler.js:133:18)
      at node_modules/@jest/core/build/TestScheduler.js:254:19
      at node_modules/emittery/index.js:363:13
          at Array.map (<anonymous>)
      at Emittery.emit (node_modules/emittery/index.js:361:23)

FAIL src/tests/web-socket/orderChat.spec.ts
  ● Test suite failed to run

    Your test suite must contain at least one test.

      at onResult (node_modules/@jest/core/build/TestScheduler.js:133:18)
      at node_modules/@jest/core/build/TestScheduler.js:254:19
      at node_modules/emittery/index.js:363:13
          at Array.map (<anonymous>)
      at Emittery.emit (node_modules/emittery/index.js:361:23)

FAIL src/tests/web-socket/chatBasic.spec.ts
  ● Test suite failed to run

    Your test suite must contain at least one test.

      at onResult (node_modules/@jest/core/build/TestScheduler.js:133:18)
      at node_modules/@jest/core/build/TestScheduler.js:254:19
      at node_modules/emittery/index.js:363:13
          at Array.map (<anonymous>)
      at Emittery.emit (node_modules/emittery/index.js:361:23)

FAIL src/controllers/users/verifyEmailOtp.controller.spec.ts
  ● Test suite failed to run

    Your test suite must contain at least one test.

      at onResult (node_modules/@jest/core/build/TestScheduler.js:133:18)
      at node_modules/@jest/core/build/TestScheduler.js:254:19
      at node_modules/emittery/index.js:363:13
          at Array.map (<anonymous>)
      at Emittery.emit (node_modules/emittery/index.js:361:23)

FAIL src/controllers/orders/getProviderRevenue.controller.spec.ts
  ● Test suite failed to run

    Your test suite must contain at least one test.

      at onResult (node_modules/@jest/core/build/TestScheduler.js:133:18)
      at node_modules/@jest/core/build/TestScheduler.js:254:19
      at node_modules/emittery/index.js:363:13
          at Array.map (<anonymous>)
      at Emittery.emit (node_modules/emittery/index.js:361:23)

FAIL src/controllers/users/sendEmailOtp.controller.spec.ts
  ● Test suite failed to run

    Your test suite must contain at least one test.

      at onResult (node_modules/@jest/core/build/TestScheduler.js:133:18)
      at node_modules/@jest/core/build/TestScheduler.js:254:19
      at node_modules/emittery/index.js:363:13
          at Array.map (<anonymous>)
      at Emittery.emit (node_modules/emittery/index.js:361:23)

FAIL src/controllers/orders/getOrderTotalAmountStatements.controller.spec.ts (10.251 s)
  ● orders/getOrderTotalAmount › Should success and return the order

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

    [0m [90m 42 |[39m     [36mawait[39m getOrderTotalAmountStatements(global[33m.[39mmockReq[33m,[39m global[33m.[39mmockRes[33m,[39m global[33m.[39mmockNext)[33m;[39m
     [90m 43 |[39m
    [31m[1m>[22m[39m[90m 44 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledTimes([35m1[39m)[33m;[39m
     [90m    |[39m                                   [31m[1m^[22m[39m
     [90m 45 |[39m
     [90m 46 |[39m     [90m//@ts-ignore[39m
     [90m 47 |[39m     [36mconst[39m returnResult [33m=[39m createSuccessResponse[33m.[39mmock[33m.[39mcalls[[35m0[39m][[35m2[39m][33m;[39m[0m

      at Object.<anonymous> (src/controllers/orders/getOrderTotalAmountStatements.controller.spec.ts:44:35)

FAIL src/controllers/users/updatePassword.controller.spec.ts (10.348 s)
  ● Update Password Controller › should successfully update password with valid data

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: {"select": {"Email": true, "id": true, "isActive": true}, "where": {"Email": "test@example.com"}}

    Number of calls: 0

    [0m [90m 34 |[39m     [36mawait[39m updatePassword(global[33m.[39mmockReq[33m,[39m global[33m.[39mmockRes[33m,[39m global[33m.[39mmockNext)[33m;[39m
     [90m 35 |[39m
    [31m[1m>[22m[39m[90m 36 |[39m     expect(prismaMock[33m.[39musers[33m.[39mfindUnique)[33m.[39mtoHaveBeenCalledWith({
     [90m    |[39m                                         [31m[1m^[22m[39m
     [90m 37 |[39m       where[33m:[39m { [33mEmail[39m[33m:[39m [32m'test@example.com'[39m }[33m,[39m
     [90m 38 |[39m       select[33m:[39m {
     [90m 39 |[39m         id[33m:[39m [36mtrue[39m[33m,[39m[0m

      at Object.<anonymous> (src/controllers/users/updatePassword.controller.spec.ts:36:41)

  ● Update Password Controller › should throw error when user not found

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

      {"_addBody": [Function _addBody], "_events": {}, "_eventsCount": 0, "_maxListeners": undefined, "_setBaseUrl": [Function _setBaseUrl], "_setBody": [Function _setBody], "_setCookiesVariable": [Function _setCookiesVariable], "_setFilesVariable": [Function _setFilesVariable], "_setHeadersVariable": [Function _setHeadersVariable], "_setMethod": [Function _setMethod], "_setOriginalUrl": [Function _setOriginalUrl], "_setParameter": [Function _setParameter], "_setSessionVariable": [Function _setSessionVariable], "_setSignedCookiesVariable": [Function _setSignedCookiesVariable], "_setURL": [Function _setURL], "accepts": [Function acceptsTypes], "acceptsCharsets": [Function acceptsCharsets], "acceptsEncodings": [Function acceptsEncodings], "acceptsLanguages": [Function acceptsLanguages], "baseUrl": "", "body": {"email": "test@example.com", "newPassword": "newpassword123", "otp": "123456"}, "cookies": {}, "destroy": [Function anonymous], "files": {}, "get": [Function getHeader], "getHeader": [Function getHeader], "header": [Function getHeader], "headers": {"req_id": "test-request-id"}, "hostname": "", "ip": "127.0.0.1", "ips": ["127.0.0.1"], "is": [Function isContentType], "logger": {"error": [Function mockConstructor], "info": [Function mockConstructor], "warn": [Function mockConstructor]}, "method": "GET", "originalUrl": "", "param": [Function param], "params": {}, "path": "", "prisma": undefined, "query": {}, "range": [Function isRange], "send": [Function send], "socket": {}, "subdomains": [], "url": "", "user": {}, Symbol(shapeMode): false, Symbol(kCapture): false, Symbol(Symbol.asyncIterator): [Function asyncIterator]},
      {"_getBuffer": [Function _getBuffer], "_getChunks": [Function _getChunks], "_getData": [Function _getData], "_getHeaders": [Function _getHeaders], "_getJSONData": [Function _getJSONData], "_getLocals": [Function _getLocals], "_getRedirectUrl": [Function _getRedirectUrl], "_getRenderData": [Function _getRenderData], "_getRenderView": [Function _getRenderView], "_getStatusCode": [Function _getStatusCode], "_getStatusMessage": [Function _getStatusMessage], "_headers": {}, "_isDataLengthValid": [Function _isDataLengthValid], "_isEndCalled": [Function _isEndCalled], "_isJSON": [Function _isJSON], "_isUTF8": [Function _isUTF8], "append": [Function append], "appendHeader": [Function appendHeader], "attachment": [Function attachment], "clearCookie": [Function clearCookie], "contentType": [Function contentType], "cookie": [Function cookie], "cookies": {}, "destroy": [Function destroy], "destroySoon": [Function destroySoon], "end": [Function end], "finished": false, "format": [Function format], "get": [Function getHeader], "getEncoding": [Function getEncoding], "getHeader": [Function getHeader], "getHeaderNames": [Function getHeaderNames], "getHeaders": [Function getHeaders], "hasHeader": [Function hasHeader], "header": [Function header], "headersSent": false, "json": [Function json], "jsonp": [Function jsonp], "locals": {}, "location": [Function setLocation], "redirect": [Function redirect], "removeHeader": [Function removeHeader], "render": [Function render], "send": [Function send], "sendStatus": [Function sendStatus], "set": [Function header], "setEncoding": [Function setEncoding], "setHeader": [Function setHeader], "status": [Function status], "statusCode": 200, "statusMessage": "OK", "type": [Function contentType], "vary": [Function vary], "writableEnded": false, "writableFinished": false, "write": [Function write], "writeHead": [Function writeHead]},
    - [Error: Invalid username or password],
    + [Error: Invalid OTP],
      [Function mockConstructor],

    Number of calls: 1

    [0m [90m 70 |[39m     [36mawait[39m updatePassword(global[33m.[39mmockReq[33m,[39m global[33m.[39mmockRes[33m,[39m global[33m.[39mmockNext)[33m;[39m
     [90m 71 |[39m
    [31m[1m>[22m[39m[90m 72 |[39m     expect(createFailResponse)[33m.[39mtoHaveBeenCalledWith(
     [90m    |[39m                                [31m[1m^[22m[39m
     [90m 73 |[39m       global[33m.[39mmockReq[33m,[39m
     [90m 74 |[39m       global[33m.[39mmockRes[33m,[39m
     [90m 75 |[39m       [36mnew[39m [33mHttpException[39m([33mHTTPResponses[39m[33m.[39m[33mBusinessError[39m[33m,[39m [33mHTTPErrorMessages[39m[33m.[39m[33mInvalidUsernameOrPassowrd[39m[33m,[39m [32m'User not found'[39m)[33m,[39m[0m

      at Object.<anonymous> (src/controllers/users/updatePassword.controller.spec.ts:72:32)

  ● Update Password Controller › should throw error when user is inactive

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

      {"_addBody": [Function _addBody], "_events": {}, "_eventsCount": 0, "_maxListeners": undefined, "_setBaseUrl": [Function _setBaseUrl], "_setBody": [Function _setBody], "_setCookiesVariable": [Function _setCookiesVariable], "_setFilesVariable": [Function _setFilesVariable], "_setHeadersVariable": [Function _setHeadersVariable], "_setMethod": [Function _setMethod], "_setOriginalUrl": [Function _setOriginalUrl], "_setParameter": [Function _setParameter], "_setSessionVariable": [Function _setSessionVariable], "_setSignedCookiesVariable": [Function _setSignedCookiesVariable], "_setURL": [Function _setURL], "accepts": [Function acceptsTypes], "acceptsCharsets": [Function acceptsCharsets], "acceptsEncodings": [Function acceptsEncodings], "acceptsLanguages": [Function acceptsLanguages], "baseUrl": "", "body": {"email": "test@example.com", "newPassword": "newpassword123", "otp": "123456"}, "cookies": {}, "destroy": [Function anonymous], "files": {}, "get": [Function getHeader], "getHeader": [Function getHeader], "header": [Function getHeader], "headers": {"req_id": "test-request-id"}, "hostname": "", "ip": "127.0.0.1", "ips": ["127.0.0.1"], "is": [Function isContentType], "logger": {"error": [Function mockConstructor], "info": [Function mockConstructor], "warn": [Function mockConstructor]}, "method": "GET", "originalUrl": "", "param": [Function param], "params": {}, "path": "", "prisma": undefined, "query": {}, "range": [Function isRange], "send": [Function send], "socket": {}, "subdomains": [], "url": "", "user": {}, Symbol(shapeMode): false, Symbol(kCapture): false, Symbol(Symbol.asyncIterator): [Function asyncIterator]},
      {"_getBuffer": [Function _getBuffer], "_getChunks": [Function _getChunks], "_getData": [Function _getData], "_getHeaders": [Function _getHeaders], "_getJSONData": [Function _getJSONData], "_getLocals": [Function _getLocals], "_getRedirectUrl": [Function _getRedirectUrl], "_getRenderData": [Function _getRenderData], "_getRenderView": [Function _getRenderView], "_getStatusCode": [Function _getStatusCode], "_getStatusMessage": [Function _getStatusMessage], "_headers": {}, "_isDataLengthValid": [Function _isDataLengthValid], "_isEndCalled": [Function _isEndCalled], "_isJSON": [Function _isJSON], "_isUTF8": [Function _isUTF8], "append": [Function append], "appendHeader": [Function appendHeader], "attachment": [Function attachment], "clearCookie": [Function clearCookie], "contentType": [Function contentType], "cookie": [Function cookie], "cookies": {}, "destroy": [Function destroy], "destroySoon": [Function destroySoon], "end": [Function end], "finished": false, "format": [Function format], "get": [Function getHeader], "getEncoding": [Function getEncoding], "getHeader": [Function getHeader], "getHeaderNames": [Function getHeaderNames], "getHeaders": [Function getHeaders], "hasHeader": [Function hasHeader], "header": [Function header], "headersSent": false, "json": [Function json], "jsonp": [Function jsonp], "locals": {}, "location": [Function setLocation], "redirect": [Function redirect], "removeHeader": [Function removeHeader], "render": [Function render], "send": [Function send], "sendStatus": [Function sendStatus], "set": [Function header], "setEncoding": [Function setEncoding], "setHeader": [Function setHeader], "status": [Function status], "statusCode": 200, "statusMessage": "OK", "type": [Function contentType], "vary": [Function vary], "writableEnded": false, "writableFinished": false, "write": [Function write], "writeHead": [Function writeHead]},
    - [Error: Your account is still inactive/under processing],
    + [Error: Invalid OTP],
      [Function mockConstructor],

    Number of calls: 1

    [0m [90m 90 |[39m     [36mawait[39m updatePassword(global[33m.[39mmockReq[33m,[39m global[33m.[39mmockRes[33m,[39m global[33m.[39mmockNext)[33m;[39m
     [90m 91 |[39m
    [31m[1m>[22m[39m[90m 92 |[39m     expect(createFailResponse)[33m.[39mtoHaveBeenCalledWith(
     [90m    |[39m                                [31m[1m^[22m[39m
     [90m 93 |[39m       global[33m.[39mmockReq[33m,[39m
     [90m 94 |[39m       global[33m.[39mmockRes[33m,[39m
     [90m 95 |[39m       [36mnew[39m [33mHttpException[39m([33mHTTPResponses[39m[33m.[39m[33mBusinessError[39m[33m,[39m [33mHTTPErrorMessages[39m[33m.[39m[33mAccountInactive[39m[33m,[39m {[0m

      at Object.<anonymous> (src/controllers/users/updatePassword.controller.spec.ts:92:32)

FAIL src/middleware/auth.middleware.spec.ts (10.292 s)
  ● auth.middleware › auth › Should fail because allowed client is not right

    expect(received).toEqual(expected) // deep equality

    Expected: "Allowed Client is not right"
    Received: undefined

    [0m [90m 75 |[39m         [36mawait[39m auth([32m'wrong'[39m[33m,[39m [32m'wrong client'[39m)[33m;[39m
     [90m 76 |[39m       } [36mcatch[39m (error[33m:[39m any) {
    [31m[1m>[22m[39m[90m 77 |[39m         expect(error[33m.[39madditionalParameters)[33m.[39mtoEqual([32m'Allowed Client is not right'[39m)[33m;[39m
     [90m    |[39m                                            [31m[1m^[22m[39m
     [90m 78 |[39m       }
     [90m 79 |[39m     })[33m;[39m
     [90m 80 |[39m[0m

      at Object.<anonymous> (src/middleware/auth.middleware.spec.ts:77:44)

FAIL src/controllers/orders/getOneOrder.controller.spec.ts (10.406 s)
  ● orders/getOneOrder › Should success and return the order

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

    [0m [90m 16 |[39m     [36mawait[39m getOneOrder(global[33m.[39mmockReq[33m,[39m global[33m.[39mmockRes[33m,[39m global[33m.[39mmockNext)[33m;[39m
     [90m 17 |[39m
    [31m[1m>[22m[39m[90m 18 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledTimes([35m1[39m)[33m;[39m
     [90m    |[39m                                   [31m[1m^[22m[39m
     [90m 19 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledWith(global[33m.[39mmockReq[33m,[39m global[33m.[39mmockRes[33m,[39m { 
     [90m 20 |[39m       id[33m:[39m [35m111[39m[33m,[39m
     [90m 21 |[39m       paymentMethods[33m:[39m {[0m

      at Object.<anonymous> (src/controllers/orders/getOneOrder.controller.spec.ts:18:35)

  ● orders/getOneOrder › Should fail because no order

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

    [0m [90m 32 |[39m     [36mawait[39m getOneOrder(global[33m.[39mmockReq[33m,[39m global[33m.[39mmockRes[33m,[39m global[33m.[39mmockNext)[33m;[39m
     [90m 33 |[39m
    [31m[1m>[22m[39m[90m 34 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledTimes([35m1[39m)[33m;[39m
     [90m    |[39m                                   [31m[1m^[22m[39m
     [90m 35 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledWith(global[33m.[39mmockReq[33m,[39m global[33m.[39mmockRes[33m,[39m {}[33m,[39m global[33m.[39mmockNext)[33m;[39m
     [90m 36 |[39m   })[33m;[39m
     [90m 37 |[39m })[33m;[39m[0m

      at Object.<anonymous> (src/controllers/orders/getOneOrder.controller.spec.ts:34:35)

FAIL src/controllers/orders/addOrder.controller.spec.ts (10.489 s)
  ● orders/addOrder › Should succeed

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

    [0m [90m 35 |[39m     [36mawait[39m addOrder(global[33m.[39mmockReq[33m,[39m global[33m.[39mmockRes[33m,[39m global[33m.[39mmockNext)[33m;[39m
     [90m 36 |[39m
    [31m[1m>[22m[39m[90m 37 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledTimes([35m1[39m)[33m;[39m
     [90m    |[39m                                   [31m[1m^[22m[39m
     [90m 38 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledWith(
     [90m 39 |[39m       global[33m.[39mmockReq[33m,[39m
     [90m 40 |[39m       global[33m.[39mmockRes[33m,[39m[0m

      at Object.<anonymous> (src/controllers/orders/addOrder.controller.spec.ts:37:35)

FAIL src/controllers/users/register.controller.spec.ts (10.506 s)
  ● users/register › Should success

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

      {"_addBody": [Function _addBody], "_events": {}, "_eventsCount": 0, "_maxListeners": undefined, "_setBaseUrl": [Function _setBaseUrl], "_setBody": [Function _setBody], "_setCookiesVariable": [Function _setCookiesVariable], "_setFilesVariable": [Function _setFilesVariable], "_setHeadersVariable": [Function _setHeadersVariable], "_setMethod": [Function _setMethod], "_setOriginalUrl": [Function _setOriginalUrl], "_setParameter": [Function _setParameter], "_setSessionVariable": [Function _setSessionVariable], "_setSignedCookiesVariable": [Function _setSignedCookiesVariable], "_setURL": [Function _setURL], "accepts": [Function acceptsTypes], "acceptsCharsets": [Function acceptsCharsets], "acceptsEncodings": [Function acceptsEncodings], "acceptsLanguages": [Function acceptsLanguages], "baseUrl": "", "body": {"Password": "Test", "UserTypeName": "Test"}, "cookies": {}, "destroy": [Function anonymous], "files": {}, "get": [Function getHeader], "getHeader": [Function getHeader], "header": [Function getHeader], "headers": {}, "hostname": "", "ip": "127.0.0.1", "ips": ["127.0.0.1"], "is": [Function isContentType], "logger": {"error": [Function mockConstructor], "info": [Function mockConstructor], "warn": [Function mockConstructor]}, "method": "GET", "originalUrl": "", "param": [Function param], "params": {}, "path": "", "prisma": undefined, "query": {}, "range": [Function isRange], "send": [Function send], "socket": {}, "subdomains": [], "url": "", "user": {}, Symbol(shapeMode): false, Symbol(kCapture): false, Symbol(Symbol.asyncIterator): [Function asyncIterator]},
      {"_getBuffer": [Function _getBuffer], "_getChunks": [Function _getChunks], "_getData": [Function _getData], "_getHeaders": [Function _getHeaders], "_getJSONData": [Function _getJSONData], "_getLocals": [Function _getLocals], "_getRedirectUrl": [Function _getRedirectUrl], "_getRenderData": [Function _getRenderData], "_getRenderView": [Function _getRenderView], "_getStatusCode": [Function _getStatusCode], "_getStatusMessage": [Function _getStatusMessage], "_headers": {}, "_isDataLengthValid": [Function _isDataLengthValid], "_isEndCalled": [Function _isEndCalled], "_isJSON": [Function _isJSON], "_isUTF8": [Function _isUTF8], "append": [Function append], "appendHeader": [Function appendHeader], "attachment": [Function attachment], "clearCookie": [Function clearCookie], "contentType": [Function contentType], "cookie": [Function cookie], "cookies": {}, "destroy": [Function destroy], "destroySoon": [Function destroySoon], "end": [Function end], "finished": false, "format": [Function format], "get": [Function getHeader], "getEncoding": [Function getEncoding], "getHeader": [Function getHeader], "getHeaderNames": [Function getHeaderNames], "getHeaders": [Function getHeaders], "hasHeader": [Function hasHeader], "header": [Function header], "headersSent": false, "json": [Function json], "jsonp": [Function jsonp], "locals": {}, "location": [Function setLocation], "redirect": [Function redirect], "removeHeader": [Function removeHeader], "render": [Function render], "send": [Function send], "sendStatus": [Function sendStatus], "set": [Function header], "setEncoding": [Function setEncoding], "setHeader": [Function setHeader], "status": [Function status], "statusCode": 200, "statusMessage": "OK", "type": [Function contentType], "vary": [Function vary], "writableEnded": false, "writableFinished": false, "write": [Function write], "writeHead": [Function writeHead]},
      Object {
    +   "emailSent": false,
        "id": 1,
        "result": true,
      },
      [Function mockConstructor],

    Number of calls: 1

    [0m [90m 10 |[39m
     [90m 11 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledTimes([35m1[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 12 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledWith(
     [90m    |[39m                                   [31m[1m^[22m[39m
     [90m 13 |[39m       global[33m.[39mmockReq[33m,[39m
     [90m 14 |[39m       global[33m.[39mmockRes[33m,[39m
     [90m 15 |[39m       { result[33m:[39m [36mtrue[39m[33m,[39m id[33m:[39m [35m1[39m }[33m,[39m[0m

      at Object.<anonymous> (src/controllers/users/register.controller.spec.ts:12:35)

FAIL src/web-socket/index.functions.spec.ts (10.922 s)
  ● web-socket/index.ts [Socket functions] › [broadcastOnlineProviders] Should pass and send online providers to all online users

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "online-users", Anything

    Number of calls: 0

    [0m [90m 32 |[39m   it([32m'[broadcastOnlineProviders] Should pass and send online providers to all online users'[39m[33m,[39m () [33m=>[39m {
     [90m 33 |[39m     socketFunctions[33m.[39mbroadcastOnlineProvider(mockSocket [36mas[39m any)[33m;[39m
    [31m[1m>[22m[39m[90m 34 |[39m     expect(mockSocket[33m.[39mbroadcast[33m.[39memit)[33m.[39mtoHaveBeenCalledWith([32m'online-users'[39m[33m,[39m expect[33m.[39manything())[33m;[39m
     [90m    |[39m                                       [31m[1m^[22m[39m
     [90m 35 |[39m     expect(mockSocket[33m.[39memit)[33m.[39mtoHaveBeenCalledWith([32m'online-users'[39m[33m,[39m expect[33m.[39manything())[33m;[39m
     [90m 36 |[39m   })[33m;[39m
     [90m 37 |[39m })[33m;[39m[0m

      at Object.<anonymous> (src/web-socket/index.functions.spec.ts:34:39)

FAIL src/controllers/users/login.controller.spec.ts (11.857 s)
  ● users/login › Should return fail because allowed clients is not right

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

      {"_addBody": [Function _addBody], "_events": {}, "_eventsCount": 0, "_maxListeners": undefined, "_setBaseUrl": [Function _setBaseUrl], "_setBody": [Function _setBody], "_setCookiesVariable": [Function _setCookiesVariable], "_setFilesVariable": [Function _setFilesVariable], "_setHeadersVariable": [Function _setHeadersVariable], "_setMethod": [Function _setMethod], "_setOriginalUrl": [Function _setOriginalUrl], "_setParameter": [Function _setParameter], "_setSessionVariable": [Function _setSessionVariable], "_setSignedCookiesVariable": [Function _setSignedCookiesVariable], "_setURL": [Function _setURL], "accepts": [Function acceptsTypes], "acceptsCharsets": [Function acceptsCharsets], "acceptsEncodings": [Function acceptsEncodings], "acceptsLanguages": [Function acceptsLanguages], "baseUrl": "", "body": {"email": "1", "password": "1"}, "cookies": {}, "destroy": [Function anonymous], "files": {}, "get": [Function getHeader], "getHeader": [Function getHeader], "header": [Function getHeader], "headers": {"allowed-client": "U2FsdGVkX19yIFZOGOgAtoOuBv2pgI4eGsNM1H4IGT8="}, "hostname": "", "ip": "127.0.0.1", "ips": ["127.0.0.1"], "is": [Function isContentType], "logger": {"error": [Function mockConstructor], "info": [Function mockConstructor], "warn": [Function mockConstructor]}, "method": "GET", "originalUrl": "", "param": [Function param], "params": {}, "path": "", "prisma": undefined, "query": {}, "range": [Function isRange], "send": [Function send], "socket": {}, "subdomains": [], "url": "", "user": {}, Symbol(shapeMode): false, Symbol(kCapture): false, Symbol(Symbol.asyncIterator): [Function asyncIterator]},
      {"_getBuffer": [Function _getBuffer], "_getChunks": [Function _getChunks], "_getData": [Function _getData], "_getHeaders": [Function _getHeaders], "_getJSONData": [Function _getJSONData], "_getLocals": [Function _getLocals], "_getRedirectUrl": [Function _getRedirectUrl], "_getRenderData": [Function _getRenderData], "_getRenderView": [Function _getRenderView], "_getStatusCode": [Function _getStatusCode], "_getStatusMessage": [Function _getStatusMessage], "_headers": {}, "_isDataLengthValid": [Function _isDataLengthValid], "_isEndCalled": [Function _isEndCalled], "_isJSON": [Function _isJSON], "_isUTF8": [Function _isUTF8], "append": [Function append], "appendHeader": [Function appendHeader], "attachment": [Function attachment], "clearCookie": [Function clearCookie], "contentType": [Function contentType], "cookie": [Function cookie], "cookies": {}, "destroy": [Function destroy], "destroySoon": [Function destroySoon], "end": [Function end], "finished": false, "format": [Function format], "get": [Function getHeader], "getEncoding": [Function getEncoding], "getHeader": [Function getHeader], "getHeaderNames": [Function getHeaderNames], "getHeaders": [Function getHeaders], "hasHeader": [Function hasHeader], "header": [Function header], "headersSent": false, "json": [Function json], "jsonp": [Function jsonp], "locals": {}, "location": [Function setLocation], "redirect": [Function redirect], "removeHeader": [Function removeHeader], "render": [Function render], "send": [Function send], "sendStatus": [Function sendStatus], "set": [Function header], "setEncoding": [Function setEncoding], "setHeader": [Function setHeader], "status": [Function status], "statusCode": 200, "statusMessage": "OK", "type": [Function contentType], "vary": [Function vary], "writableEnded": false, "writableFinished": false, "write": [Function write], "writeHead": [Function writeHead]},
    - [Error: No sufficient permission],
    + [Error: Email not verified],
      [Function mockConstructor],

    Number of calls: 1

    [0m [90m 75 |[39m
     [90m 76 |[39m     expect(createFailResponse)[33m.[39mtoHaveBeenCalledTimes([35m1[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 77 |[39m     expect(createFailResponse)[33m.[39mtoHaveBeenCalledWith(
     [90m    |[39m                                [31m[1m^[22m[39m
     [90m 78 |[39m       global[33m.[39mmockReq[33m,[39m
     [90m 79 |[39m       global[33m.[39mmockRes[33m,[39m
     [90m 80 |[39m[0m

      at Object.<anonymous> (src/controllers/users/login.controller.spec.ts:77:32)

  ● users/login › Should succeed

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

    [0m [90m 105 |[39m     [36mawait[39m login(global[33m.[39mmockReq[33m,[39m global[33m.[39mmockRes[33m,[39m global[33m.[39mmockNext)[33m;[39m
     [90m 106 |[39m
    [31m[1m>[22m[39m[90m 107 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledTimes([35m1[39m)[33m;[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 108 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledWith(
     [90m 109 |[39m       global[33m.[39mmockReq[33m,[39m
     [90m 110 |[39m       global[33m.[39mmockRes[33m,[39m[0m

      at Object.<anonymous> (src/controllers/users/login.controller.spec.ts:107:35)

  ● users/login › Should succeed and return isUserActive as atrue

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

    [0m [90m 135 |[39m     [36mawait[39m login(global[33m.[39mmockReq[33m,[39m global[33m.[39mmockRes[33m,[39m global[33m.[39mmockNext)[33m;[39m
     [90m 136 |[39m
    [31m[1m>[22m[39m[90m 137 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledTimes([35m1[39m)[33m;[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 138 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledWith(
     [90m 139 |[39m       global[33m.[39mmockReq[33m,[39m
     [90m 140 |[39m       global[33m.[39mmockRes[33m,[39m[0m

      at Object.<anonymous> (src/controllers/users/login.controller.spec.ts:137:35)

  ● users/login › Should succeed and return isUserActive as true and document fullfilled true

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

    [0m [90m 169 |[39m     [36mawait[39m login(global[33m.[39mmockReq[33m,[39m global[33m.[39mmockRes[33m,[39m global[33m.[39mmockNext)[33m;[39m
     [90m 170 |[39m     [32m``[39m[33m;[39m
    [31m[1m>[22m[39m[90m 171 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledTimes([35m1[39m)[33m;[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 172 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledWith(
     [90m 173 |[39m       global[33m.[39mmockReq[33m,[39m
     [90m 174 |[39m       global[33m.[39mmockRes[33m,[39m[0m

      at Object.<anonymous> (src/controllers/users/login.controller.spec.ts:171:35)

FAIL src/web-socket/orderChat.spec.ts (13.493 s)
  ● OrderChatHandler › Error Handling › should handle database errors gracefully

    Expected done to be called once, but it was called multiple times.

    [0m [90m 694 |[39m           clientSocket1[33m.[39moff([32m'chat-error'[39m[33m,[39m onError)[33m;[39m [90m// Remove listener after first call[39m
     [90m 695 |[39m           clientSocket1[33m.[39moff([32m'chat-authenticated'[39m[33m,[39m onAuthenticated)[33m;[39m [90m// Clean up[39m
    [31m[1m>[22m[39m[90m 696 |[39m           done()[33m;[39m
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 697 |[39m         }[33m;[39m
     [90m 698 |[39m         clientSocket1[33m.[39mon([32m'chat-error'[39m[33m,[39m onError)[33m;[39m
     [90m 699 |[39m       }[33m;[39m[0m

      at Socket.onError (src/web-socket/orderChat.spec.ts:696:11)
      at Socket.Object.<anonymous>.Emitter.emit (node_modules/@socket.io/component-emitter/lib/cjs/index.js:143:20)
      at Socket.emitEvent (node_modules/socket.io-client/build/cjs/socket.js:559:20)
      at Socket.onevent (node_modules/socket.io-client/build/cjs/socket.js:546:18)
      at Socket.onpacket (node_modules/socket.io-client/build/cjs/socket.js:514:22)
      at Manager.Object.<anonymous>.Emitter.emit (node_modules/@socket.io/component-emitter/lib/cjs/index.js:143:20)
      at node_modules/socket.io-client/build/cjs/manager.js:246:18

  ● OrderChatHandler › Error Handling › should handle database errors gracefully

    Expected done to be called once, but it was called multiple times.

    [0m [90m 694 |[39m           clientSocket1[33m.[39moff([32m'chat-error'[39m[33m,[39m onError)[33m;[39m [90m// Remove listener after first call[39m
     [90m 695 |[39m           clientSocket1[33m.[39moff([32m'chat-authenticated'[39m[33m,[39m onAuthenticated)[33m;[39m [90m// Clean up[39m
    [31m[1m>[22m[39m[90m 696 |[39m           done()[33m;[39m
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 697 |[39m         }[33m;[39m
     [90m 698 |[39m         clientSocket1[33m.[39mon([32m'chat-error'[39m[33m,[39m onError)[33m;[39m
     [90m 699 |[39m       }[33m;[39m[0m

      at Socket.onError (src/web-socket/orderChat.spec.ts:696:11)
      at Socket.Object.<anonymous>.Emitter.emit (node_modules/@socket.io/component-emitter/lib/cjs/index.js:143:20)
      at Socket.emitEvent (node_modules/socket.io-client/build/cjs/socket.js:559:20)
      at Socket.onevent (node_modules/socket.io-client/build/cjs/socket.js:546:18)
      at Socket.onpacket (node_modules/socket.io-client/build/cjs/socket.js:514:22)
      at Manager.Object.<anonymous>.Emitter.emit (node_modules/@socket.io/component-emitter/lib/cjs/index.js:143:20)
      at node_modules/socket.io-client/build/cjs/manager.js:246:18

FAIL src/web-socket/index.spec.ts (50.933 s)
  ● web-socket/index.ts [Socket logic] › [Provider-online] get all online providers

    expect(received).toEqual(expected) // deep equality

    Expected: 0
    Received: 1

    [0m [90m 247 |[39m     [90m// Broadcast online user[39m
     [90m 248 |[39m     socketClientCustomer[33m.[39mon([32m'online-users'[39m[33m,[39m (online) [33m=>[39m {
    [31m[1m>[22m[39m[90m 249 |[39m       expect(online[33m.[39mlength)[33m.[39mtoEqual([35m0[39m)[33m;[39m
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 250 |[39m       done()[33m;[39m
     [90m 251 |[39m     })[33m;[39m
     [90m 252 |[39m     socketClientCustomer[33m.[39memit([32m'all-online-providers'[39m[33m,[39m [35m1[39m)[33m;[39m[0m

      at Socket.<anonymous> (src/web-socket/index.spec.ts:249:29)
      at Socket.Object.<anonymous>.Emitter.emit (node_modules/@socket.io/component-emitter/lib/cjs/index.js:143:20)
      at Socket.emitEvent (node_modules/socket.io-client/build/cjs/socket.js:559:20)
      at Socket.onevent (node_modules/socket.io-client/build/cjs/socket.js:546:18)
      at Socket.onpacket (node_modules/socket.io-client/build/cjs/socket.js:514:22)
      at Manager.Object.<anonymous>.Emitter.emit (node_modules/@socket.io/component-emitter/lib/cjs/index.js:143:20)
      at node_modules/socket.io-client/build/cjs/manager.js:246:18

  ● web-socket/index.ts [Socket logic] › [Provider-online] get all online providers

    thrown: "Exceeded timeout of 20000 ms for a test while waiting for `done()` to be called.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 243 |[39m   })[33m;[39m
     [90m 244 |[39m
    [31m[1m>[22m[39m[90m 245 |[39m   it([32m'[Provider-online] get all online providers'[39m[33m,[39m (done) [33m=>[39m {
     [90m     |[39m   [31m[1m^[22m[39m
     [90m 246 |[39m     console[33m.[39mlog([32m'Start 4'[39m)[33m;[39m
     [90m 247 |[39m     [90m// Broadcast online user[39m
     [90m 248 |[39m     socketClientCustomer[33m.[39mon([32m'online-users'[39m[33m,[39m (online) [33m=>[39m {[0m

      at src/web-socket/index.spec.ts:245:3
      at Object.<anonymous> (src/web-socket/index.spec.ts:94:1)


Test Suites: 19 failed, 35 passed, 54 total
Tests:       19 failed, 112 passed, 131 total
Snapshots:   0 total
Time:        51.957 s, estimated 52 s
Ran all test suites.
Force exiting Jest: Have you considered using `--detectOpenHandles` to detect async operations that kept running after all tests finished?
