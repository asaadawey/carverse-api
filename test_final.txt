
> carwash-api@1.0.0 test
> dotenv -e .env_test -- jest --verbose

PASS src/controllers/providers/upsertProviderService.controller.spec.ts (9.14 s)
  providers/upsertProviderServices
    ‚àö Should succeed without delete (9 ms)
    ‚àö Should succeed with delete (3 ms)

PASS src/services/emailService.support.spec.ts (9.277 s)
  emailService - Multiple Email Configurations
    ‚àö Should have separate OTP and support email configurations (10 ms)
    ‚àö Should return status for both email services (2 ms)
    ‚àö Should validate environment variables are properly structured (1 ms)

PASS src/controllers/constants/getAllConstants.controller.spec.ts
  constants/getAllConstants
    ‚àö Should succeed and return all constants (2 ms)

PASS src/controllers/modules/getAllModules.controller.spec.ts
  modules/getAllModules
    ‚àö Should succeed and return all modules (1 ms)

PASS src/controllers/users/checkUserExist.controller.spec.ts (9.505 s)
  users/checkUserExist
    ‚àö Should return user not exist (7 ms)
    ‚àö Should return user  exist (5 ms)

PASS src/controllers/users/getUserDetails.controller.spec.ts (9.521 s)
  users/getUserDetails
    ‚àö Should success and return user details (10 ms)
    ‚àö Should fail if body passed with wrong user (3 ms)

FAIL src/config/environment.spec.ts (9.514 s)
  config/environment.ts
    √ó Should success if all process env values are present (33 ms)
    ‚àö Should fail because not all env values are present (1 ms)

  ‚óè config/environment.ts ‚Ä∫ Should success if all process env values are present

    expect(received).not.toThrowError()

    Error name:    "ValidationError"
    Error message: "FIREBASE_PRIVATE_KEY is a required field"

        [0m [90m 14 |[39m     })[33m;[39m
         [90m 15 |[39m     [36mconst[39m func [33m=[39m () [33m=>[39m {
        [31m[1m>[22m[39m[90m 16 |[39m       schema[33m.[39mvalidateSync(env)[33m;[39m
         [90m    |[39m              [31m[1m^[22m[39m
         [90m 17 |[39m     }[33m;[39m
         [90m 18 |[39m
         [90m 19 |[39m     expect(func)[33m.[39mnot[33m.[39mtoThrowError()[33m;[39m[0m

      at createError (node_modules/yup/lib/util/createValidation.js:54:21)
      at validate (node_modules/yup/lib/util/createValidation.js:96:83)
      at runTests (node_modules/yup/lib/util/runTests.js:39:5)
      at node_modules/yup/lib/schema.js:255:29
      at node_modules/yup/lib/util/runTests.js:17:5
      at finishTestRun (node_modules/yup/lib/util/runTests.js:67:9)
      at validate (node_modules/yup/lib/util/createValidation.js:96:103)
      at runTests (node_modules/yup/lib/util/runTests.js:39:5)
      at StringSchema._validate (node_modules/yup/lib/schema.js:246:27)
      at StringSchema.validate (node_modules/yup/lib/schema.js:271:51)
      at node_modules/yup/lib/object.js:182:17
      at runTests (node_modules/yup/lib/util/runTests.js:39:5)
      at node_modules/yup/lib/object.js:199:29
      at node_modules/yup/lib/util/runTests.js:17:5
      at finishTestRun (node_modules/yup/lib/util/runTests.js:67:9)
      at validate (node_modules/yup/lib/util/createValidation.js:96:103)
      at runTests (node_modules/yup/lib/util/runTests.js:39:5)
      at node_modules/yup/lib/schema.js:255:29
      at node_modules/yup/lib/util/runTests.js:17:5
      at finishTestRun (node_modules/yup/lib/util/runTests.js:67:9)
      at validate (node_modules/yup/lib/util/createValidation.js:96:103)
      at runTests (node_modules/yup/lib/util/runTests.js:39:5)
      at ObjectSchema._validate (node_modules/yup/lib/schema.js:246:27)
      at ObjectSchema._validate (node_modules/yup/lib/object.js:161:11)
      at ObjectSchema.validateSync (node_modules/yup/lib/schema.js:282:12)
      at func (src/config/environment.spec.ts:16:14)
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrowError] (node_modules/expect/build/index.js:320:21)
      at Object.<anonymous> (src/config/environment.spec.ts:19:22)
      at Object.<anonymous> (src/config/environment.spec.ts:19:22)

PASS src/controllers/cars/checkCarExist.controller.spec.ts (9.552 s)
  cars/checkCarExist
    ‚àö Should return car not exist (9 ms)
    ‚àö Should return car exist (6 ms)

PASS src/middleware/apiAuth.middleware.spec.ts (9.552 s)
  apiAuth.middleware
    ‚àö Should fail becuase no auth key is passed (9 ms)
    ‚àö Should fail becuase auth key is passed but its incorrect (1 ms)
    ‚àö Should succeed (1 ms)

PASS src/controllers/users/addDeleteRequest.controller.spec.ts (9.616 s)
  users/addDeleteRequest
    ‚àö Should success and add delete request for normal user (9 ms)
    ‚àö Should success and add delete request for admin user user (2 ms)
    ‚àö Should fail if body passed with wrong user (3 ms)

PASS src/utils/amountUtils.spec.ts
  amountUtils.ts
    ‚àö should return amount (1 ms)
    ‚àö should return percentage (1 ms)

PASS src/controllers/providers/getOneProvider.controller.spec.ts (9.64 s)
  provider/getOneProvider
    ‚àö Should success and return the order (9 ms)
    ‚àö Should fail because no order (2 ms)

PASS src/controllers/users/getPreviousAddresses.controller.spec.ts
  users/getPreviousAddresses
    ‚àö Should return addresses (1 ms)

PASS src/controllers/providers/getAllProviders.controller.spec.ts (9.696 s)
  providers/getAllProviders
    ‚àö Should success and return all providers with no avg (10 ms)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"level":"debug","message":"Fetching all payment methods"}

    [0m [90m 26 |[39m [33m>[39m [33m=[39m [36masync[39m (req[33m,[39m res[33m,[39m next) [33m=>[39m {
     [90m 27 |[39m   [36mtry[39m {
    [31m[1m>[22m[39m[90m 28 |[39m     logger[33m.[39mdebug([32m'Fetching all payment methods'[39m[33m,[39m { reqId[33m:[39m req[33m.[39mheaders[[32m'req_id'[39m] })[33m;[39m
     [90m    |[39m            [31m[1m^[22m[39m
     [90m 29 |[39m
     [90m 30 |[39m     [36mconst[39m paymentMethods [33m=[39m [36mawait[39m req[33m.[39mprisma[33m.[39mpaymentMethods[33m.[39mfindMany({
     [90m 31 |[39m       select[33m:[39m { [33mMethodName[39m[33m:[39m [36mtrue[39m[33m,[39m id[33m:[39m [36mtrue[39m[33m,[39m [33mMethodDescription[39m[33m:[39m [36mtrue[39m }[33m,[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as debug] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at getAllPaymentMethods (src/controllers/payment/getAllPaymentMethods.controller.ts:28:12)
      at Object.<anonymous> (src/controllers/payment/getAllPaymentMethods.controller.spec.ts:8:31)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"count":1,"level":"debug","message":"Payment methods retrieved successfully"}

    [0m [90m 32 |[39m     })[33m;[39m
     [90m 33 |[39m
    [31m[1m>[22m[39m[90m 34 |[39m     logger[33m.[39mdebug([32m'Payment methods retrieved successfully'[39m[33m,[39m {
     [90m    |[39m            [31m[1m^[22m[39m
     [90m 35 |[39m       count[33m:[39m paymentMethods[33m.[39mlength[33m,[39m
     [90m 36 |[39m       reqId[33m:[39m req[33m.[39mheaders[[32m'req_id'[39m][33m,[39m
     [90m 37 |[39m     })[33m;[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as debug] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at getAllPaymentMethods (src/controllers/payment/getAllPaymentMethods.controller.ts:34:12)
      at Object.<anonymous> (src/controllers/payment/getAllPaymentMethods.controller.spec.ts:8:5)

PASS src/controllers/payment/getAllPaymentMethods.controller.spec.ts
  payment/getAllPaymentMethods
    ‚àö Should return payment methods (43 ms)

PASS src/controllers/users/processDeleteRequest.controller.spec.ts (9.738 s)
  users/addDeleteRequest
    ‚àö Should success and add delete request for normal user (7 ms)
    ‚àö Should success and add delete request for admin user user (6 ms)
    ‚àö Should fail if body passed with wrong user (3 ms)

PASS src/controllers/attachments/getAllAttachmentTypes.controller.spec.ts
  attachment/getAllAttachmentTypes
    ‚àö Should success (7 ms)

FAIL src/controllers/orders/confirmOrder.controller.spec.ts
  users/confirmOrder
    √ó Should return addresses (2 ms)

  ‚óè users/confirmOrder ‚Ä∫ Should return addresses

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

    [0m [90m  8 |[39m     [36mawait[39m confirmOrder(global[33m.[39mmockReq[33m,[39m global[33m.[39mmockRes[33m,[39m global[33m.[39mmockNext)[33m;[39m
     [90m  9 |[39m
    [31m[1m>[22m[39m[90m 10 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledTimes([35m1[39m)[33m;[39m
     [90m    |[39m                                   [31m[1m^[22m[39m
     [90m 11 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledWith(
     [90m 12 |[39m       global[33m.[39mmockReq[33m,[39m
     [90m 13 |[39m       global[33m.[39mmockRes[33m,[39m[0m

      at Object.<anonymous> (src/controllers/orders/confirmOrder.controller.spec.ts:10:35)

PASS src/controllers/attachments/getListOfAttachments.controller.spec.ts
  attachments/getListOfAttachments
    ‚àö Should success (1 ms)

FAIL src/tests/web-socket/socketConnection.spec.ts
  ‚óè Test suite failed to run

    Your test suite must contain at least one test.

      at onResult (node_modules/@jest/core/build/TestScheduler.js:133:18)
      at node_modules/@jest/core/build/TestScheduler.js:254:19
      at node_modules/emittery/index.js:363:13
          at Array.map (<anonymous>)
      at Emittery.emit (node_modules/emittery/index.js:361:23)

PASS src/controllers/packages/getAllPackages.controller.spec.ts (9.785 s)
  packages/getAllPackages
    ‚àö Should succeed and return all packages (14 ms)
    ‚àö Should succeed and empty packages (3 ms)

PASS src/controllers/constants/modifyConstant.controller.spec.ts (9.766 s)
  constants/modifyConstant
    ‚àö Should success and modify constant (16 ms)

PASS src/middleware/allowedClient.middleware.spec.ts (9.786 s)
  allowedClient.middlware
    ‚àö Should success becuase allowed client is right (13 ms)
    ‚àö Should fail since client is not right (2 ms)

PASS src/controllers/services/getAllProviderServices.controller.spec.ts (9.782 s)
  services/getAllProviderServices
    ‚àö Should succeed and return all modules (13 ms)
    ‚àö Should fail because providerId dont belongs to the current user (8 ms)
    ‚àö Should filter by bodyTypeId when provided (3 ms)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"supportId":"cm1a2b3c4d5e6f7g8h9i0j","userId":12345,"contactUserByRegisteredMobile":true,"sendEmail":false,"level":"info","message":"Support request created"}

    [0m [90m 121 |[39m     }
     [90m 122 |[39m
    [31m[1m>[22m[39m[90m 123 |[39m     logger[33m.[39minfo([32m'Support request created'[39m[33m,[39m {
     [90m     |[39m            [31m[1m^[22m[39m
     [90m 124 |[39m       supportId[33m:[39m supportRequest[33m.[39mid[33m,[39m
     [90m 125 |[39m       userId[33m,[39m
     [90m 126 |[39m       relatedOrderId[33m,[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as info] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at createSupportRequest (src/controllers/support/createSupportRequest.controller.ts:123:12)
      at Object.<anonymous> (src/controllers/support/createSupportRequest.controller.spec.ts:49:5)

FAIL src/tests/web-socket/orderChat.spec.ts
  ‚óè Test suite failed to run

    Your test suite must contain at least one test.

      at onResult (node_modules/@jest/core/build/TestScheduler.js:133:18)
      at node_modules/@jest/core/build/TestScheduler.js:254:19
      at node_modules/emittery/index.js:363:13
          at Array.map (<anonymous>)
      at Emittery.emit (node_modules/emittery/index.js:361:23)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"supportId":"cm1a2b3c4d5e6f7g8h9i0j","userEmail":"test@example.com","userId":12345,"level":"info","message":"Support request confirmation email sent"}

    [0m [90m 103 |[39m
     [90m 104 |[39m         [36mif[39m (emailSent) {
    [31m[1m>[22m[39m[90m 105 |[39m           logger[33m.[39minfo([32m'Support request confirmation email sent'[39m[33m,[39m {
     [90m     |[39m                  [31m[1m^[22m[39m
     [90m 106 |[39m             supportId[33m:[39m supportRequest[33m.[39mid[33m,[39m
     [90m 107 |[39m             userEmail[33m:[39m user[33m.[39m[33mEmail[39m[33m,[39m
     [90m 108 |[39m             userId[33m,[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as info] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at createSupportRequest (src/controllers/support/createSupportRequest.controller.ts:105:18)
      at Object.<anonymous> (src/controllers/support/createSupportRequest.controller.spec.ts:112:5)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"supportId":"cm1a2b3c4d5e6f7g8h9i0j","userId":12345,"contactUserByRegisteredMobile":false,"sendEmail":true,"level":"info","message":"Support request created"}

    [0m [90m 121 |[39m     }
     [90m 122 |[39m
    [31m[1m>[22m[39m[90m 123 |[39m     logger[33m.[39minfo([32m'Support request created'[39m[33m,[39m {
     [90m     |[39m            [31m[1m^[22m[39m
     [90m 124 |[39m       supportId[33m:[39m supportRequest[33m.[39mid[33m,[39m
     [90m 125 |[39m       userId[33m,[39m
     [90m 126 |[39m       relatedOrderId[33m,[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as info] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at createSupportRequest (src/controllers/support/createSupportRequest.controller.ts:123:12)
      at Object.<anonymous> (src/controllers/support/createSupportRequest.controller.spec.ts:112:5)

PASS src/controllers/services/addService.controller.spec.ts
  services/addService
    ‚àö Should succeed and return all modules (2 ms)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"supportId":"cm1a2b3c4d5e6f7g8h9i0j","userId":12345,"relatedOrderId":999,"contactUserByRegisteredMobile":true,"sendEmail":false,"level":"info","message":"Support request created"}

    [0m [90m 121 |[39m     }
     [90m 122 |[39m
    [31m[1m>[22m[39m[90m 123 |[39m     logger[33m.[39minfo([32m'Support request created'[39m[33m,[39m {
     [90m     |[39m            [31m[1m^[22m[39m
     [90m 124 |[39m       supportId[33m:[39m supportRequest[33m.[39mid[33m,[39m
     [90m 125 |[39m       userId[33m,[39m
     [90m 126 |[39m       relatedOrderId[33m,[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as info] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at createSupportRequest (src/controllers/support/createSupportRequest.controller.ts:123:12)
      at Object.<anonymous> (src/controllers/support/createSupportRequest.controller.spec.ts:178:5)

PASS src/middleware/auth.middleware.spec.ts (9.815 s)
  auth.middleware
    auth
      ‚àö Should fail becuase no auth token is passed (9 ms)
      ‚àö Should fail becuase auth token is passed but its incorrect(name is incorrect) (1 ms)
      ‚àö Should fail becuase auth token is expired (1 ms)
      ‚àö Should fail because allowed client is not right (6 ms)
      ‚àö Should fail because verson is different than application version (1 ms)
      ‚àö Should success (2 ms)
    authRoute
      ‚àö Should call next in case of headers is sent
      ‚àö Should call fail response with right parameterds (2 ms)
      ‚àö Should inject user id in case of skip auth (1 ms)

FAIL src/controllers/users/verifyEmailOtp.controller.spec.ts
  ‚óè Test suite failed to run

    Your test suite must contain at least one test.

      at onResult (node_modules/@jest/core/build/TestScheduler.js:133:18)
      at node_modules/@jest/core/build/TestScheduler.js:254:19
      at node_modules/emittery/index.js:363:13
          at Array.map (<anonymous>)
      at Emittery.emit (node_modules/emittery/index.js:361:23)

FAIL src/tests/web-socket/chatBasic.spec.ts
  ‚óè Test suite failed to run

    Your test suite must contain at least one test.

      at onResult (node_modules/@jest/core/build/TestScheduler.js:133:18)
      at node_modules/@jest/core/build/TestScheduler.js:254:19
      at node_modules/emittery/index.js:363:13
          at Array.map (<anonymous>)
      at Emittery.emit (node_modules/emittery/index.js:361:23)

FAIL src/controllers/users/sendEmailOtp.controller.spec.ts
  ‚óè Test suite failed to run

    Your test suite must contain at least one test.

      at onResult (node_modules/@jest/core/build/TestScheduler.js:133:18)
      at node_modules/@jest/core/build/TestScheduler.js:254:19
      at node_modules/emittery/index.js:363:13
          at Array.map (<anonymous>)
      at Emittery.emit (node_modules/emittery/index.js:361:23)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"supportId":"cm1a2b3c4d5e6f7g8h9i0j","userId":12345,"contactUserByRegisteredMobile":false,"sendEmail":true,"level":"info","message":"Support request created"}

    [0m [90m 121 |[39m     }
     [90m 122 |[39m
    [31m[1m>[22m[39m[90m 123 |[39m     logger[33m.[39minfo([32m'Support request created'[39m[33m,[39m {
     [90m     |[39m            [31m[1m^[22m[39m
     [90m 124 |[39m       supportId[33m:[39m supportRequest[33m.[39mid[33m,[39m
     [90m 125 |[39m       userId[33m,[39m
     [90m 126 |[39m       relatedOrderId[33m,[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as info] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at createSupportRequest (src/controllers/support/createSupportRequest.controller.ts:123:12)
      at Object.<anonymous> (src/controllers/support/createSupportRequest.controller.spec.ts:305:5)

PASS src/utils/schema.spec.ts (9.833 s)
  schema.ts
    ‚àö Should not accept any additional parameters (11 ms)
    ‚àö Should success (1 ms)

PASS src/controllers/cars/getAllBodyTypes.controller.spec.ts
  cars/getAllBodyTypes
    ‚àö Should return body types (1 ms)

  console.log
    ERROR-BUILDER [GET]  422, Bad request

      at errorMiddleware (src/middleware/error.middleware.ts:70:13)

  console.log
    {
      body: '{}',
      headers: {},
      req_id: undefined,
      additionalData: 'I am additional',
      originalError: 'Bad request'
    }

      at errorMiddleware (src/middleware/error.middleware.ts:71:13)

PASS src/middleware/error.middleware.spec.ts
  error.middleware
    ‚àö Should success and call res.json (36 ms)

PASS src/controllers/cars/getAllCars.controller.spec.ts
  cars/getAllCars
    ‚àö Should success and return all cars (1 ms)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"supportId":"cm1a2b3c4d5e6f7g8h9i0j","userEmail":"test@example.com","userId":12345,"error":{},"level":"error","message":"Failed to send support request email"}

    [0m [90m 110 |[39m         }
     [90m 111 |[39m       } [36mcatch[39m (emailError) {
    [31m[1m>[22m[39m[90m 112 |[39m         logger[33m.[39merror([32m'Failed to send support request email'[39m[33m,[39m {
     [90m     |[39m                [31m[1m^[22m[39m
     [90m 113 |[39m           supportId[33m:[39m supportRequest[33m.[39mid[33m,[39m
     [90m 114 |[39m           userEmail[33m:[39m user[33m.[39m[33mEmail[39m[33m,[39m
     [90m 115 |[39m           userId[33m,[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as error] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at createSupportRequest (src/controllers/support/createSupportRequest.controller.ts:112:16)
      at Object.<anonymous> (src/controllers/support/createSupportRequest.controller.spec.ts:349:5)

FAIL src/controllers/orders/getProviderRevenue.controller.spec.ts
  ‚óè Test suite failed to run

    Your test suite must contain at least one test.

      at onResult (node_modules/@jest/core/build/TestScheduler.js:133:18)
      at node_modules/@jest/core/build/TestScheduler.js:254:19
      at node_modules/emittery/index.js:363:13
          at Array.map (<anonymous>)
      at Emittery.emit (node_modules/emittery/index.js:361:23)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"supportId":"cm1a2b3c4d5e6f7g8h9i0j","userId":12345,"contactUserByRegisteredMobile":false,"sendEmail":true,"level":"info","message":"Support request created"}

    [0m [90m 121 |[39m     }
     [90m 122 |[39m
    [31m[1m>[22m[39m[90m 123 |[39m     logger[33m.[39minfo([32m'Support request created'[39m[33m,[39m {
     [90m     |[39m            [31m[1m^[22m[39m
     [90m 124 |[39m       supportId[33m:[39m supportRequest[33m.[39mid[33m,[39m
     [90m 125 |[39m       userId[33m,[39m
     [90m 126 |[39m       relatedOrderId[33m,[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as info] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at createSupportRequest (src/controllers/support/createSupportRequest.controller.ts:123:12)
      at Object.<anonymous> (src/controllers/support/createSupportRequest.controller.spec.ts:349:5)

  console.log
    User Type: { userType: 'Customer' }

      at getUserType (src/middleware/allowedUserType.middleware.ts:7:11)
          at Array.some (<anonymous>)

PASS src/controllers/support/createSupportRequest.controller.spec.ts (9.874 s)
  support/createSupportRequest
    ‚àö Should successfully create support request without email (54 ms)
    ‚àö Should successfully create support request with email notification (8 ms)
    ‚àö Should successfully create support request with related order (7 ms)
    ‚àö Should fail when user is not authenticated (11 ms)
    ‚àö Should fail when user is not found (5 ms)
    ‚àö Should fail when related order does not exist or does not belong to user (4 ms)
    ‚àö Should handle email service failure gracefully (7 ms)
    ‚àö Should handle email service exception gracefully (15 ms)

  console.log
    User Type: { userType: 'Admin' }

      at getUserType (src/middleware/allowedUserType.middleware.ts:7:11)
          at Array.some (<anonymous>)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"event":"Login failed - Invalid password","success":false,"timestamp":"2025-08-24T14:03:16.346Z","email":"1","level":"warn","message":"[AUTH] Login failed - Invalid password"}

    [0m [90m 253 |[39m   logAuthEvent[33m:[39m (event[33m:[39m string[33m,[39m userId[33m?[39m[33m:[39m number[33m,[39m success[33m:[39m boolean [33m=[39m [36mtrue[39m[33m,[39m meta[33m?[39m[33m:[39m any) [33m=>[39m {
     [90m 254 |[39m     [36mconst[39m level [33m=[39m success [33m?[39m [32m'info'[39m [33m:[39m [32m'warn'[39m[33m;[39m
    [31m[1m>[22m[39m[90m 255 |[39m     enhancedLogger[33m.[39mlog(level[33m,[39m [32m`[AUTH] ${event}`[39m[33m,[39m {
     [90m     |[39m                    [31m[1m^[22m[39m
     [90m 256 |[39m       event[33m,[39m
     [90m 257 |[39m       userId[33m,[39m
     [90m 258 |[39m       success[33m,[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at Object.logAuthEvent (src/utils/logger.ts:255:20)
      at login (src/controllers/users/login.controller.ts:102:19)
      at Object.<anonymous> (src/controllers/users/login.controller.spec.ts:27:5)

PASS src/middleware/allowedUserType.middleware.spec.ts (9.858 s)
  allowedClient.middlware
    ‚àö Should success becuase allowed user type is right (48 ms)
    ‚àö Should fail since user type is not right (1 ms)

PASS src/middleware/mobileCookieInjector.middleware.spec.ts (9.865 s)
  mobileCookietInjector.middleware
    ‚àö Should success and parse cookies from headers (14 ms)
    ‚àö Should success and shouldnt parse cookies from headers (2 ms)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"error":{"status":422,"additionalParameters":"Password incorrect"},"stack":"Error: Invalid username or password\n    at login (K:\\0-CarWashProject\\api\\src\\controllers\\users\\login.controller.ts:103:13)\n    at Object.<anonymous> (K:\\0-CarWashProject\\api\\src\\controllers\\users\\login.controller.spec.ts:27:5)","context":"Login Controller","timestamp":"2025-08-24T14:03:16.406Z","email":"1","level":"error","message":"[Login Controller] Invalid username or password"}

    [0m [90m 228 |[39m     }
     [90m 229 |[39m
    [31m[1m>[22m[39m[90m 230 |[39m     enhancedLogger[33m.[39merror([32m`${context ? `[${context}] ` : ''}${error.message}`[39m[33m,[39m {
     [90m     |[39m                    [31m[1m^[22m[39m
     [90m 231 |[39m       error[33m:[39m {
     [90m 232 |[39m         name[33m:[39m error[33m.[39mname[33m,[39m
     [90m 233 |[39m         message[33m:[39m error[33m.[39mmessage[33m,[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as error] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at Object.logError (src/utils/logger.ts:230:20)
      at login (src/controllers/users/login.controller.ts:210:17)
      at Object.<anonymous> (src/controllers/users/login.controller.spec.ts:27:5)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"event":"Login failed - User not found","success":false,"timestamp":"2025-08-24T14:03:16.416Z","level":"warn","message":"[AUTH] Login failed - User not found"}

    [0m [90m 253 |[39m   logAuthEvent[33m:[39m (event[33m:[39m string[33m,[39m userId[33m?[39m[33m:[39m number[33m,[39m success[33m:[39m boolean [33m=[39m [36mtrue[39m[33m,[39m meta[33m?[39m[33m:[39m any) [33m=>[39m {
     [90m 254 |[39m     [36mconst[39m level [33m=[39m success [33m?[39m [32m'info'[39m [33m:[39m [32m'warn'[39m[33m;[39m
    [31m[1m>[22m[39m[90m 255 |[39m     enhancedLogger[33m.[39mlog(level[33m,[39m [32m`[AUTH] ${event}`[39m[33m,[39m {
     [90m     |[39m                    [31m[1m^[22m[39m
     [90m 256 |[39m       event[33m,[39m
     [90m 257 |[39m       userId[33m,[39m
     [90m 258 |[39m       success[33m,[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at Object.logAuthEvent (src/utils/logger.ts:255:20)
      at login (src/controllers/users/login.controller.ts:91:19)
      at Object.<anonymous> (src/controllers/users/login.controller.spec.ts:46:5)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"error":{"status":422,"additionalParameters":"No user found"},"stack":"Error: Invalid username or password\n    at login (K:\\0-CarWashProject\\api\\src\\controllers\\users\\login.controller.ts:92:13)\n    at Object.<anonymous> (K:\\0-CarWashProject\\api\\src\\controllers\\users\\login.controller.spec.ts:46:5)","context":"Login Controller","timestamp":"2025-08-24T14:03:16.419Z","level":"error","message":"[Login Controller] Invalid username or password"}

    [0m [90m 228 |[39m     }
     [90m 229 |[39m
    [31m[1m>[22m[39m[90m 230 |[39m     enhancedLogger[33m.[39merror([32m`${context ? `[${context}] ` : ''}${error.message}`[39m[33m,[39m {
     [90m     |[39m                    [31m[1m^[22m[39m
     [90m 231 |[39m       error[33m:[39m {
     [90m 232 |[39m         name[33m:[39m error[33m.[39mname[33m,[39m
     [90m 233 |[39m         message[33m:[39m error[33m.[39mmessage[33m,[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as error] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at Object.logError (src/utils/logger.ts:230:20)
      at login (src/controllers/users/login.controller.ts:210:17)
      at Object.<anonymous> (src/controllers/users/login.controller.spec.ts:46:5)

FAIL src/controllers/services/getAllServices.controller.spec.ts
  services/getAllServices
    √ó Should succeed and return all modules (2 ms)

  ‚óè services/getAllServices ‚Ä∫ Should succeed and return all modules

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

    [0m [90m 12 |[39m     [36mawait[39m getAllServices(global[33m.[39mmockReq[33m,[39m global[33m.[39mmockRes[33m,[39m global[33m.[39mmockNext)[33m;[39m
     [90m 13 |[39m
    [31m[1m>[22m[39m[90m 14 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledTimes([35m1[39m)[33m;[39m
     [90m    |[39m                                   [31m[1m^[22m[39m
     [90m 15 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledWith(
     [90m 16 |[39m       global[33m.[39mmockReq[33m,[39m
     [90m 17 |[39m       global[33m.[39mmockRes[33m,[39m[0m

      at Object.<anonymous> (src/controllers/services/getAllServices.controller.spec.ts:14:35)

PASS src/controllers/attachments/getImage.controller.spec.ts (9.931 s)
  attachment/getImage
    ‚àö Should success (13 ms)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"user":"test-otp@example.com","level":"info","message":"OTP email service initialized successfully"}

    [0m [90m 46 |[39m       otpTransporter [33m=[39m nodemailer[33m.[39mcreateTransport(otpConfig)[33m;[39m
     [90m 47 |[39m       isOtpConfigured [33m=[39m [36mtrue[39m[33m;[39m
    [31m[1m>[22m[39m[90m 48 |[39m       logger[33m.[39minfo([32m'OTP email service initialized successfully'[39m[33m,[39m {
     [90m    |[39m              [31m[1m^[22m[39m
     [90m 49 |[39m         user[33m:[39m environment[33m.[39motpEmail[33m.[39muser[33m,[39m
     [90m 50 |[39m       })[33m;[39m
     [90m 51 |[39m     } [36melse[39m {[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as info] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at initializeEmailService (src/services/emailService.ts:48:14)
      at Object.<anonymous> (src/services/emailService.ts:276:1)
      at Object.<anonymous> (src/controllers/users/register.controller.ts:7:1)
      at Object.<anonymous> (src/controllers/users/register.controller.spec.ts:2:1)

FAIL src/controllers/users/updatePassword.controller.spec.ts (9.936 s)
  Update Password Controller
    √ó should successfully update password with valid data (11 ms)
    √ó should throw error when user not found (6 ms)
    √ó should throw error when user is inactive (13 ms)
    ‚àö should throw error with invalid OTP (8 ms)
    ‚àö should handle database errors gracefully (10 ms)

  ‚óè Update Password Controller ‚Ä∫ should successfully update password with valid data

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: {"select": {"Email": true, "id": true, "isActive": true}, "where": {"Email": "test@example.com"}}

    Number of calls: 0

    [0m [90m 34 |[39m     [36mawait[39m updatePassword(global[33m.[39mmockReq[33m,[39m global[33m.[39mmockRes[33m,[39m global[33m.[39mmockNext)[33m;[39m
     [90m 35 |[39m
    [31m[1m>[22m[39m[90m 36 |[39m     expect(prismaMock[33m.[39musers[33m.[39mfindUnique)[33m.[39mtoHaveBeenCalledWith({
     [90m    |[39m                                         [31m[1m^[22m[39m
     [90m 37 |[39m       where[33m:[39m { [33mEmail[39m[33m:[39m [32m'test@example.com'[39m }[33m,[39m
     [90m 38 |[39m       select[33m:[39m {
     [90m 39 |[39m         id[33m:[39m [36mtrue[39m[33m,[39m[0m

      at Object.<anonymous> (src/controllers/users/updatePassword.controller.spec.ts:36:41)

  ‚óè Update Password Controller ‚Ä∫ should throw error when user not found

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

      {"_addBody": [Function _addBody], "_events": {}, "_eventsCount": 0, "_maxListeners": undefined, "_setBaseUrl": [Function _setBaseUrl], "_setBody": [Function _setBody], "_setCookiesVariable": [Function _setCookiesVariable], "_setFilesVariable": [Function _setFilesVariable], "_setHeadersVariable": [Function _setHeadersVariable], "_setMethod": [Function _setMethod], "_setOriginalUrl": [Function _setOriginalUrl], "_setParameter": [Function _setParameter], "_setSessionVariable": [Function _setSessionVariable], "_setSignedCookiesVariable": [Function _setSignedCookiesVariable], "_setURL": [Function _setURL], "accepts": [Function acceptsTypes], "acceptsCharsets": [Function acceptsCharsets], "acceptsEncodings": [Function acceptsEncodings], "acceptsLanguages": [Function acceptsLanguages], "baseUrl": "", "body": {"email": "test@example.com", "newPassword": "newpassword123", "otp": "123456"}, "cookies": {}, "destroy": [Function anonymous], "files": {}, "get": [Function getHeader], "getHeader": [Function getHeader], "header": [Function getHeader], "headers": {"req_id": "test-request-id"}, "hostname": "", "ip": "127.0.0.1", "ips": ["127.0.0.1"], "is": [Function isContentType], "logger": {"error": [Function mockConstructor], "info": [Function mockConstructor], "warn": [Function mockConstructor]}, "method": "GET", "originalUrl": "", "param": [Function param], "params": {}, "path": "", "prisma": undefined, "query": {}, "range": [Function isRange], "send": [Function send], "socket": {}, "subdomains": [], "url": "", "user": {}, Symbol(shapeMode): false, Symbol(kCapture): false, Symbol(Symbol.asyncIterator): [Function asyncIterator]},
      {"_getBuffer": [Function _getBuffer], "_getChunks": [Function _getChunks], "_getData": [Function _getData], "_getHeaders": [Function _getHeaders], "_getJSONData": [Function _getJSONData], "_getLocals": [Function _getLocals], "_getRedirectUrl": [Function _getRedirectUrl], "_getRenderData": [Function _getRenderData], "_getRenderView": [Function _getRenderView], "_getStatusCode": [Function _getStatusCode], "_getStatusMessage": [Function _getStatusMessage], "_headers": {}, "_isDataLengthValid": [Function _isDataLengthValid], "_isEndCalled": [Function _isEndCalled], "_isJSON": [Function _isJSON], "_isUTF8": [Function _isUTF8], "append": [Function append], "appendHeader": [Function appendHeader], "attachment": [Function attachment], "clearCookie": [Function clearCookie], "contentType": [Function contentType], "cookie": [Function cookie], "cookies": {}, "destroy": [Function destroy], "destroySoon": [Function destroySoon], "end": [Function end], "finished": false, "format": [Function format], "get": [Function getHeader], "getEncoding": [Function getEncoding], "getHeader": [Function getHeader], "getHeaderNames": [Function getHeaderNames], "getHeaders": [Function getHeaders], "hasHeader": [Function hasHeader], "header": [Function header], "headersSent": false, "json": [Function json], "jsonp": [Function jsonp], "locals": {}, "location": [Function setLocation], "redirect": [Function redirect], "removeHeader": [Function removeHeader], "render": [Function render], "send": [Function send], "sendStatus": [Function sendStatus], "set": [Function header], "setEncoding": [Function setEncoding], "setHeader": [Function setHeader], "status": [Function status], "statusCode": 200, "statusMessage": "OK", "type": [Function contentType], "vary": [Function vary], "writableEnded": false, "writableFinished": false, "write": [Function write], "writeHead": [Function writeHead]},
    - [Error: Invalid username or password],
    + [Error: Invalid OTP],
      [Function mockConstructor],

    Number of calls: 1

    [0m [90m 70 |[39m     [36mawait[39m updatePassword(global[33m.[39mmockReq[33m,[39m global[33m.[39mmockRes[33m,[39m global[33m.[39mmockNext)[33m;[39m
     [90m 71 |[39m
    [31m[1m>[22m[39m[90m 72 |[39m     expect(createFailResponse)[33m.[39mtoHaveBeenCalledWith(
     [90m    |[39m                                [31m[1m^[22m[39m
     [90m 73 |[39m       global[33m.[39mmockReq[33m,[39m
     [90m 74 |[39m       global[33m.[39mmockRes[33m,[39m
     [90m 75 |[39m       [36mnew[39m [33mHttpException[39m([33mHTTPResponses[39m[33m.[39m[33mBusinessError[39m[33m,[39m [33mHTTPErrorMessages[39m[33m.[39m[33mInvalidUsernameOrPassowrd[39m[33m,[39m [32m'User not found'[39m)[33m,[39m[0m

      at Object.<anonymous> (src/controllers/users/updatePassword.controller.spec.ts:72:32)

  ‚óè Update Password Controller ‚Ä∫ should throw error when user is inactive

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

      {"_addBody": [Function _addBody], "_events": {}, "_eventsCount": 0, "_maxListeners": undefined, "_setBaseUrl": [Function _setBaseUrl], "_setBody": [Function _setBody], "_setCookiesVariable": [Function _setCookiesVariable], "_setFilesVariable": [Function _setFilesVariable], "_setHeadersVariable": [Function _setHeadersVariable], "_setMethod": [Function _setMethod], "_setOriginalUrl": [Function _setOriginalUrl], "_setParameter": [Function _setParameter], "_setSessionVariable": [Function _setSessionVariable], "_setSignedCookiesVariable": [Function _setSignedCookiesVariable], "_setURL": [Function _setURL], "accepts": [Function acceptsTypes], "acceptsCharsets": [Function acceptsCharsets], "acceptsEncodings": [Function acceptsEncodings], "acceptsLanguages": [Function acceptsLanguages], "baseUrl": "", "body": {"email": "test@example.com", "newPassword": "newpassword123", "otp": "123456"}, "cookies": {}, "destroy": [Function anonymous], "files": {}, "get": [Function getHeader], "getHeader": [Function getHeader], "header": [Function getHeader], "headers": {"req_id": "test-request-id"}, "hostname": "", "ip": "127.0.0.1", "ips": ["127.0.0.1"], "is": [Function isContentType], "logger": {"error": [Function mockConstructor], "info": [Function mockConstructor], "warn": [Function mockConstructor]}, "method": "GET", "originalUrl": "", "param": [Function param], "params": {}, "path": "", "prisma": undefined, "query": {}, "range": [Function isRange], "send": [Function send], "socket": {}, "subdomains": [], "url": "", "user": {}, Symbol(shapeMode): false, Symbol(kCapture): false, Symbol(Symbol.asyncIterator): [Function asyncIterator]},
      {"_getBuffer": [Function _getBuffer], "_getChunks": [Function _getChunks], "_getData": [Function _getData], "_getHeaders": [Function _getHeaders], "_getJSONData": [Function _getJSONData], "_getLocals": [Function _getLocals], "_getRedirectUrl": [Function _getRedirectUrl], "_getRenderData": [Function _getRenderData], "_getRenderView": [Function _getRenderView], "_getStatusCode": [Function _getStatusCode], "_getStatusMessage": [Function _getStatusMessage], "_headers": {}, "_isDataLengthValid": [Function _isDataLengthValid], "_isEndCalled": [Function _isEndCalled], "_isJSON": [Function _isJSON], "_isUTF8": [Function _isUTF8], "append": [Function append], "appendHeader": [Function appendHeader], "attachment": [Function attachment], "clearCookie": [Function clearCookie], "contentType": [Function contentType], "cookie": [Function cookie], "cookies": {}, "destroy": [Function destroy], "destroySoon": [Function destroySoon], "end": [Function end], "finished": false, "format": [Function format], "get": [Function getHeader], "getEncoding": [Function getEncoding], "getHeader": [Function getHeader], "getHeaderNames": [Function getHeaderNames], "getHeaders": [Function getHeaders], "hasHeader": [Function hasHeader], "header": [Function header], "headersSent": false, "json": [Function json], "jsonp": [Function jsonp], "locals": {}, "location": [Function setLocation], "redirect": [Function redirect], "removeHeader": [Function removeHeader], "render": [Function render], "send": [Function send], "sendStatus": [Function sendStatus], "set": [Function header], "setEncoding": [Function setEncoding], "setHeader": [Function setHeader], "status": [Function status], "statusCode": 200, "statusMessage": "OK", "type": [Function contentType], "vary": [Function vary], "writableEnded": false, "writableFinished": false, "write": [Function write], "writeHead": [Function writeHead]},
    - [Error: Your account is still inactive/under processing],
    + [Error: Invalid OTP],
      [Function mockConstructor],

    Number of calls: 1

    [0m [90m 90 |[39m     [36mawait[39m updatePassword(global[33m.[39mmockReq[33m,[39m global[33m.[39mmockRes[33m,[39m global[33m.[39mmockNext)[33m;[39m
     [90m 91 |[39m
    [31m[1m>[22m[39m[90m 92 |[39m     expect(createFailResponse)[33m.[39mtoHaveBeenCalledWith(
     [90m    |[39m                                [31m[1m^[22m[39m
     [90m 93 |[39m       global[33m.[39mmockReq[33m,[39m
     [90m 94 |[39m       global[33m.[39mmockRes[33m,[39m
     [90m 95 |[39m       [36mnew[39m [33mHttpException[39m([33mHTTPResponses[39m[33m.[39m[33mBusinessError[39m[33m,[39m [33mHTTPErrorMessages[39m[33m.[39m[33mAccountInactive[39m[33m,[39m {[0m

      at Object.<anonymous> (src/controllers/users/updatePassword.controller.spec.ts:92:32)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"user":"test-support@example.com","level":"info","message":"Support email service initialized successfully"}

    [0m [90m 59 |[39m       supportTransporter [33m=[39m nodemailer[33m.[39mcreateTransport(supportConfig)[33m;[39m
     [90m 60 |[39m       isSupportConfigured [33m=[39m [36mtrue[39m[33m;[39m
    [31m[1m>[22m[39m[90m 61 |[39m       logger[33m.[39minfo([32m'Support email service initialized successfully'[39m[33m,[39m {
     [90m    |[39m              [31m[1m^[22m[39m
     [90m 62 |[39m         user[33m:[39m environment[33m.[39msupportEmail[33m.[39muser[33m,[39m
     [90m 63 |[39m       })[33m;[39m
     [90m 64 |[39m     } [36melse[39m {[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as info] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at initializeEmailService (src/services/emailService.ts:61:14)
      at Object.<anonymous> (src/services/emailService.ts:276:1)
      at Object.<anonymous> (src/controllers/users/register.controller.ts:7:1)
      at Object.<anonymous> (src/controllers/users/register.controller.spec.ts:2:1)

PASS src/utils/encrypt.spec.ts
  encrypt.ts
    ‚àö It should decrypt and decrypt (5 ms)

PASS src/controllers/cars/addCar.controller.spec.ts
  cars/addCar
    ‚àö Should succeed (2 ms)

FAIL src/controllers/orders/getOrderTotalAmountStatements.controller.spec.ts (10.014 s)
  orders/getOrderTotalAmount
    √ó Should success and return the order (10 ms)

  ‚óè orders/getOrderTotalAmount ‚Ä∫ Should success and return the order

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

    [0m [90m 42 |[39m     [36mawait[39m getOrderTotalAmountStatements(global[33m.[39mmockReq[33m,[39m global[33m.[39mmockRes[33m,[39m global[33m.[39mmockNext)[33m;[39m
     [90m 43 |[39m
    [31m[1m>[22m[39m[90m 44 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledTimes([35m1[39m)[33m;[39m
     [90m    |[39m                                   [31m[1m^[22m[39m
     [90m 45 |[39m
     [90m 46 |[39m     [90m//@ts-ignore[39m
     [90m 47 |[39m     [36mconst[39m returnResult [33m=[39m createSuccessResponse[33m.[39mmock[33m.[39mcalls[[35m0[39m][[35m2[39m][33m;[39m[0m

      at Object.<anonymous> (src/controllers/orders/getOrderTotalAmountStatements.controller.spec.ts:44:35)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"method":"GET","path":"/api/non-existent-endpoint","originalUrl":"/api/non-existent-endpoint","ip":"::ffff:127.0.0.1","requestId":"","query":{},"headers":{},"level":"warn","message":"API endpoint not found"}

    [0m [90m 59 |[39m
     [90m 60 |[39m   [90m// Log the 404 attempt with details[39m
    [31m[1m>[22m[39m[90m 61 |[39m   logger[33m.[39mwarn([32m'API endpoint not found'[39m[33m,[39m {
     [90m    |[39m          [31m[1m^[22m[39m
     [90m 62 |[39m     method[33m:[39m req[33m.[39mmethod[33m,[39m
     [90m 63 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m
     [90m 64 |[39m     originalUrl[33m:[39m req[33m.[39moriginalUrl[33m,[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as warn] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at notFoundController (src/controllers/notFound.controller.ts:61:10)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at Route.dispatch (node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at node_modules/express/lib/router/index.js:284:15
      at param (node_modules/express/lib/router/index.js:365:14)
      at param (node_modules/express/lib/router/index.js:376:14)
      at Function.process_params (node_modules/express/lib/router/index.js:421:3)
      at next (node_modules/express/lib/router/index.js:280:10)
      at jsonParser (node_modules/body-parser/lib/types/json.js:113:7)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at expressInit (node_modules/express/lib/middleware/init.js:40:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at query (node_modules/express/lib/middleware/query.js:45:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Function.handle (node_modules/express/lib/router/index.js:175:3)
      at Function.handle (node_modules/express/lib/application.js:181:10)
      at Server.app (node_modules/express/lib/express.js:39:9)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"path":"/api/non-existent-endpoint","originalUrl":"/api/non-existent-endpoint","level":"debug","message":"Request path and originalUrl"}

    [0m [90m 74 |[39m
     [90m 75 |[39m   [90m// Log the values of req.path and req.originalUrl for debugging[39m
    [31m[1m>[22m[39m[90m 76 |[39m   logger[33m.[39mdebug([32m'Request path and originalUrl'[39m[33m,[39m {
     [90m    |[39m          [31m[1m^[22m[39m
     [90m 77 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m
     [90m 78 |[39m     originalUrl[33m:[39m req[33m.[39moriginalUrl[33m,[39m
     [90m 79 |[39m   })[33m;[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as debug] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at notFoundController (src/controllers/notFound.controller.ts:76:10)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at Route.dispatch (node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at node_modules/express/lib/router/index.js:284:15
      at param (node_modules/express/lib/router/index.js:365:14)
      at param (node_modules/express/lib/router/index.js:376:14)
      at Function.process_params (node_modules/express/lib/router/index.js:421:3)
      at next (node_modules/express/lib/router/index.js:280:10)
      at jsonParser (node_modules/body-parser/lib/types/json.js:113:7)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at expressInit (node_modules/express/lib/middleware/init.js:40:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at query (node_modules/express/lib/middleware/query.js:45:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Function.handle (node_modules/express/lib/router/index.js:175:3)
      at Function.handle (node_modules/express/lib/application.js:181:10)
      at Server.app (node_modules/express/lib/express.js:39:9)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"rawUrl":"/api/non-existent-endpoint","headers":{"host":"127.0.0.1:55154","accept-encoding":"gzip, deflate","connection":"close"},"level":"debug","message":"Raw request details"}

    [0m [90m 80 |[39m
     [90m 81 |[39m   [90m// Log raw request URL and headers for debugging[39m
    [31m[1m>[22m[39m[90m 82 |[39m   logger[33m.[39mdebug([32m'Raw request details'[39m[33m,[39m {
     [90m    |[39m          [31m[1m^[22m[39m
     [90m 83 |[39m     rawUrl[33m:[39m req[33m.[39murl[33m,[39m
     [90m 84 |[39m     headers[33m:[39m req[33m.[39mheaders[33m,[39m
     [90m 85 |[39m   })[33m;[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as debug] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at notFoundController (src/controllers/notFound.controller.ts:82:10)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at Route.dispatch (node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at node_modules/express/lib/router/index.js:284:15
      at param (node_modules/express/lib/router/index.js:365:14)
      at param (node_modules/express/lib/router/index.js:376:14)
      at Function.process_params (node_modules/express/lib/router/index.js:421:3)
      at next (node_modules/express/lib/router/index.js:280:10)
      at jsonParser (node_modules/body-parser/lib/types/json.js:113:7)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at expressInit (node_modules/express/lib/middleware/init.js:40:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at query (node_modules/express/lib/middleware/query.js:45:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Function.handle (node_modules/express/lib/router/index.js:175:3)
      at Function.handle (node_modules/express/lib/application.js:181:10)
      at Server.app (node_modules/express/lib/express.js:39:9)

FAIL src/controllers/orders/getOneOrder.controller.spec.ts (10.07 s)
  orders/getOneOrder
    √ó Should success and return the order (9 ms)
    √ó Should fail because no order (1 ms)

  ‚óè orders/getOneOrder ‚Ä∫ Should success and return the order

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

    [0m [90m 16 |[39m     [36mawait[39m getOneOrder(global[33m.[39mmockReq[33m,[39m global[33m.[39mmockRes[33m,[39m global[33m.[39mmockNext)[33m;[39m
     [90m 17 |[39m
    [31m[1m>[22m[39m[90m 18 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledTimes([35m1[39m)[33m;[39m
     [90m    |[39m                                   [31m[1m^[22m[39m
     [90m 19 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledWith(global[33m.[39mmockReq[33m,[39m global[33m.[39mmockRes[33m,[39m { 
     [90m 20 |[39m       id[33m:[39m [35m111[39m[33m,[39m
     [90m 21 |[39m       paymentMethods[33m:[39m {[0m

      at Object.<anonymous> (src/controllers/orders/getOneOrder.controller.spec.ts:18:35)

  ‚óè orders/getOneOrder ‚Ä∫ Should fail because no order

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

    [0m [90m 32 |[39m     [36mawait[39m getOneOrder(global[33m.[39mmockReq[33m,[39m global[33m.[39mmockRes[33m,[39m global[33m.[39mmockNext)[33m;[39m
     [90m 33 |[39m
    [31m[1m>[22m[39m[90m 34 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledTimes([35m1[39m)[33m;[39m
     [90m    |[39m                                   [31m[1m^[22m[39m
     [90m 35 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledWith(global[33m.[39mmockReq[33m,[39m global[33m.[39mmockRes[33m,[39m {}[33m,[39m global[33m.[39mmockNext)[33m;[39m
     [90m 36 |[39m   })[33m;[39m
     [90m 37 |[39m })[33m;[39m[0m

      at Object.<anonymous> (src/controllers/orders/getOneOrder.controller.spec.ts:34:35)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"method":"POST","path":"/api/invalid-endpoint","originalUrl":"/api/invalid-endpoint","ip":"::ffff:127.0.0.1","requestId":"","query":{},"headers":{},"level":"warn","message":"API endpoint not found"}

    [0m [90m 59 |[39m
     [90m 60 |[39m   [90m// Log the 404 attempt with details[39m
    [31m[1m>[22m[39m[90m 61 |[39m   logger[33m.[39mwarn([32m'API endpoint not found'[39m[33m,[39m {
     [90m    |[39m          [31m[1m^[22m[39m
     [90m 62 |[39m     method[33m:[39m req[33m.[39mmethod[33m,[39m
     [90m 63 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m
     [90m 64 |[39m     originalUrl[33m:[39m req[33m.[39moriginalUrl[33m,[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as warn] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at notFoundController (src/controllers/notFound.controller.ts:61:10)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at Route.dispatch (node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at node_modules/express/lib/router/index.js:284:15
      at param (node_modules/express/lib/router/index.js:365:14)
      at param (node_modules/express/lib/router/index.js:376:14)
      at Function.process_params (node_modules/express/lib/router/index.js:421:3)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/body-parser/lib/read.js:137:5
      at invokeCallback (node_modules/raw-body/index.js:238:16)
      at done (node_modules/raw-body/index.js:227:7)
      at IncomingMessage.onEnd (node_modules/raw-body/index.js:287:7)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"path":"/api/invalid-endpoint","originalUrl":"/api/invalid-endpoint","level":"debug","message":"Request path and originalUrl"}

    [0m [90m 74 |[39m
     [90m 75 |[39m   [90m// Log the values of req.path and req.originalUrl for debugging[39m
    [31m[1m>[22m[39m[90m 76 |[39m   logger[33m.[39mdebug([32m'Request path and originalUrl'[39m[33m,[39m {
     [90m    |[39m          [31m[1m^[22m[39m
     [90m 77 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m
     [90m 78 |[39m     originalUrl[33m:[39m req[33m.[39moriginalUrl[33m,[39m
     [90m 79 |[39m   })[33m;[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as debug] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at notFoundController (src/controllers/notFound.controller.ts:76:10)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at Route.dispatch (node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at node_modules/express/lib/router/index.js:284:15
      at param (node_modules/express/lib/router/index.js:365:14)
      at param (node_modules/express/lib/router/index.js:376:14)
      at Function.process_params (node_modules/express/lib/router/index.js:421:3)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/body-parser/lib/read.js:137:5
      at invokeCallback (node_modules/raw-body/index.js:238:16)
      at done (node_modules/raw-body/index.js:227:7)
      at IncomingMessage.onEnd (node_modules/raw-body/index.js:287:7)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"rawUrl":"/api/invalid-endpoint","headers":{"host":"127.0.0.1:55156","accept-encoding":"gzip, deflate","content-type":"application/json","content-length":"15","connection":"close"},"level":"debug","message":"Raw request details"}

    [0m [90m 80 |[39m
     [90m 81 |[39m   [90m// Log raw request URL and headers for debugging[39m
    [31m[1m>[22m[39m[90m 82 |[39m   logger[33m.[39mdebug([32m'Raw request details'[39m[33m,[39m {
     [90m    |[39m          [31m[1m^[22m[39m
     [90m 83 |[39m     rawUrl[33m:[39m req[33m.[39murl[33m,[39m
     [90m 84 |[39m     headers[33m:[39m req[33m.[39mheaders[33m,[39m
     [90m 85 |[39m   })[33m;[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as debug] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at notFoundController (src/controllers/notFound.controller.ts:82:10)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at Route.dispatch (node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at node_modules/express/lib/router/index.js:284:15
      at param (node_modules/express/lib/router/index.js:365:14)
      at param (node_modules/express/lib/router/index.js:376:14)
      at Function.process_params (node_modules/express/lib/router/index.js:421:3)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/body-parser/lib/read.js:137:5
      at invokeCallback (node_modules/raw-body/index.js:238:16)
      at done (node_modules/raw-body/index.js:227:7)
      at IncomingMessage.onEnd (node_modules/raw-body/index.js:287:7)

PASS src/controllers/attachments/uploadAttachment.controller.spec.ts (10.013 s)
  attachment/uploadAttachments
    ‚àö Should success (7 ms)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"method":"PUT","path":"/api/fake-resource/123","originalUrl":"/api/fake-resource/123","ip":"::ffff:127.0.0.1","requestId":"","query":{},"headers":{},"level":"warn","message":"API endpoint not found"}

    [0m [90m 59 |[39m
     [90m 60 |[39m   [90m// Log the 404 attempt with details[39m
    [31m[1m>[22m[39m[90m 61 |[39m   logger[33m.[39mwarn([32m'API endpoint not found'[39m[33m,[39m {
     [90m    |[39m          [31m[1m^[22m[39m
     [90m 62 |[39m     method[33m:[39m req[33m.[39mmethod[33m,[39m
     [90m 63 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m
     [90m 64 |[39m     originalUrl[33m:[39m req[33m.[39moriginalUrl[33m,[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as warn] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at notFoundController (src/controllers/notFound.controller.ts:61:10)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at Route.dispatch (node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at node_modules/express/lib/router/index.js:284:15
      at param (node_modules/express/lib/router/index.js:365:14)
      at param (node_modules/express/lib/router/index.js:376:14)
      at Function.process_params (node_modules/express/lib/router/index.js:421:3)
      at next (node_modules/express/lib/router/index.js:280:10)
      at jsonParser (node_modules/body-parser/lib/types/json.js:122:7)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at expressInit (node_modules/express/lib/middleware/init.js:40:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at query (node_modules/express/lib/middleware/query.js:45:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Function.handle (node_modules/express/lib/router/index.js:175:3)
      at Function.handle (node_modules/express/lib/application.js:181:10)
      at Server.app (node_modules/express/lib/express.js:39:9)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"path":"/api/fake-resource/123","originalUrl":"/api/fake-resource/123","level":"debug","message":"Request path and originalUrl"}

    [0m [90m 74 |[39m
     [90m 75 |[39m   [90m// Log the values of req.path and req.originalUrl for debugging[39m
    [31m[1m>[22m[39m[90m 76 |[39m   logger[33m.[39mdebug([32m'Request path and originalUrl'[39m[33m,[39m {
     [90m    |[39m          [31m[1m^[22m[39m
     [90m 77 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m
     [90m 78 |[39m     originalUrl[33m:[39m req[33m.[39moriginalUrl[33m,[39m
     [90m 79 |[39m   })[33m;[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as debug] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at notFoundController (src/controllers/notFound.controller.ts:76:10)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at Route.dispatch (node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at node_modules/express/lib/router/index.js:284:15
      at param (node_modules/express/lib/router/index.js:365:14)
      at param (node_modules/express/lib/router/index.js:376:14)
      at Function.process_params (node_modules/express/lib/router/index.js:421:3)
      at next (node_modules/express/lib/router/index.js:280:10)
      at jsonParser (node_modules/body-parser/lib/types/json.js:122:7)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at expressInit (node_modules/express/lib/middleware/init.js:40:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at query (node_modules/express/lib/middleware/query.js:45:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Function.handle (node_modules/express/lib/router/index.js:175:3)
      at Function.handle (node_modules/express/lib/application.js:181:10)
      at Server.app (node_modules/express/lib/express.js:39:9)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"rawUrl":"/api/fake-resource/123","headers":{"host":"127.0.0.1:55158","accept-encoding":"gzip, deflate","connection":"close","content-length":"0"},"level":"debug","message":"Raw request details"}

    [0m [90m 80 |[39m
     [90m 81 |[39m   [90m// Log raw request URL and headers for debugging[39m
    [31m[1m>[22m[39m[90m 82 |[39m   logger[33m.[39mdebug([32m'Raw request details'[39m[33m,[39m {
     [90m    |[39m          [31m[1m^[22m[39m
     [90m 83 |[39m     rawUrl[33m:[39m req[33m.[39murl[33m,[39m
     [90m 84 |[39m     headers[33m:[39m req[33m.[39mheaders[33m,[39m
     [90m 85 |[39m   })[33m;[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as debug] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at notFoundController (src/controllers/notFound.controller.ts:82:10)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at Route.dispatch (node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at node_modules/express/lib/router/index.js:284:15
      at param (node_modules/express/lib/router/index.js:365:14)
      at param (node_modules/express/lib/router/index.js:376:14)
      at Function.process_params (node_modules/express/lib/router/index.js:421:3)
      at next (node_modules/express/lib/router/index.js:280:10)
      at jsonParser (node_modules/body-parser/lib/types/json.js:122:7)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at expressInit (node_modules/express/lib/middleware/init.js:40:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at query (node_modules/express/lib/middleware/query.js:45:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Function.handle (node_modules/express/lib/router/index.js:175:3)
      at Function.handle (node_modules/express/lib/application.js:181:10)
      at Server.app (node_modules/express/lib/express.js:39:9)

FAIL src/controllers/orders/addOrder.controller.spec.ts (10.056 s)
  orders/addOrder
    √ó Should succeed (8 ms)
    ‚àö Should fail when payment is not active (3 ms)

  ‚óè orders/addOrder ‚Ä∫ Should succeed

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

    [0m [90m 35 |[39m     [36mawait[39m addOrder(global[33m.[39mmockReq[33m,[39m global[33m.[39mmockRes[33m,[39m global[33m.[39mmockNext)[33m;[39m
     [90m 36 |[39m
    [31m[1m>[22m[39m[90m 37 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledTimes([35m1[39m)[33m;[39m
     [90m    |[39m                                   [31m[1m^[22m[39m
     [90m 38 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledWith(
     [90m 39 |[39m       global[33m.[39mmockReq[33m,[39m
     [90m 40 |[39m       global[33m.[39mmockRes[33m,[39m[0m

      at Object.<anonymous> (src/controllers/orders/addOrder.controller.spec.ts:37:35)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"method":"DELETE","path":"/api/missing-resource","originalUrl":"/api/missing-resource","ip":"::ffff:127.0.0.1","requestId":"","query":{},"headers":{},"level":"warn","message":"API endpoint not found"}

    [0m [90m 59 |[39m
     [90m 60 |[39m   [90m// Log the 404 attempt with details[39m
    [31m[1m>[22m[39m[90m 61 |[39m   logger[33m.[39mwarn([32m'API endpoint not found'[39m[33m,[39m {
     [90m    |[39m          [31m[1m^[22m[39m
     [90m 62 |[39m     method[33m:[39m req[33m.[39mmethod[33m,[39m
     [90m 63 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m
     [90m 64 |[39m     originalUrl[33m:[39m req[33m.[39moriginalUrl[33m,[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as warn] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at notFoundController (src/controllers/notFound.controller.ts:61:10)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at Route.dispatch (node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at node_modules/express/lib/router/index.js:284:15
      at param (node_modules/express/lib/router/index.js:365:14)
      at param (node_modules/express/lib/router/index.js:376:14)
      at Function.process_params (node_modules/express/lib/router/index.js:421:3)
      at next (node_modules/express/lib/router/index.js:280:10)
      at jsonParser (node_modules/body-parser/lib/types/json.js:113:7)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at expressInit (node_modules/express/lib/middleware/init.js:40:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at query (node_modules/express/lib/middleware/query.js:45:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Function.handle (node_modules/express/lib/router/index.js:175:3)
      at Function.handle (node_modules/express/lib/application.js:181:10)
      at Server.app (node_modules/express/lib/express.js:39:9)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"path":"/api/missing-resource","originalUrl":"/api/missing-resource","level":"debug","message":"Request path and originalUrl"}

    [0m [90m 74 |[39m
     [90m 75 |[39m   [90m// Log the values of req.path and req.originalUrl for debugging[39m
    [31m[1m>[22m[39m[90m 76 |[39m   logger[33m.[39mdebug([32m'Request path and originalUrl'[39m[33m,[39m {
     [90m    |[39m          [31m[1m^[22m[39m
     [90m 77 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m
     [90m 78 |[39m     originalUrl[33m:[39m req[33m.[39moriginalUrl[33m,[39m
     [90m 79 |[39m   })[33m;[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as debug] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at notFoundController (src/controllers/notFound.controller.ts:76:10)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at Route.dispatch (node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at node_modules/express/lib/router/index.js:284:15
      at param (node_modules/express/lib/router/index.js:365:14)
      at param (node_modules/express/lib/router/index.js:376:14)
      at Function.process_params (node_modules/express/lib/router/index.js:421:3)
      at next (node_modules/express/lib/router/index.js:280:10)
      at jsonParser (node_modules/body-parser/lib/types/json.js:113:7)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at expressInit (node_modules/express/lib/middleware/init.js:40:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at query (node_modules/express/lib/middleware/query.js:45:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Function.handle (node_modules/express/lib/router/index.js:175:3)
      at Function.handle (node_modules/express/lib/application.js:181:10)
      at Server.app (node_modules/express/lib/express.js:39:9)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"rawUrl":"/api/missing-resource","headers":{"host":"127.0.0.1:55160","accept-encoding":"gzip, deflate","connection":"close"},"level":"debug","message":"Raw request details"}

    [0m [90m 80 |[39m
     [90m 81 |[39m   [90m// Log raw request URL and headers for debugging[39m
    [31m[1m>[22m[39m[90m 82 |[39m   logger[33m.[39mdebug([32m'Raw request details'[39m[33m,[39m {
     [90m    |[39m          [31m[1m^[22m[39m
     [90m 83 |[39m     rawUrl[33m:[39m req[33m.[39murl[33m,[39m
     [90m 84 |[39m     headers[33m:[39m req[33m.[39mheaders[33m,[39m
     [90m 85 |[39m   })[33m;[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as debug] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at notFoundController (src/controllers/notFound.controller.ts:82:10)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at Route.dispatch (node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at node_modules/express/lib/router/index.js:284:15
      at param (node_modules/express/lib/router/index.js:365:14)
      at param (node_modules/express/lib/router/index.js:376:14)
      at Function.process_params (node_modules/express/lib/router/index.js:421:3)
      at next (node_modules/express/lib/router/index.js:280:10)
      at jsonParser (node_modules/body-parser/lib/types/json.js:113:7)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at expressInit (node_modules/express/lib/middleware/init.js:40:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at query (node_modules/express/lib/middleware/query.js:45:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Function.handle (node_modules/express/lib/router/index.js:175:3)
      at Function.handle (node_modules/express/lib/application.js:181:10)
      at Server.app (node_modules/express/lib/express.js:39:9)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"method":"GET","path":"/api/nowhere","originalUrl":"/api/nowhere","ip":"::ffff:127.0.0.1","requestId":"test-request-123","query":{},"headers":{},"level":"warn","message":"API endpoint not found"}

    [0m [90m 59 |[39m
     [90m 60 |[39m   [90m// Log the 404 attempt with details[39m
    [31m[1m>[22m[39m[90m 61 |[39m   logger[33m.[39mwarn([32m'API endpoint not found'[39m[33m,[39m {
     [90m    |[39m          [31m[1m^[22m[39m
     [90m 62 |[39m     method[33m:[39m req[33m.[39mmethod[33m,[39m
     [90m 63 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m
     [90m 64 |[39m     originalUrl[33m:[39m req[33m.[39moriginalUrl[33m,[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as warn] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at notFoundController (src/controllers/notFound.controller.ts:61:10)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at Route.dispatch (node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at node_modules/express/lib/router/index.js:284:15
      at param (node_modules/express/lib/router/index.js:365:14)
      at param (node_modules/express/lib/router/index.js:376:14)
      at Function.process_params (node_modules/express/lib/router/index.js:421:3)
      at next (node_modules/express/lib/router/index.js:280:10)
      at jsonParser (node_modules/body-parser/lib/types/json.js:113:7)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at expressInit (node_modules/express/lib/middleware/init.js:40:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at query (node_modules/express/lib/middleware/query.js:45:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Function.handle (node_modules/express/lib/router/index.js:175:3)
      at Function.handle (node_modules/express/lib/application.js:181:10)
      at Server.app (node_modules/express/lib/express.js:39:9)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"path":"/api/nowhere","originalUrl":"/api/nowhere","level":"debug","message":"Request path and originalUrl"}

    [0m [90m 74 |[39m
     [90m 75 |[39m   [90m// Log the values of req.path and req.originalUrl for debugging[39m
    [31m[1m>[22m[39m[90m 76 |[39m   logger[33m.[39mdebug([32m'Request path and originalUrl'[39m[33m,[39m {
     [90m    |[39m          [31m[1m^[22m[39m
     [90m 77 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m
     [90m 78 |[39m     originalUrl[33m:[39m req[33m.[39moriginalUrl[33m,[39m
     [90m 79 |[39m   })[33m;[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as debug] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at notFoundController (src/controllers/notFound.controller.ts:76:10)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at Route.dispatch (node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at node_modules/express/lib/router/index.js:284:15
      at param (node_modules/express/lib/router/index.js:365:14)
      at param (node_modules/express/lib/router/index.js:376:14)
      at Function.process_params (node_modules/express/lib/router/index.js:421:3)
      at next (node_modules/express/lib/router/index.js:280:10)
      at jsonParser (node_modules/body-parser/lib/types/json.js:113:7)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at expressInit (node_modules/express/lib/middleware/init.js:40:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at query (node_modules/express/lib/middleware/query.js:45:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Function.handle (node_modules/express/lib/router/index.js:175:3)
      at Function.handle (node_modules/express/lib/application.js:181:10)
      at Server.app (node_modules/express/lib/express.js:39:9)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"rawUrl":"/api/nowhere","headers":{"host":"127.0.0.1:55162","accept-encoding":"gzip, deflate","req_id":"test-request-123","connection":"close"},"level":"debug","message":"Raw request details"}

    [0m [90m 80 |[39m
     [90m 81 |[39m   [90m// Log raw request URL and headers for debugging[39m
    [31m[1m>[22m[39m[90m 82 |[39m   logger[33m.[39mdebug([32m'Raw request details'[39m[33m,[39m {
     [90m    |[39m          [31m[1m^[22m[39m
     [90m 83 |[39m     rawUrl[33m:[39m req[33m.[39murl[33m,[39m
     [90m 84 |[39m     headers[33m:[39m req[33m.[39mheaders[33m,[39m
     [90m 85 |[39m   })[33m;[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as debug] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at notFoundController (src/controllers/notFound.controller.ts:82:10)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at Route.dispatch (node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at node_modules/express/lib/router/index.js:284:15
      at param (node_modules/express/lib/router/index.js:365:14)
      at param (node_modules/express/lib/router/index.js:376:14)
      at Function.process_params (node_modules/express/lib/router/index.js:421:3)
      at next (node_modules/express/lib/router/index.js:280:10)
      at jsonParser (node_modules/body-parser/lib/types/json.js:113:7)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at expressInit (node_modules/express/lib/middleware/init.js:40:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at query (node_modules/express/lib/middleware/query.js:45:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Function.handle (node_modules/express/lib/router/index.js:175:3)
      at Function.handle (node_modules/express/lib/application.js:181:10)
      at Server.app (node_modules/express/lib/express.js:39:9)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"method":"GET","path":"/api/missing","originalUrl":"/api/missing?param1=value1&param2=value2","ip":"::ffff:127.0.0.1","requestId":"","query":{"param1":"value1","param2":"value2"},"headers":{},"level":"warn","message":"API endpoint not found"}

    [0m [90m 59 |[39m
     [90m 60 |[39m   [90m// Log the 404 attempt with details[39m
    [31m[1m>[22m[39m[90m 61 |[39m   logger[33m.[39mwarn([32m'API endpoint not found'[39m[33m,[39m {
     [90m    |[39m          [31m[1m^[22m[39m
     [90m 62 |[39m     method[33m:[39m req[33m.[39mmethod[33m,[39m
     [90m 63 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m
     [90m 64 |[39m     originalUrl[33m:[39m req[33m.[39moriginalUrl[33m,[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as warn] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at notFoundController (src/controllers/notFound.controller.ts:61:10)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at next (node_modules/express/lib/router/route.js:145:7)
      at Route.dispatch (node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at node_modules/express/lib/router/index.js:284:15
      at param (node_modules/express/lib/router/index.js:365:14)
      at param (node_modules/express/lib/router/index.js:376:14)
      at Function.process_params (node_modules/express/lib/router/index.js:421:3)
      at next (node_modules/express/lib/router/index.js:280:10)
      at jsonParser (node_modules/body-parser/lib/types/json.js:113:7)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at expressInit (node_modules/express/lib/middleware/init.js:40:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at query (node_modules/express/lib/middleware/query.js:45:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Function.handle (node_modules/express/lib/router/index.js:175:3)
      at Function.handle (node_modules/express/lib/application.js:181:10)
      at Server.app (node_modules/express/lib/express.js:39:9)

PASS src/controllers/notFound.controller.spec.ts (10.107 s)
  404 Not Found Controller
    GET /api/non-existent-endpoint
      ‚àö should return 404 with proper structure for non-existent API endpoint (73 ms)
      ‚àö should return 404 for POST requests to non-existent endpoints (21 ms)
      ‚àö should return 404 for PUT requests to non-existent endpoints (14 ms)
      ‚àö should return 404 for DELETE requests to non-existent endpoints (12 ms)
      ‚àö should include request ID in the response header (9 ms)
      ‚àö should handle query parameters in 404 response (6 ms)
    Edge Cases
      ‚àö should handle very long invalid paths (3 ms)
      ‚àö should handle paths with special characters (3 ms)
      ‚àö should not interfere with existing valid endpoints

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"type":"EMAIL_VERIFICATION","expiresAt":"2025-08-24T14:13:16.653Z","otpLength":6,"level":"info","message":"OTP generated successfully"}

    [0m [90m 67 |[39m     })[33m;[39m
     [90m 68 |[39m
    [31m[1m>[22m[39m[90m 69 |[39m     logger[33m.[39minfo([32m'OTP generated successfully'[39m[33m,[39m {
     [90m    |[39m            [31m[1m^[22m[39m
     [90m 70 |[39m       email[33m,[39m
     [90m 71 |[39m       type[33m,[39m
     [90m 72 |[39m       expiresAt[33m,[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as info] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at generateOtp (src/services/otpService.ts:69:12)
      at registerUser (src/controllers/users/register.controller.ts:100:23)
      at Object.<anonymous> (src/controllers/users/register.controller.spec.ts:9:5)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"type":"EMAIL_VERIFICATION","error":{"errno":-4078,"code":"ESOCKET","syscall":"connect","address":"::1","port":587,"command":"CONN"},"level":"error","message":"Failed to send OTP email"}

    [0m [90m 148 |[39m     }
     [90m 149 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 150 |[39m     logger[33m.[39merror([32m'Failed to send OTP email'[39m[33m,[39m {
     [90m     |[39m            [31m[1m^[22m[39m
     [90m 151 |[39m       to[33m:[39m email[33m,[39m
     [90m 152 |[39m       type[33m,[39m
     [90m 153 |[39m       error[33m:[39m error [36minstanceof[39m [33mError[39m [33m?[39m error[33m.[39mmessage [33m:[39m error[33m,[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as error] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at sendOTPEmail (src/services/emailService.ts:150:12)
      at registerUser (src/controllers/users/register.controller.ts:111:23)
      at Object.<anonymous> (src/controllers/users/register.controller.spec.ts:9:5)

FAIL src/controllers/users/register.controller.spec.ts
  users/register
    √ó Should success (198 ms)

  ‚óè users/register ‚Ä∫ Should success

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

      {"_addBody": [Function _addBody], "_events": {}, "_eventsCount": 0, "_maxListeners": undefined, "_setBaseUrl": [Function _setBaseUrl], "_setBody": [Function _setBody], "_setCookiesVariable": [Function _setCookiesVariable], "_setFilesVariable": [Function _setFilesVariable], "_setHeadersVariable": [Function _setHeadersVariable], "_setMethod": [Function _setMethod], "_setOriginalUrl": [Function _setOriginalUrl], "_setParameter": [Function _setParameter], "_setSessionVariable": [Function _setSessionVariable], "_setSignedCookiesVariable": [Function _setSignedCookiesVariable], "_setURL": [Function _setURL], "accepts": [Function acceptsTypes], "acceptsCharsets": [Function acceptsCharsets], "acceptsEncodings": [Function acceptsEncodings], "acceptsLanguages": [Function acceptsLanguages], "baseUrl": "", "body": {"Password": "Test", "UserTypeName": "Test"}, "cookies": {}, "destroy": [Function anonymous], "files": {}, "get": [Function getHeader], "getHeader": [Function getHeader], "header": [Function getHeader], "headers": {}, "hostname": "", "ip": "127.0.0.1", "ips": ["127.0.0.1"], "is": [Function isContentType], "logger": {"error": [Function mockConstructor], "info": [Function mockConstructor], "warn": [Function mockConstructor]}, "method": "GET", "originalUrl": "", "param": [Function param], "params": {}, "path": "", "prisma": undefined, "query": {}, "range": [Function isRange], "send": [Function send], "socket": {}, "subdomains": [], "url": "", "user": {}, Symbol(shapeMode): false, Symbol(kCapture): false, Symbol(Symbol.asyncIterator): [Function asyncIterator]},
      {"_getBuffer": [Function _getBuffer], "_getChunks": [Function _getChunks], "_getData": [Function _getData], "_getHeaders": [Function _getHeaders], "_getJSONData": [Function _getJSONData], "_getLocals": [Function _getLocals], "_getRedirectUrl": [Function _getRedirectUrl], "_getRenderData": [Function _getRenderData], "_getRenderView": [Function _getRenderView], "_getStatusCode": [Function _getStatusCode], "_getStatusMessage": [Function _getStatusMessage], "_headers": {}, "_isDataLengthValid": [Function _isDataLengthValid], "_isEndCalled": [Function _isEndCalled], "_isJSON": [Function _isJSON], "_isUTF8": [Function _isUTF8], "append": [Function append], "appendHeader": [Function appendHeader], "attachment": [Function attachment], "clearCookie": [Function clearCookie], "contentType": [Function contentType], "cookie": [Function cookie], "cookies": {}, "destroy": [Function destroy], "destroySoon": [Function destroySoon], "end": [Function end], "finished": false, "format": [Function format], "get": [Function getHeader], "getEncoding": [Function getEncoding], "getHeader": [Function getHeader], "getHeaderNames": [Function getHeaderNames], "getHeaders": [Function getHeaders], "hasHeader": [Function hasHeader], "header": [Function header], "headersSent": false, "json": [Function json], "jsonp": [Function jsonp], "locals": {}, "location": [Function setLocation], "redirect": [Function redirect], "removeHeader": [Function removeHeader], "render": [Function render], "send": [Function send], "sendStatus": [Function sendStatus], "set": [Function header], "setEncoding": [Function setEncoding], "setHeader": [Function setHeader], "status": [Function status], "statusCode": 200, "statusMessage": "OK", "type": [Function contentType], "vary": [Function vary], "writableEnded": false, "writableFinished": false, "write": [Function write], "writeHead": [Function writeHead]},
      Object {
    +   "emailSent": false,
        "id": 1,
        "result": true,
      },
      [Function mockConstructor],

    Number of calls: 1

    [0m [90m 10 |[39m
     [90m 11 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledTimes([35m1[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 12 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledWith(
     [90m    |[39m                                   [31m[1m^[22m[39m
     [90m 13 |[39m       global[33m.[39mmockReq[33m,[39m
     [90m 14 |[39m       global[33m.[39mmockRes[33m,[39m
     [90m 15 |[39m       { result[33m:[39m [36mtrue[39m[33m,[39m id[33m:[39m [35m1[39m }[33m,[39m[0m

      at Object.<anonymous> (src/controllers/users/register.controller.spec.ts:12:35)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"error":{"status":422,"additionalParameters":"Email not verified"},"stack":"Error: Email not verified\n    at login (K:\\0-CarWashProject\\api\\src\\controllers\\users\\login.controller.ts:132:13)\n    at Object.<anonymous> (K:\\0-CarWashProject\\api\\src\\controllers\\users\\login.controller.spec.ts:74:5)","context":"Login Controller","timestamp":"2025-08-24T14:03:16.753Z","email":"1","level":"error","message":"[Login Controller] Email not verified"}

    [0m [90m 228 |[39m     }
     [90m 229 |[39m
    [31m[1m>[22m[39m[90m 230 |[39m     enhancedLogger[33m.[39merror([32m`${context ? `[${context}] ` : ''}${error.message}`[39m[33m,[39m {
     [90m     |[39m                    [31m[1m^[22m[39m
     [90m 231 |[39m       error[33m:[39m {
     [90m 232 |[39m         name[33m:[39m error[33m.[39mname[33m,[39m
     [90m 233 |[39m         message[33m:[39m error[33m.[39mmessage[33m,[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as error] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at Object.logError (src/utils/logger.ts:230:20)
      at login (src/controllers/users/login.controller.ts:210:17)
      at Object.<anonymous> (src/controllers/users/login.controller.spec.ts:74:5)

PASS src/controllers/orders/getAllOrders.controller.spec.ts
  Get All Orders Controller
    ‚àö should successfully get all orders without filters (1 ms)
    ‚àö should handle database errors gracefully (1 ms)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"error":{"status":422,"additionalParameters":"Email not verified"},"stack":"Error: Email not verified\n    at login (K:\\0-CarWashProject\\api\\src\\controllers\\users\\login.controller.ts:132:13)\n    at Object.<anonymous> (K:\\0-CarWashProject\\api\\src\\controllers\\users\\login.controller.spec.ts:105:5)","context":"Login Controller","timestamp":"2025-08-24T14:03:17.075Z","email":"1","level":"error","message":"[Login Controller] Email not verified"}

    [0m [90m 228 |[39m     }
     [90m 229 |[39m
    [31m[1m>[22m[39m[90m 230 |[39m     enhancedLogger[33m.[39merror([32m`${context ? `[${context}] ` : ''}${error.message}`[39m[33m,[39m {
     [90m     |[39m                    [31m[1m^[22m[39m
     [90m 231 |[39m       error[33m:[39m {
     [90m 232 |[39m         name[33m:[39m error[33m.[39mname[33m,[39m
     [90m 233 |[39m         message[33m:[39m error[33m.[39mmessage[33m,[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as error] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at Object.logError (src/utils/logger.ts:230:20)
      at login (src/controllers/users/login.controller.ts:210:17)
      at Object.<anonymous> (src/controllers/users/login.controller.spec.ts:105:5)

  console.log
    ORDER_TIMEOUT_SECONDS: 3

      at Object.<anonymous> (src/web-socket/index.ts:316:9)

  console.log
    ORDER_TIMEOUT_SECONDS: 3

      at Object.<anonymous> (src/web-socket/index.ts:316:9)

  console.log
    Redis adapter not available - running in single-process mode

      at Object.<anonymous> (src/web-socket/index.ts:365:11)

  console.log
    Redis adapter not available - running in single-process mode

      at Object.<anonymous> (src/web-socket/index.ts:365:11)

  console.log
    [SOCKET-REDIS] Test environment - using in-memory storage

      at Object.initializeSocketData (src/utils/socketRedisManager.ts:35:13)

  console.log
    [SOCKET] Chat functions initialized successfully

      at src/web-socket/index.ts:404:13

  console.log
    [SOCKET] Redis manager initialized successfully - 0 providers, 0 orders

      at src/web-socket/index.ts:379:13

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"reason":"Accepted","notes":"","level":"info","message":"Adding order history"}

    [0m [90m 467 |[39m [36mexport[39m [36mconst[39m addOrderHistory [33m=[39m [36masync[39m (order[33m:[39m [33mActiveOrders[39m[33m,[39m reason[33m:[39m [33mOrderHistory[39m[33m,[39m notes[33m:[39m string [33m|[39m undefined) [33m=>[39m {
     [90m 468 |[39m   [36mtry[39m {
    [31m[1m>[22m[39m[90m 469 |[39m     logger[33m.[39minfo([32m'Adding order history'[39m[33m,[39m {
     [90m     |[39m            [31m[1m^[22m[39m
     [90m 470 |[39m       orderId[33m:[39m order[33m.[39morderId[33m,[39m
     [90m 471 |[39m       reason[33m:[39m reason[33m.[39mtoString()[33m,[39m
     [90m 472 |[39m       providerUuid[33m:[39m order[33m.[39mproviderUuid[33m,[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as info] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at Object.addOrderHistory (src/web-socket/index.ts:469:12)
      at Object.<anonymous> (src/web-socket/index.functions.spec.ts:27:27)

  console.log
    [SOCKET] Chat functions initialized successfully

      at src/web-socket/index.ts:404:13

  console.log
    [SOCKET] Redis manager initialized successfully - 0 providers, 0 orders

      at src/web-socket/index.ts:379:13

  console.log
    [SOCKET - Broadcast online providers] Broadcasting online providers, Total Online Providers : 0

      at Object.broadcastOnlineProvider (src/web-socket/index.ts:502:11)

FAIL src/web-socket/index.functions.spec.ts (10.7 s)
  web-socket/index.ts [Socket functions]
    ‚àö [addOrderHistory] Should pass and call orderHistory (16 ms)
    √ó [broadcastOnlineProviders] Should pass and send online providers to all online users (2 ms)

  ‚óè web-socket/index.ts [Socket functions] ‚Ä∫ [broadcastOnlineProviders] Should pass and send online providers to all online users

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "online-users", Anything

    Number of calls: 0

    [0m [90m 32 |[39m   it([32m'[broadcastOnlineProviders] Should pass and send online providers to all online users'[39m[33m,[39m () [33m=>[39m {
     [90m 33 |[39m     socketFunctions[33m.[39mbroadcastOnlineProvider(mockSocket [36mas[39m any)[33m;[39m
    [31m[1m>[22m[39m[90m 34 |[39m     expect(mockSocket[33m.[39mbroadcast[33m.[39memit)[33m.[39mtoHaveBeenCalledWith([32m'online-users'[39m[33m,[39m expect[33m.[39manything())[33m;[39m
     [90m    |[39m                                       [31m[1m^[22m[39m
     [90m 35 |[39m     expect(mockSocket[33m.[39memit)[33m.[39mtoHaveBeenCalledWith([32m'online-users'[39m[33m,[39m expect[33m.[39manything())[33m;[39m
     [90m 36 |[39m   })[33m;[39m
     [90m 37 |[39m })[33m;[39m[0m

      at Object.<anonymous> (src/web-socket/index.functions.spec.ts:34:39)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"socketId":"nPC7vKHaz-RRRzC-AAAC","level":"info","message":"Socket connected successfully"}

    [0m [90m 984 |[39m     [90m// inject user id coming from socket[39m
     [90m 985 |[39m     socket[33m.[39mdata[33m.[39muserInfo [33m=[39m socket[33m.[39mhandshake[33m.[39mauth[[32m'userInfo'[39m][33m;[39m
    [31m[1m>[22m[39m[90m 986 |[39m     logger[33m.[39minfo([32m'Socket connected successfully'[39m[33m,[39m {
     [90m     |[39m            [31m[1m^[22m[39m
     [90m 987 |[39m       socketId[33m:[39m socket[33m.[39mid[33m,[39m
     [90m 988 |[39m       userId[33m:[39m socket[33m.[39mdata[33m.[39muserInfo[33m?[39m[33m.[39mid[33m,[39m
     [90m 989 |[39m     })[33m;[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as info] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at Array.<anonymous> (src/web-socket/index.ts:986:12)
      at run (node_modules/socket.io/dist/namespace.js:130:19)
      at Namespace.run (node_modules/socket.io/dist/namespace.js:141:9)
      at Namespace._add (node_modules/socket.io/dist/namespace.js:218:14)

  console.log
    user undefined

      at Namespace.<anonymous> (src/web-socket/index.ts:1003:11)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"socketId":"N2ONQLtEmYz_Rx7rAAAD","level":"info","message":"Socket connected successfully"}

    [0m [90m 984 |[39m     [90m// inject user id coming from socket[39m
     [90m 985 |[39m     socket[33m.[39mdata[33m.[39muserInfo [33m=[39m socket[33m.[39mhandshake[33m.[39mauth[[32m'userInfo'[39m][33m;[39m
    [31m[1m>[22m[39m[90m 986 |[39m     logger[33m.[39minfo([32m'Socket connected successfully'[39m[33m,[39m {
     [90m     |[39m            [31m[1m^[22m[39m
     [90m 987 |[39m       socketId[33m:[39m socket[33m.[39mid[33m,[39m
     [90m 988 |[39m       userId[33m:[39m socket[33m.[39mdata[33m.[39muserInfo[33m?[39m[33m.[39mid[33m,[39m
     [90m 989 |[39m     })[33m;[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as info] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at Array.<anonymous> (src/web-socket/index.ts:986:12)
      at run (node_modules/socket.io/dist/namespace.js:130:19)
      at Namespace.run (node_modules/socket.io/dist/namespace.js:141:9)
      at Namespace._add (node_modules/socket.io/dist/namespace.js:218:14)

  console.log
    user undefined

      at Namespace.<anonymous> (src/web-socket/index.ts:1003:11)

  console.log
    Start 1

      at Object.<anonymous> (src/web-socket/index.spec.ts:200:13)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"error":"Unauthorised","socketId":"MxGoxDUniymVJ07JAAAF","level":"error","message":"Socket connection error"}

    [0m [90m 990 |[39m     next()[33m;[39m
     [90m 991 |[39m   } [36mcatch[39m (error[33m:[39m any) {
    [31m[1m>[22m[39m[90m 992 |[39m     logger[33m.[39merror([32m'Socket connection error'[39m[33m,[39m {
     [90m     |[39m            [31m[1m^[22m[39m
     [90m 993 |[39m       error[33m:[39m error[33m?[39m[33m.[39mmessage [33m||[39m error[33m,[39m
     [90m 994 |[39m       socketId[33m:[39m socket[33m.[39mid[33m,[39m
     [90m 995 |[39m     })[33m;[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as error] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at Array.<anonymous> (src/web-socket/index.ts:992:12)
      at run (node_modules/socket.io/dist/namespace.js:130:19)
      at Namespace.run (node_modules/socket.io/dist/namespace.js:141:9)
      at Namespace._add (node_modules/socket.io/dist/namespace.js:218:14)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"socketId":"WGCFhQH-tiLSSgigAAAI","level":"info","message":"Socket connected successfully"}

    [0m [90m 984 |[39m     [90m// inject user id coming from socket[39m
     [90m 985 |[39m     socket[33m.[39mdata[33m.[39muserInfo [33m=[39m socket[33m.[39mhandshake[33m.[39mauth[[32m'userInfo'[39m][33m;[39m
    [31m[1m>[22m[39m[90m 986 |[39m     logger[33m.[39minfo([32m'Socket connected successfully'[39m[33m,[39m {
     [90m     |[39m            [31m[1m^[22m[39m
     [90m 987 |[39m       socketId[33m:[39m socket[33m.[39mid[33m,[39m
     [90m 988 |[39m       userId[33m:[39m socket[33m.[39mdata[33m.[39muserInfo[33m?[39m[33m.[39mid[33m,[39m
     [90m 989 |[39m     })[33m;[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as info] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at Array.<anonymous> (src/web-socket/index.ts:986:12)
      at run (node_modules/socket.io/dist/namespace.js:130:19)
      at Namespace.run (node_modules/socket.io/dist/namespace.js:141:9)
      at Namespace._add (node_modules/socket.io/dist/namespace.js:218:14)

  console.log
    user undefined

      at Namespace.<anonymous> (src/web-socket/index.ts:1003:11)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"socketId":"3W0c6tQyvi9TK21gAAAJ","level":"info","message":"Socket connected successfully"}

    [0m [90m 984 |[39m     [90m// inject user id coming from socket[39m
     [90m 985 |[39m     socket[33m.[39mdata[33m.[39muserInfo [33m=[39m socket[33m.[39mhandshake[33m.[39mauth[[32m'userInfo'[39m][33m;[39m
    [31m[1m>[22m[39m[90m 986 |[39m     logger[33m.[39minfo([32m'Socket connected successfully'[39m[33m,[39m {
     [90m     |[39m            [31m[1m^[22m[39m
     [90m 987 |[39m       socketId[33m:[39m socket[33m.[39mid[33m,[39m
     [90m 988 |[39m       userId[33m:[39m socket[33m.[39mdata[33m.[39muserInfo[33m?[39m[33m.[39mid[33m,[39m
     [90m 989 |[39m     })[33m;[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as info] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at Array.<anonymous> (src/web-socket/index.ts:986:12)
      at run (node_modules/socket.io/dist/namespace.js:130:19)
      at Namespace.run (node_modules/socket.io/dist/namespace.js:141:9)
      at Namespace._add (node_modules/socket.io/dist/namespace.js:218:14)

  console.log
    user undefined

      at Namespace.<anonymous> (src/web-socket/index.ts:1003:11)

  console.log
    Start 2

      at Object.<anonymous> (src/web-socket/index.spec.ts:213:13)

  console.log
    [SOCKET] [Provider] [Add] => Adding new provdider {"newArgs":{"latitude":10,"longitude":10,"notifcationToken":"","providerId":1,"status":"Online","userId":1,"uuid":"3W0c6tQyvi9TK21gAAAJ","moduleId":1}}

      at addProvider (src/web-socket/index.ts:642:11)

  console.log
    [SOCKET - Broadcast online providers] Broadcasting online providers, Total Online Providers : 1

      at broadcastOnlineProvider (src/web-socket/index.ts:502:11)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"socketId":"WGCFhQH-tiLSSgigAAAI","reason":"client namespace disconnect","level":"info","message":"Socket disconnected:"}

    [0m [90m 1214 |[39m       }
     [90m 1215 |[39m
    [31m[1m>[22m[39m[90m 1216 |[39m       logger[33m.[39minfo([32m'Socket disconnected:'[39m[33m,[39m {
     [90m      |[39m              [31m[1m^[22m[39m
     [90m 1217 |[39m         socketId[33m:[39m socket[33m.[39mid[33m,[39m
     [90m 1218 |[39m         reason[33m,[39m
     [90m 1219 |[39m         userId[33m:[39m socket[33m.[39mdata[33m?[39m[33m.[39muserInfo[33m?[39m[33m.[39mid [33m||[39m userId[33m,[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as info] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at Socket.<anonymous> (src/web-socket/index.ts:1216:14)
      at Socket.emitReserved (node_modules/socket.io/dist/typed-events.js:56:22)
      at Socket._onclose (node_modules/socket.io/dist/socket.js:554:14)
      at Socket.ondisconnect (node_modules/socket.io/dist/socket.js:513:14)
      at Socket._onpacket (node_modules/socket.io/dist/socket.js:442:22)
      at node_modules/socket.io/dist/client.js:214:24

  console.log
    [SOCKET] Socket disconnected: client namespace disconnect

      at Socket.<anonymous> (src/web-socket/index.ts:1221:15)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"socketId":"nPC7vKHaz-RRRzC-AAAC","reason":"client namespace disconnect","level":"info","message":"Socket disconnected:"}

    [0m [90m 1214 |[39m       }
     [90m 1215 |[39m
    [31m[1m>[22m[39m[90m 1216 |[39m       logger[33m.[39minfo([32m'Socket disconnected:'[39m[33m,[39m {
     [90m      |[39m              [31m[1m^[22m[39m
     [90m 1217 |[39m         socketId[33m:[39m socket[33m.[39mid[33m,[39m
     [90m 1218 |[39m         reason[33m,[39m
     [90m 1219 |[39m         userId[33m:[39m socket[33m.[39mdata[33m?[39m[33m.[39muserInfo[33m?[39m[33m.[39mid [33m||[39m userId[33m,[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as info] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at Socket.<anonymous> (src/web-socket/index.ts:1216:14)
      at Socket.emitReserved (node_modules/socket.io/dist/typed-events.js:56:22)
      at Socket._onclose (node_modules/socket.io/dist/socket.js:554:14)
      at Socket.ondisconnect (node_modules/socket.io/dist/socket.js:513:14)
      at Socket._onpacket (node_modules/socket.io/dist/socket.js:442:22)
      at node_modules/socket.io/dist/client.js:214:24

  console.log
    [SOCKET] Socket disconnected: client namespace disconnect

      at Socket.<anonymous> (src/web-socket/index.ts:1221:15)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"socketId":"N2ONQLtEmYz_Rx7rAAAD","reason":"client namespace disconnect","level":"info","message":"Socket disconnected:"}

    [0m [90m 1214 |[39m       }
     [90m 1215 |[39m
    [31m[1m>[22m[39m[90m 1216 |[39m       logger[33m.[39minfo([32m'Socket disconnected:'[39m[33m,[39m {
     [90m      |[39m              [31m[1m^[22m[39m
     [90m 1217 |[39m         socketId[33m:[39m socket[33m.[39mid[33m,[39m
     [90m 1218 |[39m         reason[33m,[39m
     [90m 1219 |[39m         userId[33m:[39m socket[33m.[39mdata[33m?[39m[33m.[39muserInfo[33m?[39m[33m.[39mid [33m||[39m userId[33m,[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as info] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at Socket.<anonymous> (src/web-socket/index.ts:1216:14)
      at Socket.emitReserved (node_modules/socket.io/dist/typed-events.js:56:22)
      at Socket._onclose (node_modules/socket.io/dist/socket.js:554:14)
      at Socket.ondisconnect (node_modules/socket.io/dist/socket.js:513:14)
      at Socket._onpacket (node_modules/socket.io/dist/socket.js:442:22)
      at node_modules/socket.io/dist/client.js:214:24

  console.log
    [SOCKET] Socket disconnected: client namespace disconnect

      at Socket.<anonymous> (src/web-socket/index.ts:1221:15)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"socketId":"3W0c6tQyvi9TK21gAAAJ","reason":"client namespace disconnect","level":"info","message":"Socket disconnected:"}

    [0m [90m 1214 |[39m       }
     [90m 1215 |[39m
    [31m[1m>[22m[39m[90m 1216 |[39m       logger[33m.[39minfo([32m'Socket disconnected:'[39m[33m,[39m {
     [90m      |[39m              [31m[1m^[22m[39m
     [90m 1217 |[39m         socketId[33m:[39m socket[33m.[39mid[33m,[39m
     [90m 1218 |[39m         reason[33m,[39m
     [90m 1219 |[39m         userId[33m:[39m socket[33m.[39mdata[33m?[39m[33m.[39muserInfo[33m?[39m[33m.[39mid [33m||[39m userId[33m,[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as info] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at Socket.<anonymous> (src/web-socket/index.ts:1216:14)
      at Socket.emitReserved (node_modules/socket.io/dist/typed-events.js:56:22)
      at Socket._onclose (node_modules/socket.io/dist/socket.js:554:14)
      at Socket.ondisconnect (node_modules/socket.io/dist/socket.js:513:14)
      at Socket._onpacket (node_modules/socket.io/dist/socket.js:442:22)
      at node_modules/socket.io/dist/client.js:214:24

  console.log
    [SOCKET] Socket disconnected: client namespace disconnect

      at Socket.<anonymous> (src/web-socket/index.ts:1221:15)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"error":{"status":422,"additionalParameters":"Email not verified"},"stack":"Error: Email not verified\n    at login (K:\\0-CarWashProject\\api\\src\\controllers\\users\\login.controller.ts:132:13)\n    at Object.<anonymous> (K:\\0-CarWashProject\\api\\src\\controllers\\users\\login.controller.spec.ts:135:5)","context":"Login Controller","timestamp":"2025-08-24T14:03:17.391Z","email":"1","level":"error","message":"[Login Controller] Email not verified"}

    [0m [90m 228 |[39m     }
     [90m 229 |[39m
    [31m[1m>[22m[39m[90m 230 |[39m     enhancedLogger[33m.[39merror([32m`${context ? `[${context}] ` : ''}${error.message}`[39m[33m,[39m {
     [90m     |[39m                    [31m[1m^[22m[39m
     [90m 231 |[39m       error[33m:[39m {
     [90m 232 |[39m         name[33m:[39m error[33m.[39mname[33m,[39m
     [90m 233 |[39m         message[33m:[39m error[33m.[39mmessage[33m,[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as error] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at Object.logError (src/utils/logger.ts:230:20)
      at login (src/controllers/users/login.controller.ts:210:17)
      at Object.<anonymous> (src/controllers/users/login.controller.spec.ts:135:5)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"socketId":"4pb92JD03eliDmDCAAAM","level":"info","message":"Socket connected successfully"}

    [0m [90m 984 |[39m     [90m// inject user id coming from socket[39m
     [90m 985 |[39m     socket[33m.[39mdata[33m.[39muserInfo [33m=[39m socket[33m.[39mhandshake[33m.[39mauth[[32m'userInfo'[39m][33m;[39m
    [31m[1m>[22m[39m[90m 986 |[39m     logger[33m.[39minfo([32m'Socket connected successfully'[39m[33m,[39m {
     [90m     |[39m            [31m[1m^[22m[39m
     [90m 987 |[39m       socketId[33m:[39m socket[33m.[39mid[33m,[39m
     [90m 988 |[39m       userId[33m:[39m socket[33m.[39mdata[33m.[39muserInfo[33m?[39m[33m.[39mid[33m,[39m
     [90m 989 |[39m     })[33m;[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as info] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at Array.<anonymous> (src/web-socket/index.ts:986:12)
      at run (node_modules/socket.io/dist/namespace.js:130:19)
      at Namespace.run (node_modules/socket.io/dist/namespace.js:141:9)
      at Namespace._add (node_modules/socket.io/dist/namespace.js:218:14)

  console.log
    user undefined

      at Namespace.<anonymous> (src/web-socket/index.ts:1003:11)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"socketId":"KCA-qM_0HqSSlDy1AAAN","level":"info","message":"Socket connected successfully"}

    [0m [90m 984 |[39m     [90m// inject user id coming from socket[39m
     [90m 985 |[39m     socket[33m.[39mdata[33m.[39muserInfo [33m=[39m socket[33m.[39mhandshake[33m.[39mauth[[32m'userInfo'[39m][33m;[39m
    [31m[1m>[22m[39m[90m 986 |[39m     logger[33m.[39minfo([32m'Socket connected successfully'[39m[33m,[39m {
     [90m     |[39m            [31m[1m^[22m[39m
     [90m 987 |[39m       socketId[33m:[39m socket[33m.[39mid[33m,[39m
     [90m 988 |[39m       userId[33m:[39m socket[33m.[39mdata[33m.[39muserInfo[33m?[39m[33m.[39mid[33m,[39m
     [90m 989 |[39m     })[33m;[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as info] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at Array.<anonymous> (src/web-socket/index.ts:986:12)
      at run (node_modules/socket.io/dist/namespace.js:130:19)
      at Namespace.run (node_modules/socket.io/dist/namespace.js:141:9)
      at Namespace._add (node_modules/socket.io/dist/namespace.js:218:14)

  console.log
    user undefined

      at Namespace.<anonymous> (src/web-socket/index.ts:1003:11)

  console.log
    Start 3

      at Object.<anonymous> (src/web-socket/index.spec.ts:229:13)

  console.log
    No enough args  {
      args: {
        latitude: 10,
        longitude: 10,
        notifcationToken: '',
        providerId: 0,
        status: 'Online',
        userId: 1,
        uuid: 'KCA-qM_0HqSSlDy1AAAN',
        moduleId: 1
      }
    }

      at Socket.<anonymous> (src/web-socket/index.ts:1245:19)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"socketId":"4pb92JD03eliDmDCAAAM","reason":"client namespace disconnect","level":"info","message":"Socket disconnected:"}

    [0m [90m 1214 |[39m       }
     [90m 1215 |[39m
    [31m[1m>[22m[39m[90m 1216 |[39m       logger[33m.[39minfo([32m'Socket disconnected:'[39m[33m,[39m {
     [90m      |[39m              [31m[1m^[22m[39m
     [90m 1217 |[39m         socketId[33m:[39m socket[33m.[39mid[33m,[39m
     [90m 1218 |[39m         reason[33m,[39m
     [90m 1219 |[39m         userId[33m:[39m socket[33m.[39mdata[33m?[39m[33m.[39muserInfo[33m?[39m[33m.[39mid [33m||[39m userId[33m,[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as info] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at Socket.<anonymous> (src/web-socket/index.ts:1216:14)
      at Socket.emitReserved (node_modules/socket.io/dist/typed-events.js:56:22)
      at Socket._onclose (node_modules/socket.io/dist/socket.js:554:14)
      at Socket.ondisconnect (node_modules/socket.io/dist/socket.js:513:14)
      at Socket._onpacket (node_modules/socket.io/dist/socket.js:442:22)
      at node_modules/socket.io/dist/client.js:214:24

  console.log
    [SOCKET] Socket disconnected: client namespace disconnect

      at Socket.<anonymous> (src/web-socket/index.ts:1221:15)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"socketId":"KCA-qM_0HqSSlDy1AAAN","reason":"client namespace disconnect","level":"info","message":"Socket disconnected:"}

    [0m [90m 1214 |[39m       }
     [90m 1215 |[39m
    [31m[1m>[22m[39m[90m 1216 |[39m       logger[33m.[39minfo([32m'Socket disconnected:'[39m[33m,[39m {
     [90m      |[39m              [31m[1m^[22m[39m
     [90m 1217 |[39m         socketId[33m:[39m socket[33m.[39mid[33m,[39m
     [90m 1218 |[39m         reason[33m,[39m
     [90m 1219 |[39m         userId[33m:[39m socket[33m.[39mdata[33m?[39m[33m.[39muserInfo[33m?[39m[33m.[39mid [33m||[39m userId[33m,[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as info] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at Socket.<anonymous> (src/web-socket/index.ts:1216:14)
      at Socket.emitReserved (node_modules/socket.io/dist/typed-events.js:56:22)
      at Socket._onclose (node_modules/socket.io/dist/socket.js:554:14)
      at Socket.ondisconnect (node_modules/socket.io/dist/socket.js:513:14)
      at Socket._onpacket (node_modules/socket.io/dist/socket.js:442:22)
      at node_modules/socket.io/dist/client.js:214:24

  console.log
    [SOCKET] Socket disconnected: client namespace disconnect

      at Socket.<anonymous> (src/web-socket/index.ts:1221:15)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"socketId":"JAt-7x7n4maawBbLAAAQ","level":"info","message":"Socket connected successfully"}

    [0m [90m 984 |[39m     [90m// inject user id coming from socket[39m
     [90m 985 |[39m     socket[33m.[39mdata[33m.[39muserInfo [33m=[39m socket[33m.[39mhandshake[33m.[39mauth[[32m'userInfo'[39m][33m;[39m
    [31m[1m>[22m[39m[90m 986 |[39m     logger[33m.[39minfo([32m'Socket connected successfully'[39m[33m,[39m {
     [90m     |[39m            [31m[1m^[22m[39m
     [90m 987 |[39m       socketId[33m:[39m socket[33m.[39mid[33m,[39m
     [90m 988 |[39m       userId[33m:[39m socket[33m.[39mdata[33m.[39muserInfo[33m?[39m[33m.[39mid[33m,[39m
     [90m 989 |[39m     })[33m;[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as info] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at Array.<anonymous> (src/web-socket/index.ts:986:12)
      at run (node_modules/socket.io/dist/namespace.js:130:19)
      at Namespace.run (node_modules/socket.io/dist/namespace.js:141:9)
      at Namespace._add (node_modules/socket.io/dist/namespace.js:218:14)

  console.log
    user undefined

      at Namespace.<anonymous> (src/web-socket/index.ts:1003:11)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"socketId":"YiPYKoy8AyAT-I0dAAAR","level":"info","message":"Socket connected successfully"}

    [0m [90m 984 |[39m     [90m// inject user id coming from socket[39m
     [90m 985 |[39m     socket[33m.[39mdata[33m.[39muserInfo [33m=[39m socket[33m.[39mhandshake[33m.[39mauth[[32m'userInfo'[39m][33m;[39m
    [31m[1m>[22m[39m[90m 986 |[39m     logger[33m.[39minfo([32m'Socket connected successfully'[39m[33m,[39m {
     [90m     |[39m            [31m[1m^[22m[39m
     [90m 987 |[39m       socketId[33m:[39m socket[33m.[39mid[33m,[39m
     [90m 988 |[39m       userId[33m:[39m socket[33m.[39mdata[33m.[39muserInfo[33m?[39m[33m.[39mid[33m,[39m
     [90m 989 |[39m     })[33m;[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as info] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at Array.<anonymous> (src/web-socket/index.ts:986:12)
      at run (node_modules/socket.io/dist/namespace.js:130:19)
      at Namespace.run (node_modules/socket.io/dist/namespace.js:141:9)
      at Namespace._add (node_modules/socket.io/dist/namespace.js:218:14)

  console.log
    user undefined

      at Namespace.<anonymous> (src/web-socket/index.ts:1003:11)

  console.log
    Start 4

      at Object.<anonymous> (src/web-socket/index.spec.ts:246:13)

  console.log
    [SOCKET - Broadcast online providers] Broadcasting online providers, Total Online Providers : 1

      at broadcastOnlineProvider (src/web-socket/index.ts:502:11)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"error":{"status":422,"additionalParameters":"Email not verified"},"stack":"Error: Email not verified\n    at login (K:\\0-CarWashProject\\api\\src\\controllers\\users\\login.controller.ts:132:13)\n    at Object.<anonymous> (K:\\0-CarWashProject\\api\\src\\controllers\\users\\login.controller.spec.ts:169:5)","context":"Login Controller","timestamp":"2025-08-24T14:03:17.707Z","email":"1","level":"error","message":"[Login Controller] Email not verified"}

    [0m [90m 228 |[39m     }
     [90m 229 |[39m
    [31m[1m>[22m[39m[90m 230 |[39m     enhancedLogger[33m.[39merror([32m`${context ? `[${context}] ` : ''}${error.message}`[39m[33m,[39m {
     [90m     |[39m                    [31m[1m^[22m[39m
     [90m 231 |[39m       error[33m:[39m {
     [90m 232 |[39m         name[33m:[39m error[33m.[39mname[33m,[39m
     [90m 233 |[39m         message[33m:[39m error[33m.[39mmessage[33m,[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as error] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at Object.logError (src/utils/logger.ts:230:20)
      at login (src/controllers/users/login.controller.ts:210:17)
      at Object.<anonymous> (src/controllers/users/login.controller.spec.ts:169:5)

FAIL src/controllers/users/login.controller.spec.ts (11.222 s)
  users/login
    ‚àö Should return fail because password is incorrect (422 ms)
    ‚àö Should return fail because no user found (11 ms)
    √ó Should return fail because allowed clients is not right (332 ms)
    √ó Should succeed (320 ms)
    √ó Should succeed and return isUserActive as atrue (316 ms)
    √ó Should succeed and return isUserActive as true and document fullfilled true (316 ms)

  ‚óè users/login ‚Ä∫ Should return fail because allowed clients is not right

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

      {"_addBody": [Function _addBody], "_events": {}, "_eventsCount": 0, "_maxListeners": undefined, "_setBaseUrl": [Function _setBaseUrl], "_setBody": [Function _setBody], "_setCookiesVariable": [Function _setCookiesVariable], "_setFilesVariable": [Function _setFilesVariable], "_setHeadersVariable": [Function _setHeadersVariable], "_setMethod": [Function _setMethod], "_setOriginalUrl": [Function _setOriginalUrl], "_setParameter": [Function _setParameter], "_setSessionVariable": [Function _setSessionVariable], "_setSignedCookiesVariable": [Function _setSignedCookiesVariable], "_setURL": [Function _setURL], "accepts": [Function acceptsTypes], "acceptsCharsets": [Function acceptsCharsets], "acceptsEncodings": [Function acceptsEncodings], "acceptsLanguages": [Function acceptsLanguages], "baseUrl": "", "body": {"email": "1", "password": "1"}, "cookies": {}, "destroy": [Function anonymous], "files": {}, "get": [Function getHeader], "getHeader": [Function getHeader], "header": [Function getHeader], "headers": {"allowed-client": "U2FsdGVkX19IZh4q3/l4XjfAcws56BixpCn9h9ri66U="}, "hostname": "", "ip": "127.0.0.1", "ips": ["127.0.0.1"], "is": [Function isContentType], "logger": {"error": [Function mockConstructor], "info": [Function mockConstructor], "warn": [Function mockConstructor]}, "method": "GET", "originalUrl": "", "param": [Function param], "params": {}, "path": "", "prisma": undefined, "query": {}, "range": [Function isRange], "send": [Function send], "socket": {}, "subdomains": [], "url": "", "user": {}, Symbol(shapeMode): false, Symbol(kCapture): false, Symbol(Symbol.asyncIterator): [Function asyncIterator]},
      {"_getBuffer": [Function _getBuffer], "_getChunks": [Function _getChunks], "_getData": [Function _getData], "_getHeaders": [Function _getHeaders], "_getJSONData": [Function _getJSONData], "_getLocals": [Function _getLocals], "_getRedirectUrl": [Function _getRedirectUrl], "_getRenderData": [Function _getRenderData], "_getRenderView": [Function _getRenderView], "_getStatusCode": [Function _getStatusCode], "_getStatusMessage": [Function _getStatusMessage], "_headers": {}, "_isDataLengthValid": [Function _isDataLengthValid], "_isEndCalled": [Function _isEndCalled], "_isJSON": [Function _isJSON], "_isUTF8": [Function _isUTF8], "append": [Function append], "appendHeader": [Function appendHeader], "attachment": [Function attachment], "clearCookie": [Function clearCookie], "contentType": [Function contentType], "cookie": [Function cookie], "cookies": {}, "destroy": [Function destroy], "destroySoon": [Function destroySoon], "end": [Function end], "finished": false, "format": [Function format], "get": [Function getHeader], "getEncoding": [Function getEncoding], "getHeader": [Function getHeader], "getHeaderNames": [Function getHeaderNames], "getHeaders": [Function getHeaders], "hasHeader": [Function hasHeader], "header": [Function header], "headersSent": false, "json": [Function json], "jsonp": [Function jsonp], "locals": {}, "location": [Function setLocation], "redirect": [Function redirect], "removeHeader": [Function removeHeader], "render": [Function render], "send": [Function send], "sendStatus": [Function sendStatus], "set": [Function header], "setEncoding": [Function setEncoding], "setHeader": [Function setHeader], "status": [Function status], "statusCode": 200, "statusMessage": "OK", "type": [Function contentType], "vary": [Function vary], "writableEnded": false, "writableFinished": false, "write": [Function write], "writeHead": [Function writeHead]},
    - [Error: No sufficient permission],
    + [Error: Email not verified],
      [Function mockConstructor],

    Number of calls: 1

    [0m [90m 75 |[39m
     [90m 76 |[39m     expect(createFailResponse)[33m.[39mtoHaveBeenCalledTimes([35m1[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 77 |[39m     expect(createFailResponse)[33m.[39mtoHaveBeenCalledWith(
     [90m    |[39m                                [31m[1m^[22m[39m
     [90m 78 |[39m       global[33m.[39mmockReq[33m,[39m
     [90m 79 |[39m       global[33m.[39mmockRes[33m,[39m
     [90m 80 |[39m[0m

      at Object.<anonymous> (src/controllers/users/login.controller.spec.ts:77:32)

  ‚óè users/login ‚Ä∫ Should succeed

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

    [0m [90m 105 |[39m     [36mawait[39m login(global[33m.[39mmockReq[33m,[39m global[33m.[39mmockRes[33m,[39m global[33m.[39mmockNext)[33m;[39m
     [90m 106 |[39m
    [31m[1m>[22m[39m[90m 107 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledTimes([35m1[39m)[33m;[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 108 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledWith(
     [90m 109 |[39m       global[33m.[39mmockReq[33m,[39m
     [90m 110 |[39m       global[33m.[39mmockRes[33m,[39m[0m

      at Object.<anonymous> (src/controllers/users/login.controller.spec.ts:107:35)

  ‚óè users/login ‚Ä∫ Should succeed and return isUserActive as atrue

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

    [0m [90m 135 |[39m     [36mawait[39m login(global[33m.[39mmockReq[33m,[39m global[33m.[39mmockRes[33m,[39m global[33m.[39mmockNext)[33m;[39m
     [90m 136 |[39m
    [31m[1m>[22m[39m[90m 137 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledTimes([35m1[39m)[33m;[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 138 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledWith(
     [90m 139 |[39m       global[33m.[39mmockReq[33m,[39m
     [90m 140 |[39m       global[33m.[39mmockRes[33m,[39m[0m

      at Object.<anonymous> (src/controllers/users/login.controller.spec.ts:137:35)

  ‚óè users/login ‚Ä∫ Should succeed and return isUserActive as true and document fullfilled true

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

    [0m [90m 169 |[39m     [36mawait[39m login(global[33m.[39mmockReq[33m,[39m global[33m.[39mmockRes[33m,[39m global[33m.[39mmockNext)[33m;[39m
     [90m 170 |[39m     [32m``[39m[33m;[39m
    [31m[1m>[22m[39m[90m 171 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledTimes([35m1[39m)[33m;[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 172 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledWith(
     [90m 173 |[39m       global[33m.[39mmockReq[33m,[39m
     [90m 174 |[39m       global[33m.[39mmockRes[33m,[39m[0m

      at Object.<anonymous> (src/controllers/users/login.controller.spec.ts:171:35)

  console.error
    Send message error: Error: Order not found
        at Proxy.<anonymous> (K:\0-CarWashProject\api\src\web-socket\orderChat.spec.ts:377:31)
        at K:\0-CarWashProject\api\node_modules\jest-mock\build\index.js:397:39
        at Proxy.<anonymous> (K:\0-CarWashProject\api\node_modules\jest-mock\build\index.js:404:13)
        at Proxy.mockConstructor (K:\0-CarWashProject\api\node_modules\jest-mock\build\index.js:148:19)
        at sendMessage (K:\0-CarWashProject\api\src\web-socket\chatSocket.ts:141:48)
        at Socket.<anonymous> (K:\0-CarWashProject\api\src\web-socket\orderChat.spec.ts:183:43)
        at Socket.emit (node:events:518:28)
        at Socket.emitUntyped (K:\0-CarWashProject\api\node_modules\socket.io\dist\typed-events.js:69:22)
        at K:\0-CarWashProject\api\node_modules\socket.io\dist\socket.js:697:39
        at processTicksAndRejections (node:internal/process/task_queues:85:11)

    [0m [90m 193 |[39m     }[33m;[39m
     [90m 194 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 195 |[39m     console[33m.[39merror([32m'Send message error:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 196 |[39m     [36mreturn[39m [36mnull[39m[33m;[39m
     [90m 197 |[39m   }
     [90m 198 |[39m }[0m

      at sendMessage (src/web-socket/chatSocket.ts:195:13)
      at Socket.<anonymous> (src/web-socket/orderChat.spec.ts:183:26)

  console.log
    Chat: User 1 disconnected

      at handleUserDisconnect (src/web-socket/chatSocket.ts:282:11)
          at Map.forEach (<anonymous>)
          at Array.map (<anonymous>)

  console.log
    Chat: User 2 disconnected

      at handleUserDisconnect (src/web-socket/chatSocket.ts:282:11)
          at Map.forEach (<anonymous>)
          at Array.map (<anonymous>)

PASS src/web-socket/orderChat.spec.ts (13.147 s)
  OrderChatHandler
    Authentication
      ‚àö should authenticate customer successfully (61 ms)
      ‚àö should authenticate provider successfully (3 ms)
      ‚àö should fail authentication for invalid user (1 ms)
    Order Chat
      ‚àö should allow customer to join order chat (3 ms)
      ‚àö should allow provider to join order chat (5 ms)
      ‚àö should notify when user joins order chat (3 ms)
      ‚àö should send and receive messages in order chat (115 ms)
      ‚àö should handle typing indicators (111 ms)
      ‚àö should auto-stop typing after timeout (3114 ms)
      ‚àö should retrieve chat history (2 ms)
      ‚àö should prevent unauthorized users from joining order chat (29 ms)
    Online Status
      ‚àö should broadcast online status when user authenticates (2 ms)
      ‚àö should track online users correctly
    System Messages
      ‚àö should send system messages to order chat (1 ms)
    Error Handling
      ‚àö should handle database errors gracefully (40 ms)
      ‚àö should handle invalid order IDs (1 ms)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"socketId":"JAt-7x7n4maawBbLAAAQ","reason":"client namespace disconnect","level":"info","message":"Socket disconnected:"}

    [0m [90m 1214 |[39m       }
     [90m 1215 |[39m
    [31m[1m>[22m[39m[90m 1216 |[39m       logger[33m.[39minfo([32m'Socket disconnected:'[39m[33m,[39m {
     [90m      |[39m              [31m[1m^[22m[39m
     [90m 1217 |[39m         socketId[33m:[39m socket[33m.[39mid[33m,[39m
     [90m 1218 |[39m         reason[33m,[39m
     [90m 1219 |[39m         userId[33m:[39m socket[33m.[39mdata[33m?[39m[33m.[39muserInfo[33m?[39m[33m.[39mid [33m||[39m userId[33m,[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as info] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at Socket.<anonymous> (src/web-socket/index.ts:1216:14)
      at Socket.emitReserved (node_modules/socket.io/dist/typed-events.js:56:22)
      at Socket._onclose (node_modules/socket.io/dist/socket.js:554:14)
      at Socket.ondisconnect (node_modules/socket.io/dist/socket.js:513:14)
      at Socket._onpacket (node_modules/socket.io/dist/socket.js:442:22)
      at node_modules/socket.io/dist/client.js:214:24

  console.log
    [SOCKET] Socket disconnected: client namespace disconnect

      at Socket.<anonymous> (src/web-socket/index.ts:1221:15)

  console.error
    [winston] Attempt to write logs with no transports, which can increase memory usage: {"socketId":"YiPYKoy8AyAT-I0dAAAR","reason":"client namespace disconnect","level":"info","message":"Socket disconnected:"}

    [0m [90m 1214 |[39m       }
     [90m 1215 |[39m
    [31m[1m>[22m[39m[90m 1216 |[39m       logger[33m.[39minfo([32m'Socket disconnected:'[39m[33m,[39m {
     [90m      |[39m              [31m[1m^[22m[39m
     [90m 1217 |[39m         socketId[33m:[39m socket[33m.[39mid[33m,[39m
     [90m 1218 |[39m         reason[33m,[39m
     [90m 1219 |[39m         userId[33m:[39m socket[33m.[39mdata[33m?[39m[33m.[39muserInfo[33m?[39m[33m.[39mid [33m||[39m userId[33m,[39m[0m

      at DerivedLogger._transform (node_modules/winston/lib/winston/logger.js:303:15)
      at DerivedLogger.Object.<anonymous>.Transform._read (node_modules/readable-stream/lib/_stream_transform.js:166:10)
      at DerivedLogger.Object.<anonymous>.Transform._write (node_modules/readable-stream/lib/_stream_transform.js:155:83)
      at doWrite (node_modules/readable-stream/lib/_stream_writable.js:390:139)
      at writeOrBuffer (node_modules/readable-stream/lib/_stream_writable.js:381:5)
      at DerivedLogger.Object.<anonymous>.Writable.write (node_modules/readable-stream/lib/_stream_writable.js:302:11)
      at DerivedLogger.log (node_modules/winston/lib/winston/logger.js:253:14)
      at DerivedLogger.<computed> [as info] (node_modules/winston/lib/winston/create-logger.js:95:19)
      at Socket.<anonymous> (src/web-socket/index.ts:1216:14)
      at Socket.emitReserved (node_modules/socket.io/dist/typed-events.js:56:22)
      at Socket._onclose (node_modules/socket.io/dist/socket.js:554:14)
      at Socket.ondisconnect (node_modules/socket.io/dist/socket.js:513:14)
      at Socket._onpacket (node_modules/socket.io/dist/socket.js:442:22)
      at node_modules/socket.io/dist/client.js:214:24

  console.log
    [SOCKET] Socket disconnected: client namespace disconnect

      at Socket.<anonymous> (src/web-socket/index.ts:1221:15)

  console.log
    user undefined

      at Namespace.<anonymous> (src/web-socket/index.ts:1003:11)

  console.log
    user undefined

      at Namespace.<anonymous> (src/web-socket/index.ts:1003:11)

  console.log
    Start 5

      at Object.<anonymous> (src/web-socket/index.spec.ts:256:13)

  console.log
    [SOCKET] [Provider] [Update] => Update provider {"newValues":{"uuid":"68D3lLBvDyESUBqKAAAV","notifcationToken":"","status":"Online"},"searchKey":"userId","searchValue":1}

      at updateProvider (src/web-socket/index.ts:663:11)

  console.log
    [SOCKET - Broadcast online providers] Broadcasting online providers, Total Online Providers : 1

      at broadcastOnlineProvider (src/web-socket/index.ts:502:11)

  console.log
    [SOCKET] [Provider] [Remove] => Remove provider {"searchKey":"uuid","searchValue":"68D3lLBvDyESUBqKAAAV"}

      at removeProvider (src/web-socket/index.ts:682:11)

  console.log
    [SOCKET - Broadcast online providers] Broadcasting online providers, Total Online Providers : 0

      at broadcastOnlineProvider (src/web-socket/index.ts:502:11)

  console.log
    [SOCKET] Socket disconnected: client namespace disconnect

      at Socket.<anonymous> (src/web-socket/index.ts:1221:15)

  console.log
    [SOCKET] Socket disconnected: client namespace disconnect

      at Socket.<anonymous> (src/web-socket/index.ts:1221:15)

  console.log
    user undefined

      at Namespace.<anonymous> (src/web-socket/index.ts:1003:11)

  console.log
    user undefined

      at Namespace.<anonymous> (src/web-socket/index.ts:1003:11)

  console.log
    Start 6

      at Object.<anonymous> (src/web-socket/index.spec.ts:270:13)

  console.log
    [SOCKET] [Provider] [Add] => Adding new provdider {"newArgs":{"latitude":10,"longitude":10,"notifcationToken":"","providerId":1,"status":"Online","userId":1,"uuid":"ZgdWIxOq44-BTTkUAAAZ","moduleId":1}}

      at addProvider (src/web-socket/index.ts:642:11)

  console.log
    [SOCKET - Broadcast online providers] Broadcasting online providers, Total Online Providers : 1

      at broadcastOnlineProvider (src/web-socket/index.ts:502:11)

  console.log
    [SOCKET] [Order] [Add] => Adding new Order {"newArgs":{"arrivalThreshold":2,"orderPaymentMethod":"Cash","orderSubmissionType":"provider-select","orderTimeoutSeconds":{"seconds":2,"dateAfterAddingSeconds":1756044220568},"customerUuid":"tiphPJbFJaUjVl1CAAAY","orderId":123,"customerUserId":1,"customerNotificationToken":"123","providerUserId":1,"providerUuid":"ZgdWIxOq44-BTTkUAAAZ","orderStep":0}}

      at addOrder (src/web-socket/index.ts:712:11)

  console.log
    [SOCKET] [NEW-ORDER] Scheduling timeout job {
      orderId: 123,
      providerId: 1,
      timeoutSeconds: 2,
      timeoutDate: 2025-08-24T14:03:40.569Z,
      jobId: 'order-timeout-123'
    }

      at Socket.<anonymous> (src/web-socket/index.ts:1404:17)

  console.log
    [SOCKET] Socket disconnected: client namespace disconnect

      at Socket.<anonymous> (src/web-socket/index.ts:1221:15)

  console.log
    [SOCKET] Socket disconnected: client namespace disconnect

      at Socket.<anonymous> (src/web-socket/index.ts:1221:15)

  console.log
    user undefined

      at Namespace.<anonymous> (src/web-socket/index.ts:1003:11)

  console.log
    user undefined

      at Namespace.<anonymous> (src/web-socket/index.ts:1003:11)

  console.log
    [SOCKET] [Provider] [Add] => Adding new provdider {"newArgs":{"latitude":10,"longitude":10,"notifcationToken":"","providerId":24234222,"status":"Online","userId":1,"uuid":"OSZcxdAMe9ml9GqRAAAd","moduleId":1}}

      at addProvider (src/web-socket/index.ts:642:11)

  console.log
    [SOCKET - Broadcast online providers] Broadcasting online providers, Total Online Providers : 1

      at broadcastOnlineProvider (src/web-socket/index.ts:502:11)

  console.log
    [SOCKET] Socket disconnected: client namespace disconnect

      at Socket.<anonymous> (src/web-socket/index.ts:1221:15)

  console.log
    [SOCKET] Socket disconnected: client namespace disconnect

      at Socket.<anonymous> (src/web-socket/index.ts:1221:15)

  console.log
    user undefined

      at Namespace.<anonymous> (src/web-socket/index.ts:1003:11)

  console.log
    user undefined

      at Namespace.<anonymous> (src/web-socket/index.ts:1003:11)

  console.log
    [SOCKET] [Provider] [Add] => Adding new provdider {"newArgs":{"latitude":10,"longitude":10,"notifcationToken":"","providerId":1,"status":"Online","userId":1,"uuid":"Tl8uVhjAN8qQ82ycAAAh","moduleId":1}}

      at addProvider (src/web-socket/index.ts:642:11)

  console.log
    [SOCKET - Broadcast online providers] Broadcasting online providers, Total Online Providers : 1

      at broadcastOnlineProvider (src/web-socket/index.ts:502:11)

  console.log
    [SOCKET] Customer already has an order that is not accepted by provider

      at Socket.<anonymous> (src/web-socket/index.ts:1350:21)

  console.log
    [SOCKET] [Order] [Remove] => Remove Order {"searchKey":"orderId","searchValue":123}

      at removeOrder (src/web-socket/index.ts:747:11)

  console.log
    [SOCKET] [Order] [Add] => Adding new Order {"newArgs":{"arrivalThreshold":2,"orderPaymentMethod":"Cash","orderSubmissionType":"provider-select","orderTimeoutSeconds":{"seconds":2,"dateAfterAddingSeconds":1756044221668},"customerUuid":"47MUSZso-9LF3Vh0AAAg","orderId":123,"customerUserId":1,"customerNotificationToken":"123","providerUserId":1,"providerUuid":"Tl8uVhjAN8qQ82ycAAAh","orderStep":0}}

      at addOrder (src/web-socket/index.ts:712:11)

  console.log
    [SOCKET] [NEW-ORDER] Scheduling timeout job {
      orderId: 123,
      providerId: 1,
      timeoutSeconds: 2,
      timeoutDate: 2025-08-24T14:03:41.668Z,
      jobId: 'order-timeout-123'
    }

      at Socket.<anonymous> (src/web-socket/index.ts:1404:17)

  console.log
    [SOCKET] [ORDER-ACCEPT] Order found , OrderID : 123

      at Socket.<anonymous> (src/web-socket/index.ts:1635:17)

  console.log
    [SOCKET] [ORDER-ACCEPT] Cancelled regular timeout job { orderId: 123, regularTimeoutJobId: 'order-timeout-123' }

      at Socket.<anonymous> (src/web-socket/index.ts:1643:19)

  console.log
    [SOCKET] [Provider] [Update] => Update provider {"newValues":{"status":"Have order"},"searchKey":"uuid","searchValue":"Tl8uVhjAN8qQ82ycAAAh"}

      at updateProvider (src/web-socket/index.ts:663:11)

  console.log
    [SOCKET - Broadcast online providers] Broadcasting online providers, Total Online Providers : 0

      at broadcastOnlineProvider (src/web-socket/index.ts:502:11)

  console.log
    [SOCKET] [Order] [Update] => Update Order {"newValues":{"orderStep":1},"searchKey":"orderId","searchValue":123}

      at updateOrder (src/web-socket/index.ts:729:11)

  console.log
    [SOCKET] [ORDER-ACCEPT] Provider updated {
      provider: {
        latitude: 10,
        longitude: 10,
        notifcationToken: '',
        providerId: 1,
        status: 'Have order',
        userId: 1,
        uuid: 'Tl8uVhjAN8qQ82ycAAAh',
        moduleId: 1
      },
      updatedOrder: {
        arrivalThreshold: 2,
        orderPaymentMethod: 'Cash',
        orderSubmissionType: 'provider-select',
        orderTimeoutSeconds: { seconds: 2, dateAfterAddingSeconds: 1756044221668 },
        customerUuid: '47MUSZso-9LF3Vh0AAAg',
        orderId: 123,
        customerUserId: 1,
        customerNotificationToken: '123',
        providerUserId: 1,
        providerUuid: 'Tl8uVhjAN8qQ82ycAAAh',
        orderStep: 1
      }
    }

      at Socket.<anonymous> (src/web-socket/index.ts:1708:17)

  console.log
    [SOCKET] [ORDER-ACCEPT] Notifying customer about order acceptance { orderId: 123, providerId: 1, userId: 1, orderStep: 1 }

      at Socket.<anonymous> (src/web-socket/index.ts:1711:19)

  console.error
    System user not found. Please run database seeding.

    [0m [90m 402 |[39m
     [90m 403 |[39m     [36mif[39m ([33m![39msystemUser) {
    [31m[1m>[22m[39m[90m 404 |[39m       console[33m.[39merror([32m'System user not found. Please run database seeding.'[39m)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 405 |[39m
     [90m 406 |[39m       [90m// During tests, fall back to a synthetic system user to avoid failing the test suite[39m
     [90m 407 |[39m       [36mif[39m (process[33m.[39menv[33m.[39m[33mNODE_ENV[39m [33m===[39m [32m'test'[39m [33m||[39m process[33m.[39menv[33m.[39m[33mCI[39m [33m===[39m [32m'true'[39m) {[0m

      at sendSystemMessage (src/web-socket/chatSocket.ts:404:15)

  console.warn
    [TEST] Using fallback system user for sendSystemMessage

    [0m [90m 407 |[39m       [36mif[39m (process[33m.[39menv[33m.[39m[33mNODE_ENV[39m [33m===[39m [32m'test'[39m [33m||[39m process[33m.[39menv[33m.[39m[33mCI[39m [33m===[39m [32m'true'[39m) {
     [90m 408 |[39m         [36mconst[39m fallbackSystemUser[33m:[39m any [33m=[39m { id[33m:[39m [35m999999[39m[33m,[39m [33mFirstName[39m[33m:[39m [32m'System'[39m[33m,[39m [33mLastName[39m[33m:[39m [32m'Bot'[39m }[33m;[39m
    [31m[1m>[22m[39m[90m 409 |[39m         console[33m.[39mwarn([32m'[TEST] Using fallback system user for sendSystemMessage'[39m)[33m;[39m
     [90m     |[39m                 [31m[1m^[22m[39m
     [90m 410 |[39m         systemUser [33m=[39m fallbackSystemUser[33m;[39m
     [90m 411 |[39m       } [36melse[39m {
     [90m 412 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m([32m'System user not found'[39m)[33m;[39m[0m

      at sendSystemMessage (src/web-socket/chatSocket.ts:409:17)

  console.log
    [SOCKET] [NEW-ORDER] Timeout job executing { orderId: 123, providerId: 1, jobId: 'order-timeout-123' }

      at Job.job (src/web-socket/index.ts:1413:19)

  console.log
    [SOCKET] [NEW-ORDER] Timeout job - checking order state {
      orderId: 123,
      orderExists: true,
      orderStep: 1,
      providerExists: true,
      providerId: 1
    }

      at Job.job (src/web-socket/index.ts:1422:19)

  console.log
    [SOCKET] [NEW-ORDER] Timeout job cancelled - order was accepted or removed { orderId: 123, orderExists: true, orderStep: 1, providerId: 1 }

      at Job.job (src/web-socket/index.ts:1452:21)

  console.log
    [SOCKET] Socket disconnected: client namespace disconnect

      at Socket.<anonymous> (src/web-socket/index.ts:1221:15)

  console.log
    [SOCKET] Socket disconnected: client namespace disconnect

      at Socket.<anonymous> (src/web-socket/index.ts:1221:15)

  console.log
    user undefined

      at Namespace.<anonymous> (src/web-socket/index.ts:1003:11)

  console.log
    user undefined

      at Namespace.<anonymous> (src/web-socket/index.ts:1003:11)

  console.log
    [SOCKET] [PROVIDER-ONLINE-START] Checking active session {
      online: {
        latitude: 10,
        longitude: 10,
        notifcationToken: '',
        providerId: 1,
        status: 'Have order',
        userId: 1,
        uuid: 'Tl8uVhjAN8qQ82ycAAAh',
        moduleId: 1
      }
    }

      at Socket.<anonymous> (src/web-socket/index.ts:1258:21)

  console.log
    [SOCKET] Restoring active session [ORDER FOUND] {
      order: {
        arrivalThreshold: 2,
        orderPaymentMethod: 'Cash',
        orderSubmissionType: 'provider-select',
        orderTimeoutSeconds: { seconds: 2, dateAfterAddingSeconds: 1756044221668 },
        customerUuid: '47MUSZso-9LF3Vh0AAAg',
        orderId: 123,
        customerUserId: 1,
        customerNotificationToken: '123',
        providerUserId: 1,
        providerUuid: 'Tl8uVhjAN8qQ82ycAAAh',
        orderStep: 1
      },
      user: { id: 1, UserTypeName: 'Provider' },
      provider: {
        latitude: 10,
        longitude: 10,
        notifcationToken: '',
        providerId: 1,
        status: 'Have order',
        userId: 1,
        uuid: 'Tl8uVhjAN8qQ82ycAAAh',
        moduleId: 1
      }
    }

      at checkActiveSession (src/web-socket/index.ts:550:13)

  console.log
    [SOCKET] [ACTIVE-SESSION] Provider Tl8uVhjAN8qQ82ycAAAh is going offline. Since they are differnet

      at checkActiveSession (src/web-socket/index.ts:554:17)

  console.log
    [SOCKET] Restoring active session [UPDATE PROVIDER] {
      order: {
        arrivalThreshold: 2,
        orderPaymentMethod: 'Cash',
        orderSubmissionType: 'provider-select',
        orderTimeoutSeconds: { seconds: 2, dateAfterAddingSeconds: 1756044221668 },
        customerUuid: '47MUSZso-9LF3Vh0AAAg',
        orderId: 123,
        customerUserId: 1,
        customerNotificationToken: '123',
        providerUserId: 1,
        providerUuid: 'Tl8uVhjAN8qQ82ycAAAh',
        orderStep: 1
      },
      user: { id: 1, UserTypeName: 'Provider' },
      provider: {
        latitude: 10,
        longitude: 10,
        notifcationToken: '',
        providerId: 1,
        status: 'Have order',
        userId: 1,
        uuid: 'Tl8uVhjAN8qQ82ycAAAh',
        moduleId: 1
      }
    }

      at checkActiveSession (src/web-socket/index.ts:559:15)

  console.log
    [SOCKET] [Provider] [Update] => Update provider {"newValues":{"latitude":10,"longitude":10,"notifcationToken":"","providerId":1,"status":"Have order","userId":1,"uuid":"m6N9BXRyaVJ_k-7JAAAl","moduleId":1},"searchKey":"userId","searchValue":1}

      at updateProvider (src/web-socket/index.ts:663:11)

  console.log
    [SOCKET - Broadcast online providers] Broadcasting online providers, Total Online Providers : 0

      at broadcastOnlineProvider (src/web-socket/index.ts:502:11)

  console.log
    [SOCKET] [Order] [Update] => Update Order {"newValues":{"providerUuid":"m6N9BXRyaVJ_k-7JAAAl"},"searchKey":"orderId","searchValue":123}

      at updateOrder (src/web-socket/index.ts:729:11)

  console.log
    [SOCKET] [Order] [Remove] => Remove Order {"searchKey":"orderId","searchValue":123}

      at removeOrder (src/web-socket/index.ts:747:11)

  console.log
    [SOCKET] Socket disconnected: client namespace disconnect

      at Socket.<anonymous> (src/web-socket/index.ts:1221:15)

  console.log
    [SOCKET] Socket disconnected: client namespace disconnect

      at Socket.<anonymous> (src/web-socket/index.ts:1221:15)

  console.log
    user undefined

      at Namespace.<anonymous> (src/web-socket/index.ts:1003:11)

  console.log
    user undefined

      at Namespace.<anonymous> (src/web-socket/index.ts:1003:11)

  console.log
    [SOCKET] [Provider] [Update] => Update provider {"newValues":{"uuid":"dqIGEqK3xAwgaksxAAAp","notifcationToken":"","status":"Online"},"searchKey":"userId","searchValue":1}

      at updateProvider (src/web-socket/index.ts:663:11)

  console.log
    [SOCKET - Broadcast online providers] Broadcasting online providers, Total Online Providers : 1

      at broadcastOnlineProvider (src/web-socket/index.ts:502:11)

  console.log
    [SOCKET] [Order] [Add] => Adding new Order {"newArgs":{"arrivalThreshold":2,"orderPaymentMethod":"Cash","orderSubmissionType":"provider-select","orderTimeoutSeconds":{"seconds":2,"dateAfterAddingSeconds":1756044231764},"customerUuid":"EPPjw9hdsVFdIx4tAAAo","orderId":123,"customerUserId":1,"customerNotificationToken":"123","providerUserId":1,"providerUuid":"dqIGEqK3xAwgaksxAAAp","orderStep":0}}

      at addOrder (src/web-socket/index.ts:712:11)

  console.log
    [SOCKET] [NEW-ORDER] Scheduling timeout job {
      orderId: 123,
      providerId: 1,
      timeoutSeconds: 2,
      timeoutDate: 2025-08-24T14:03:51.764Z,
      jobId: 'order-timeout-123'
    }

      at Socket.<anonymous> (src/web-socket/index.ts:1404:17)

  console.log
    [SOCKET] [ORDER-ACCEPT] Order found , OrderID : 123

      at Socket.<anonymous> (src/web-socket/index.ts:1635:17)

  console.log
    [SOCKET] [ORDER-ACCEPT] Cancelled regular timeout job { orderId: 123, regularTimeoutJobId: 'order-timeout-123' }

      at Socket.<anonymous> (src/web-socket/index.ts:1643:19)

  console.log
    [SOCKET] [Provider] [Update] => Update provider {"newValues":{"status":"Have order"},"searchKey":"uuid","searchValue":"dqIGEqK3xAwgaksxAAAp"}

      at updateProvider (src/web-socket/index.ts:663:11)

  console.log
    [SOCKET - Broadcast online providers] Broadcasting online providers, Total Online Providers : 0

      at broadcastOnlineProvider (src/web-socket/index.ts:502:11)

  console.log
    [SOCKET] [Order] [Update] => Update Order {"newValues":{"orderStep":1},"searchKey":"orderId","searchValue":123}

      at updateOrder (src/web-socket/index.ts:729:11)

  console.log
    [SOCKET] [ORDER-ACCEPT] Provider updated {
      provider: {
        latitude: 10,
        longitude: 10,
        notifcationToken: '',
        providerId: 1,
        status: 'Have order',
        userId: 1,
        uuid: 'dqIGEqK3xAwgaksxAAAp',
        moduleId: 1
      },
      updatedOrder: {
        arrivalThreshold: 2,
        orderPaymentMethod: 'Cash',
        orderSubmissionType: 'provider-select',
        orderTimeoutSeconds: { seconds: 2, dateAfterAddingSeconds: 1756044231764 },
        customerUuid: 'EPPjw9hdsVFdIx4tAAAo',
        orderId: 123,
        customerUserId: 1,
        customerNotificationToken: '123',
        providerUserId: 1,
        providerUuid: 'dqIGEqK3xAwgaksxAAAp',
        orderStep: 1
      }
    }

      at Socket.<anonymous> (src/web-socket/index.ts:1708:17)

  console.log
    [SOCKET] [ORDER-ACCEPT] Notifying customer about order acceptance { orderId: 123, providerId: 1, userId: 1, orderStep: 1 }

      at Socket.<anonymous> (src/web-socket/index.ts:1711:19)

  console.error
    System user not found. Please run database seeding.

    [0m [90m 402 |[39m
     [90m 403 |[39m     [36mif[39m ([33m![39msystemUser) {
    [31m[1m>[22m[39m[90m 404 |[39m       console[33m.[39merror([32m'System user not found. Please run database seeding.'[39m)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 405 |[39m
     [90m 406 |[39m       [90m// During tests, fall back to a synthetic system user to avoid failing the test suite[39m
     [90m 407 |[39m       [36mif[39m (process[33m.[39menv[33m.[39m[33mNODE_ENV[39m [33m===[39m [32m'test'[39m [33m||[39m process[33m.[39menv[33m.[39m[33mCI[39m [33m===[39m [32m'true'[39m) {[0m

      at sendSystemMessage (src/web-socket/chatSocket.ts:404:15)

  console.warn
    [TEST] Using fallback system user for sendSystemMessage

    [0m [90m 407 |[39m       [36mif[39m (process[33m.[39menv[33m.[39m[33mNODE_ENV[39m [33m===[39m [32m'test'[39m [33m||[39m process[33m.[39menv[33m.[39m[33mCI[39m [33m===[39m [32m'true'[39m) {
     [90m 408 |[39m         [36mconst[39m fallbackSystemUser[33m:[39m any [33m=[39m { id[33m:[39m [35m999999[39m[33m,[39m [33mFirstName[39m[33m:[39m [32m'System'[39m[33m,[39m [33mLastName[39m[33m:[39m [32m'Bot'[39m }[33m;[39m
    [31m[1m>[22m[39m[90m 409 |[39m         console[33m.[39mwarn([32m'[TEST] Using fallback system user for sendSystemMessage'[39m)[33m;[39m
     [90m     |[39m                 [31m[1m^[22m[39m
     [90m 410 |[39m         systemUser [33m=[39m fallbackSystemUser[33m;[39m
     [90m 411 |[39m       } [36melse[39m {
     [90m 412 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m([32m'System user not found'[39m)[33m;[39m[0m

      at sendSystemMessage (src/web-socket/chatSocket.ts:409:17)

  console.log
    [SOCKET - Broadcast online providers] Broadcasting online providers, Total Online Providers : 0

      at broadcastOnlineProvider (src/web-socket/index.ts:502:11)

  console.log
    [SOCKET] Socket disconnected: client namespace disconnect

      at Socket.<anonymous> (src/web-socket/index.ts:1221:15)

  console.log
    [SOCKET] Socket disconnected: client namespace disconnect

      at Socket.<anonymous> (src/web-socket/index.ts:1221:15)

  console.log
    user undefined

      at Namespace.<anonymous> (src/web-socket/index.ts:1003:11)

  console.log
    user undefined

      at Namespace.<anonymous> (src/web-socket/index.ts:1003:11)

  console.log
    [SOCKET] [PROVIDER-ONLINE-START] Checking active session {
      online: {
        latitude: 10,
        longitude: 10,
        notifcationToken: '',
        providerId: 1,
        status: 'Have order',
        userId: 1,
        uuid: 'dqIGEqK3xAwgaksxAAAp',
        moduleId: 1
      }
    }

      at Socket.<anonymous> (src/web-socket/index.ts:1258:21)

  console.log
    [SOCKET] Restoring active session [ORDER FOUND] {
      order: {
        arrivalThreshold: 2,
        orderPaymentMethod: 'Cash',
        orderSubmissionType: 'provider-select',
        orderTimeoutSeconds: { seconds: 2, dateAfterAddingSeconds: 1756044231764 },
        customerUuid: 'EPPjw9hdsVFdIx4tAAAo',
        orderId: 123,
        customerUserId: 1,
        customerNotificationToken: '123',
        providerUserId: 1,
        providerUuid: 'dqIGEqK3xAwgaksxAAAp',
        orderStep: 1
      },
      user: { id: 1, UserTypeName: 'Provider' },
      provider: {
        latitude: 10,
        longitude: 10,
        notifcationToken: '',
        providerId: 1,
        status: 'Have order',
        userId: 1,
        uuid: 'dqIGEqK3xAwgaksxAAAp',
        moduleId: 1
      }
    }

      at checkActiveSession (src/web-socket/index.ts:550:13)

  console.log
    [SOCKET] [ACTIVE-SESSION] Provider dqIGEqK3xAwgaksxAAAp is going offline. Since they are differnet

      at checkActiveSession (src/web-socket/index.ts:554:17)

  console.log
    [SOCKET] Restoring active session [UPDATE PROVIDER] {
      order: {
        arrivalThreshold: 2,
        orderPaymentMethod: 'Cash',
        orderSubmissionType: 'provider-select',
        orderTimeoutSeconds: { seconds: 2, dateAfterAddingSeconds: 1756044231764 },
        customerUuid: 'EPPjw9hdsVFdIx4tAAAo',
        orderId: 123,
        customerUserId: 1,
        customerNotificationToken: '123',
        providerUserId: 1,
        providerUuid: 'dqIGEqK3xAwgaksxAAAp',
        orderStep: 1
      },
      user: { id: 1, UserTypeName: 'Provider' },
      provider: {
        latitude: 10,
        longitude: 10,
        notifcationToken: '',
        providerId: 1,
        status: 'Have order',
        userId: 1,
        uuid: 'dqIGEqK3xAwgaksxAAAp',
        moduleId: 1
      }
    }

      at checkActiveSession (src/web-socket/index.ts:559:15)

  console.log
    [SOCKET] [Provider] [Update] => Update provider {"newValues":{"latitude":10,"longitude":10,"notifcationToken":"","providerId":1,"status":"Have order","userId":1,"uuid":"ts5tMECTatBypuBZAAAt","moduleId":1},"searchKey":"userId","searchValue":1}

      at updateProvider (src/web-socket/index.ts:663:11)

  console.log
    [SOCKET - Broadcast online providers] Broadcasting online providers, Total Online Providers : 0

      at broadcastOnlineProvider (src/web-socket/index.ts:502:11)

  console.log
    [SOCKET] [Order] [Update] => Update Order {"newValues":{"providerUuid":"ts5tMECTatBypuBZAAAt"},"searchKey":"orderId","searchValue":123}

      at updateOrder (src/web-socket/index.ts:729:11)

  console.log
    [SOCKET] [ORDER-ACCEPT] Order found , OrderID : 123

      at Socket.<anonymous> (src/web-socket/index.ts:1635:17)

  console.log
    [SOCKET] [ORDER-ACCEPT] Cancelled regular timeout job { orderId: 123, regularTimeoutJobId: 'order-timeout-123' }

      at Socket.<anonymous> (src/web-socket/index.ts:1643:19)

  console.log
    [SOCKET] [Provider] [Update] => Update provider {"newValues":{"status":"Have order"},"searchKey":"uuid","searchValue":"ts5tMECTatBypuBZAAAt"}

      at updateProvider (src/web-socket/index.ts:663:11)

  console.log
    [SOCKET - Broadcast online providers] Broadcasting online providers, Total Online Providers : 0

      at broadcastOnlineProvider (src/web-socket/index.ts:502:11)

  console.log
    [SOCKET] [Order] [Update] => Update Order {"newValues":{"orderStep":1},"searchKey":"orderId","searchValue":123}

      at updateOrder (src/web-socket/index.ts:729:11)

  console.log
    [SOCKET] [ORDER-ACCEPT] Provider updated {
      provider: {
        latitude: 10,
        longitude: 10,
        notifcationToken: '',
        providerId: 1,
        status: 'Have order',
        userId: 1,
        uuid: 'ts5tMECTatBypuBZAAAt',
        moduleId: 1
      },
      updatedOrder: {
        arrivalThreshold: 2,
        orderPaymentMethod: 'Cash',
        orderSubmissionType: 'provider-select',
        orderTimeoutSeconds: { seconds: 2, dateAfterAddingSeconds: 1756044231764 },
        customerUuid: 'EPPjw9hdsVFdIx4tAAAo',
        orderId: 123,
        customerUserId: 1,
        customerNotificationToken: '123',
        providerUserId: 1,
        providerUuid: 'ts5tMECTatBypuBZAAAt',
        orderStep: 1
      }
    }

      at Socket.<anonymous> (src/web-socket/index.ts:1708:17)

  console.log
    [SOCKET] [ORDER-ACCEPT] Notifying customer about order acceptance { orderId: 123, providerId: 1, userId: 1, orderStep: 1 }

      at Socket.<anonymous> (src/web-socket/index.ts:1711:19)

  console.error
    System user not found. Please run database seeding.

    [0m [90m 402 |[39m
     [90m 403 |[39m     [36mif[39m ([33m![39msystemUser) {
    [31m[1m>[22m[39m[90m 404 |[39m       console[33m.[39merror([32m'System user not found. Please run database seeding.'[39m)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 405 |[39m
     [90m 406 |[39m       [90m// During tests, fall back to a synthetic system user to avoid failing the test suite[39m
     [90m 407 |[39m       [36mif[39m (process[33m.[39menv[33m.[39m[33mNODE_ENV[39m [33m===[39m [32m'test'[39m [33m||[39m process[33m.[39menv[33m.[39m[33mCI[39m [33m===[39m [32m'true'[39m) {[0m

      at sendSystemMessage (src/web-socket/chatSocket.ts:404:15)

  console.warn
    [TEST] Using fallback system user for sendSystemMessage

    [0m [90m 407 |[39m       [36mif[39m (process[33m.[39menv[33m.[39m[33mNODE_ENV[39m [33m===[39m [32m'test'[39m [33m||[39m process[33m.[39menv[33m.[39m[33mCI[39m [33m===[39m [32m'true'[39m) {
     [90m 408 |[39m         [36mconst[39m fallbackSystemUser[33m:[39m any [33m=[39m { id[33m:[39m [35m999999[39m[33m,[39m [33mFirstName[39m[33m:[39m [32m'System'[39m[33m,[39m [33mLastName[39m[33m:[39m [32m'Bot'[39m }[33m;[39m
    [31m[1m>[22m[39m[90m 409 |[39m         console[33m.[39mwarn([32m'[TEST] Using fallback system user for sendSystemMessage'[39m)[33m;[39m
     [90m     |[39m                 [31m[1m^[22m[39m
     [90m 410 |[39m         systemUser [33m=[39m fallbackSystemUser[33m;[39m
     [90m 411 |[39m       } [36melse[39m {
     [90m 412 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m([32m'System user not found'[39m)[33m;[39m[0m

      at sendSystemMessage (src/web-socket/chatSocket.ts:409:17)

  console.log
    [SOCKET] Customer rejected in progress order { args: { orderId: 123, providerId: 1 } }

      at Socket.<anonymous> (src/web-socket/index.ts:1826:15)

  console.log
    [SOCKET] [Order] [Remove] => Remove Order {"searchKey":"orderId","searchValue":123}

      at removeOrder (src/web-socket/index.ts:747:11)

  console.log
    [SOCKET] Order found  123

      at Socket.<anonymous> (src/web-socket/index.ts:1834:17)

  console.log
    [SOCKET] [Provider] [Update] => Update provider {"newValues":{"status":"Online"},"searchKey":"providerId","searchValue":1}

      at updateProvider (src/web-socket/index.ts:663:11)

  console.log
    [SOCKET - Broadcast online providers] Broadcasting online providers, Total Online Providers : 1

      at broadcastOnlineProvider (src/web-socket/index.ts:502:11)

  console.log
    [SOCKET] Notifying provider about order removal {
      provider: {
        latitude: 10,
        longitude: 10,
        notifcationToken: '',
        providerId: 1,
        status: 'Online',
        userId: 1,
        uuid: 'ts5tMECTatBypuBZAAAt',
        moduleId: 1
      },
      order: {
        arrivalThreshold: 2,
        orderPaymentMethod: 'Cash',
        orderSubmissionType: 'provider-select',
        orderTimeoutSeconds: { seconds: 2, dateAfterAddingSeconds: 1756044231764 },
        customerUuid: 'EPPjw9hdsVFdIx4tAAAo',
        orderId: 123,
        customerUserId: 1,
        customerNotificationToken: '123',
        providerUserId: 1,
        providerUuid: 'ts5tMECTatBypuBZAAAt',
        orderStep: 1
      }
    }

      at Socket.<anonymous> (src/web-socket/index.ts:1863:19)


  ‚óè  Cannot log after tests are done. Did you forget to wait for something async in your test?
    Attempted to log "[SOCKET] Socket disconnected: client namespace disconnect".

    [0m [90m 1219 |[39m         userId[33m:[39m socket[33m.[39mdata[33m?[39m[33m.[39muserInfo[33m?[39m[33m.[39mid [33m||[39m userId[33m,[39m
     [90m 1220 |[39m       })[33m;[39m
    [31m[1m>[22m[39m[90m 1221 |[39m       console[33m.[39mlog([32m'[SOCKET] Socket disconnected:'[39m[33m,[39m reason)[33m;[39m
     [90m      |[39m               [31m[1m^[22m[39m
     [90m 1222 |[39m     })[33m;[39m
     [90m 1223 |[39m
     [90m 1224 |[39m     [90m// socket.on('connect', () => {[39m[0m

      at console.log (node_modules/@jest/console/build/CustomConsole.js:141:10)
      at Socket.<anonymous> (src/web-socket/index.ts:1221:15)
      at Socket.emitReserved (node_modules/socket.io/dist/typed-events.js:56:22)
      at Socket._onclose (node_modules/socket.io/dist/socket.js:554:14)
      at Socket.ondisconnect (node_modules/socket.io/dist/socket.js:513:14)
      at Socket._onpacket (node_modules/socket.io/dist/socket.js:442:22)
      at node_modules/socket.io/dist/client.js:214:24


  ‚óè  Cannot log after tests are done. Did you forget to wait for something async in your test?
    Attempted to log "[SOCKET] Socket disconnected: client namespace disconnect".

    [0m [90m 1219 |[39m         userId[33m:[39m socket[33m.[39mdata[33m?[39m[33m.[39muserInfo[33m?[39m[33m.[39mid [33m||[39m userId[33m,[39m
     [90m 1220 |[39m       })[33m;[39m
    [31m[1m>[22m[39m[90m 1221 |[39m       console[33m.[39mlog([32m'[SOCKET] Socket disconnected:'[39m[33m,[39m reason)[33m;[39m
     [90m      |[39m               [31m[1m^[22m[39m
     [90m 1222 |[39m     })[33m;[39m
     [90m 1223 |[39m
     [90m 1224 |[39m     [90m// socket.on('connect', () => {[39m[0m

      at console.log (node_modules/@jest/console/build/CustomConsole.js:141:10)
      at Socket.<anonymous> (src/web-socket/index.ts:1221:15)
      at Socket.emitReserved (node_modules/socket.io/dist/typed-events.js:56:22)
      at Socket._onclose (node_modules/socket.io/dist/socket.js:554:14)
      at Socket.ondisconnect (node_modules/socket.io/dist/socket.js:513:14)
      at Socket._onpacket (node_modules/socket.io/dist/socket.js:442:22)
      at node_modules/socket.io/dist/client.js:214:24

FAIL src/web-socket/index.spec.ts (50.891 s)
  web-socket/index.ts [Socket logic]
    ‚àö Should fail because authentication failed (84 ms)
    ‚àö [Provider-online] Should pass and make provider online (36 ms)
    ‚àö [Provider-online] Should fail because no id or provider id (74 ms)
    √ó [Provider-online] get all online providers (20051 ms)
    ‚àö [Provider-offline] remove provider from online users (551 ms)
    ‚àö [New-order] should pass and create order (552 ms)
    ‚àö [New-order] should return order timeout because no right provider passed (542 ms)
    ‚àö [New-order] should set active order to provider when accepting order (5053 ms)
    ‚àö [New-order] should remove order when rejected (5059 ms)
    ‚àö [New-order] should remove the provider from online user when accepting order (2049 ms)
    ‚àö [New-order] should remove order and set provider online when customer reject in progress order (6049 ms)

  ‚óè web-socket/index.ts [Socket logic] ‚Ä∫ [Provider-online] get all online providers

    expect(received).toEqual(expected) // deep equality

    Expected: 0
    Received: 1

    [0m [90m 247 |[39m     [90m// Broadcast online user[39m
     [90m 248 |[39m     socketClientCustomer[33m.[39mon([32m'online-users'[39m[33m,[39m (online) [33m=>[39m {
    [31m[1m>[22m[39m[90m 249 |[39m       expect(online[33m.[39mlength)[33m.[39mtoEqual([35m0[39m)[33m;[39m
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 250 |[39m       done()[33m;[39m
     [90m 251 |[39m     })[33m;[39m
     [90m 252 |[39m     socketClientCustomer[33m.[39memit([32m'all-online-providers'[39m[33m,[39m [35m1[39m)[33m;[39m[0m

      at Socket.<anonymous> (src/web-socket/index.spec.ts:249:29)
      at Socket.Object.<anonymous>.Emitter.emit (node_modules/@socket.io/component-emitter/lib/cjs/index.js:143:20)
      at Socket.emitEvent (node_modules/socket.io-client/build/cjs/socket.js:559:20)
      at Socket.onevent (node_modules/socket.io-client/build/cjs/socket.js:546:18)
      at Socket.onpacket (node_modules/socket.io-client/build/cjs/socket.js:514:22)
      at Manager.Object.<anonymous>.Emitter.emit (node_modules/@socket.io/component-emitter/lib/cjs/index.js:143:20)
      at node_modules/socket.io-client/build/cjs/manager.js:246:18

  ‚óè web-socket/index.ts [Socket logic] ‚Ä∫ [Provider-online] get all online providers

    thrown: "Exceeded timeout of 20000 ms for a test while waiting for `done()` to be called.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 243 |[39m   })[33m;[39m
     [90m 244 |[39m
    [31m[1m>[22m[39m[90m 245 |[39m   it([32m'[Provider-online] get all online providers'[39m[33m,[39m (done) [33m=>[39m {
     [90m     |[39m   [31m[1m^[22m[39m
     [90m 246 |[39m     console[33m.[39mlog([32m'Start 4'[39m)[33m;[39m
     [90m 247 |[39m     [90m// Broadcast online user[39m
     [90m 248 |[39m     socketClientCustomer[33m.[39mon([32m'online-users'[39m[33m,[39m (online) [33m=>[39m {[0m

      at src/web-socket/index.spec.ts:245:3
      at Object.<anonymous> (src/web-socket/index.spec.ts:94:1)

A worker process has failed to exit gracefully and has been force exited. This is likely caused by tests leaking due to improper teardown. Try running with --detectOpenHandles to find leaks. Active timers can also cause this, ensure that .unref() was called on them.
Summary of all failing tests
FAIL src/config/environment.spec.ts (9.514 s)
  ‚óè config/environment.ts ‚Ä∫ Should success if all process env values are present

    expect(received).not.toThrowError()

    Error name:    "ValidationError"
    Error message: "FIREBASE_PRIVATE_KEY is a required field"

        [0m [90m 14 |[39m     })[33m;[39m
         [90m 15 |[39m     [36mconst[39m func [33m=[39m () [33m=>[39m {
        [31m[1m>[22m[39m[90m 16 |[39m       schema[33m.[39mvalidateSync(env)[33m;[39m
         [90m    |[39m              [31m[1m^[22m[39m
         [90m 17 |[39m     }[33m;[39m
         [90m 18 |[39m
         [90m 19 |[39m     expect(func)[33m.[39mnot[33m.[39mtoThrowError()[33m;[39m[0m

      at createError (node_modules/yup/lib/util/createValidation.js:54:21)
      at validate (node_modules/yup/lib/util/createValidation.js:96:83)
      at runTests (node_modules/yup/lib/util/runTests.js:39:5)
      at node_modules/yup/lib/schema.js:255:29
      at node_modules/yup/lib/util/runTests.js:17:5
      at finishTestRun (node_modules/yup/lib/util/runTests.js:67:9)
      at validate (node_modules/yup/lib/util/createValidation.js:96:103)
      at runTests (node_modules/yup/lib/util/runTests.js:39:5)
      at StringSchema._validate (node_modules/yup/lib/schema.js:246:27)
      at StringSchema.validate (node_modules/yup/lib/schema.js:271:51)
      at node_modules/yup/lib/object.js:182:17
      at runTests (node_modules/yup/lib/util/runTests.js:39:5)
      at node_modules/yup/lib/object.js:199:29
      at node_modules/yup/lib/util/runTests.js:17:5
      at finishTestRun (node_modules/yup/lib/util/runTests.js:67:9)
      at validate (node_modules/yup/lib/util/createValidation.js:96:103)
      at runTests (node_modules/yup/lib/util/runTests.js:39:5)
      at node_modules/yup/lib/schema.js:255:29
      at node_modules/yup/lib/util/runTests.js:17:5
      at finishTestRun (node_modules/yup/lib/util/runTests.js:67:9)
      at validate (node_modules/yup/lib/util/createValidation.js:96:103)
      at runTests (node_modules/yup/lib/util/runTests.js:39:5)
      at ObjectSchema._validate (node_modules/yup/lib/schema.js:246:27)
      at ObjectSchema._validate (node_modules/yup/lib/object.js:161:11)
      at ObjectSchema.validateSync (node_modules/yup/lib/schema.js:282:12)
      at func (src/config/environment.spec.ts:16:14)
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrowError] (node_modules/expect/build/index.js:320:21)
      at Object.<anonymous> (src/config/environment.spec.ts:19:22)
      at Object.<anonymous> (src/config/environment.spec.ts:19:22)

FAIL src/controllers/orders/confirmOrder.controller.spec.ts
  ‚óè users/confirmOrder ‚Ä∫ Should return addresses

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

    [0m [90m  8 |[39m     [36mawait[39m confirmOrder(global[33m.[39mmockReq[33m,[39m global[33m.[39mmockRes[33m,[39m global[33m.[39mmockNext)[33m;[39m
     [90m  9 |[39m
    [31m[1m>[22m[39m[90m 10 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledTimes([35m1[39m)[33m;[39m
     [90m    |[39m                                   [31m[1m^[22m[39m
     [90m 11 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledWith(
     [90m 12 |[39m       global[33m.[39mmockReq[33m,[39m
     [90m 13 |[39m       global[33m.[39mmockRes[33m,[39m[0m

      at Object.<anonymous> (src/controllers/orders/confirmOrder.controller.spec.ts:10:35)

FAIL src/tests/web-socket/socketConnection.spec.ts
  ‚óè Test suite failed to run

    Your test suite must contain at least one test.

      at onResult (node_modules/@jest/core/build/TestScheduler.js:133:18)
      at node_modules/@jest/core/build/TestScheduler.js:254:19
      at node_modules/emittery/index.js:363:13
          at Array.map (<anonymous>)
      at Emittery.emit (node_modules/emittery/index.js:361:23)

FAIL src/tests/web-socket/orderChat.spec.ts
  ‚óè Test suite failed to run

    Your test suite must contain at least one test.

      at onResult (node_modules/@jest/core/build/TestScheduler.js:133:18)
      at node_modules/@jest/core/build/TestScheduler.js:254:19
      at node_modules/emittery/index.js:363:13
          at Array.map (<anonymous>)
      at Emittery.emit (node_modules/emittery/index.js:361:23)

FAIL src/controllers/users/verifyEmailOtp.controller.spec.ts
  ‚óè Test suite failed to run

    Your test suite must contain at least one test.

      at onResult (node_modules/@jest/core/build/TestScheduler.js:133:18)
      at node_modules/@jest/core/build/TestScheduler.js:254:19
      at node_modules/emittery/index.js:363:13
          at Array.map (<anonymous>)
      at Emittery.emit (node_modules/emittery/index.js:361:23)

FAIL src/tests/web-socket/chatBasic.spec.ts
  ‚óè Test suite failed to run

    Your test suite must contain at least one test.

      at onResult (node_modules/@jest/core/build/TestScheduler.js:133:18)
      at node_modules/@jest/core/build/TestScheduler.js:254:19
      at node_modules/emittery/index.js:363:13
          at Array.map (<anonymous>)
      at Emittery.emit (node_modules/emittery/index.js:361:23)

FAIL src/controllers/users/sendEmailOtp.controller.spec.ts
  ‚óè Test suite failed to run

    Your test suite must contain at least one test.

      at onResult (node_modules/@jest/core/build/TestScheduler.js:133:18)
      at node_modules/@jest/core/build/TestScheduler.js:254:19
      at node_modules/emittery/index.js:363:13
          at Array.map (<anonymous>)
      at Emittery.emit (node_modules/emittery/index.js:361:23)

FAIL src/controllers/orders/getProviderRevenue.controller.spec.ts
  ‚óè Test suite failed to run

    Your test suite must contain at least one test.

      at onResult (node_modules/@jest/core/build/TestScheduler.js:133:18)
      at node_modules/@jest/core/build/TestScheduler.js:254:19
      at node_modules/emittery/index.js:363:13
          at Array.map (<anonymous>)
      at Emittery.emit (node_modules/emittery/index.js:361:23)

FAIL src/controllers/services/getAllServices.controller.spec.ts
  ‚óè services/getAllServices ‚Ä∫ Should succeed and return all modules

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

    [0m [90m 12 |[39m     [36mawait[39m getAllServices(global[33m.[39mmockReq[33m,[39m global[33m.[39mmockRes[33m,[39m global[33m.[39mmockNext)[33m;[39m
     [90m 13 |[39m
    [31m[1m>[22m[39m[90m 14 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledTimes([35m1[39m)[33m;[39m
     [90m    |[39m                                   [31m[1m^[22m[39m
     [90m 15 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledWith(
     [90m 16 |[39m       global[33m.[39mmockReq[33m,[39m
     [90m 17 |[39m       global[33m.[39mmockRes[33m,[39m[0m

      at Object.<anonymous> (src/controllers/services/getAllServices.controller.spec.ts:14:35)

FAIL src/controllers/users/updatePassword.controller.spec.ts (9.936 s)
  ‚óè Update Password Controller ‚Ä∫ should successfully update password with valid data

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: {"select": {"Email": true, "id": true, "isActive": true}, "where": {"Email": "test@example.com"}}

    Number of calls: 0

    [0m [90m 34 |[39m     [36mawait[39m updatePassword(global[33m.[39mmockReq[33m,[39m global[33m.[39mmockRes[33m,[39m global[33m.[39mmockNext)[33m;[39m
     [90m 35 |[39m
    [31m[1m>[22m[39m[90m 36 |[39m     expect(prismaMock[33m.[39musers[33m.[39mfindUnique)[33m.[39mtoHaveBeenCalledWith({
     [90m    |[39m                                         [31m[1m^[22m[39m
     [90m 37 |[39m       where[33m:[39m { [33mEmail[39m[33m:[39m [32m'test@example.com'[39m }[33m,[39m
     [90m 38 |[39m       select[33m:[39m {
     [90m 39 |[39m         id[33m:[39m [36mtrue[39m[33m,[39m[0m

      at Object.<anonymous> (src/controllers/users/updatePassword.controller.spec.ts:36:41)

  ‚óè Update Password Controller ‚Ä∫ should throw error when user not found

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

      {"_addBody": [Function _addBody], "_events": {}, "_eventsCount": 0, "_maxListeners": undefined, "_setBaseUrl": [Function _setBaseUrl], "_setBody": [Function _setBody], "_setCookiesVariable": [Function _setCookiesVariable], "_setFilesVariable": [Function _setFilesVariable], "_setHeadersVariable": [Function _setHeadersVariable], "_setMethod": [Function _setMethod], "_setOriginalUrl": [Function _setOriginalUrl], "_setParameter": [Function _setParameter], "_setSessionVariable": [Function _setSessionVariable], "_setSignedCookiesVariable": [Function _setSignedCookiesVariable], "_setURL": [Function _setURL], "accepts": [Function acceptsTypes], "acceptsCharsets": [Function acceptsCharsets], "acceptsEncodings": [Function acceptsEncodings], "acceptsLanguages": [Function acceptsLanguages], "baseUrl": "", "body": {"email": "test@example.com", "newPassword": "newpassword123", "otp": "123456"}, "cookies": {}, "destroy": [Function anonymous], "files": {}, "get": [Function getHeader], "getHeader": [Function getHeader], "header": [Function getHeader], "headers": {"req_id": "test-request-id"}, "hostname": "", "ip": "127.0.0.1", "ips": ["127.0.0.1"], "is": [Function isContentType], "logger": {"error": [Function mockConstructor], "info": [Function mockConstructor], "warn": [Function mockConstructor]}, "method": "GET", "originalUrl": "", "param": [Function param], "params": {}, "path": "", "prisma": undefined, "query": {}, "range": [Function isRange], "send": [Function send], "socket": {}, "subdomains": [], "url": "", "user": {}, Symbol(shapeMode): false, Symbol(kCapture): false, Symbol(Symbol.asyncIterator): [Function asyncIterator]},
      {"_getBuffer": [Function _getBuffer], "_getChunks": [Function _getChunks], "_getData": [Function _getData], "_getHeaders": [Function _getHeaders], "_getJSONData": [Function _getJSONData], "_getLocals": [Function _getLocals], "_getRedirectUrl": [Function _getRedirectUrl], "_getRenderData": [Function _getRenderData], "_getRenderView": [Function _getRenderView], "_getStatusCode": [Function _getStatusCode], "_getStatusMessage": [Function _getStatusMessage], "_headers": {}, "_isDataLengthValid": [Function _isDataLengthValid], "_isEndCalled": [Function _isEndCalled], "_isJSON": [Function _isJSON], "_isUTF8": [Function _isUTF8], "append": [Function append], "appendHeader": [Function appendHeader], "attachment": [Function attachment], "clearCookie": [Function clearCookie], "contentType": [Function contentType], "cookie": [Function cookie], "cookies": {}, "destroy": [Function destroy], "destroySoon": [Function destroySoon], "end": [Function end], "finished": false, "format": [Function format], "get": [Function getHeader], "getEncoding": [Function getEncoding], "getHeader": [Function getHeader], "getHeaderNames": [Function getHeaderNames], "getHeaders": [Function getHeaders], "hasHeader": [Function hasHeader], "header": [Function header], "headersSent": false, "json": [Function json], "jsonp": [Function jsonp], "locals": {}, "location": [Function setLocation], "redirect": [Function redirect], "removeHeader": [Function removeHeader], "render": [Function render], "send": [Function send], "sendStatus": [Function sendStatus], "set": [Function header], "setEncoding": [Function setEncoding], "setHeader": [Function setHeader], "status": [Function status], "statusCode": 200, "statusMessage": "OK", "type": [Function contentType], "vary": [Function vary], "writableEnded": false, "writableFinished": false, "write": [Function write], "writeHead": [Function writeHead]},
    - [Error: Invalid username or password],
    + [Error: Invalid OTP],
      [Function mockConstructor],

    Number of calls: 1

    [0m [90m 70 |[39m     [36mawait[39m updatePassword(global[33m.[39mmockReq[33m,[39m global[33m.[39mmockRes[33m,[39m global[33m.[39mmockNext)[33m;[39m
     [90m 71 |[39m
    [31m[1m>[22m[39m[90m 72 |[39m     expect(createFailResponse)[33m.[39mtoHaveBeenCalledWith(
     [90m    |[39m                                [31m[1m^[22m[39m
     [90m 73 |[39m       global[33m.[39mmockReq[33m,[39m
     [90m 74 |[39m       global[33m.[39mmockRes[33m,[39m
     [90m 75 |[39m       [36mnew[39m [33mHttpException[39m([33mHTTPResponses[39m[33m.[39m[33mBusinessError[39m[33m,[39m [33mHTTPErrorMessages[39m[33m.[39m[33mInvalidUsernameOrPassowrd[39m[33m,[39m [32m'User not found'[39m)[33m,[39m[0m

      at Object.<anonymous> (src/controllers/users/updatePassword.controller.spec.ts:72:32)

  ‚óè Update Password Controller ‚Ä∫ should throw error when user is inactive

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

      {"_addBody": [Function _addBody], "_events": {}, "_eventsCount": 0, "_maxListeners": undefined, "_setBaseUrl": [Function _setBaseUrl], "_setBody": [Function _setBody], "_setCookiesVariable": [Function _setCookiesVariable], "_setFilesVariable": [Function _setFilesVariable], "_setHeadersVariable": [Function _setHeadersVariable], "_setMethod": [Function _setMethod], "_setOriginalUrl": [Function _setOriginalUrl], "_setParameter": [Function _setParameter], "_setSessionVariable": [Function _setSessionVariable], "_setSignedCookiesVariable": [Function _setSignedCookiesVariable], "_setURL": [Function _setURL], "accepts": [Function acceptsTypes], "acceptsCharsets": [Function acceptsCharsets], "acceptsEncodings": [Function acceptsEncodings], "acceptsLanguages": [Function acceptsLanguages], "baseUrl": "", "body": {"email": "test@example.com", "newPassword": "newpassword123", "otp": "123456"}, "cookies": {}, "destroy": [Function anonymous], "files": {}, "get": [Function getHeader], "getHeader": [Function getHeader], "header": [Function getHeader], "headers": {"req_id": "test-request-id"}, "hostname": "", "ip": "127.0.0.1", "ips": ["127.0.0.1"], "is": [Function isContentType], "logger": {"error": [Function mockConstructor], "info": [Function mockConstructor], "warn": [Function mockConstructor]}, "method": "GET", "originalUrl": "", "param": [Function param], "params": {}, "path": "", "prisma": undefined, "query": {}, "range": [Function isRange], "send": [Function send], "socket": {}, "subdomains": [], "url": "", "user": {}, Symbol(shapeMode): false, Symbol(kCapture): false, Symbol(Symbol.asyncIterator): [Function asyncIterator]},
      {"_getBuffer": [Function _getBuffer], "_getChunks": [Function _getChunks], "_getData": [Function _getData], "_getHeaders": [Function _getHeaders], "_getJSONData": [Function _getJSONData], "_getLocals": [Function _getLocals], "_getRedirectUrl": [Function _getRedirectUrl], "_getRenderData": [Function _getRenderData], "_getRenderView": [Function _getRenderView], "_getStatusCode": [Function _getStatusCode], "_getStatusMessage": [Function _getStatusMessage], "_headers": {}, "_isDataLengthValid": [Function _isDataLengthValid], "_isEndCalled": [Function _isEndCalled], "_isJSON": [Function _isJSON], "_isUTF8": [Function _isUTF8], "append": [Function append], "appendHeader": [Function appendHeader], "attachment": [Function attachment], "clearCookie": [Function clearCookie], "contentType": [Function contentType], "cookie": [Function cookie], "cookies": {}, "destroy": [Function destroy], "destroySoon": [Function destroySoon], "end": [Function end], "finished": false, "format": [Function format], "get": [Function getHeader], "getEncoding": [Function getEncoding], "getHeader": [Function getHeader], "getHeaderNames": [Function getHeaderNames], "getHeaders": [Function getHeaders], "hasHeader": [Function hasHeader], "header": [Function header], "headersSent": false, "json": [Function json], "jsonp": [Function jsonp], "locals": {}, "location": [Function setLocation], "redirect": [Function redirect], "removeHeader": [Function removeHeader], "render": [Function render], "send": [Function send], "sendStatus": [Function sendStatus], "set": [Function header], "setEncoding": [Function setEncoding], "setHeader": [Function setHeader], "status": [Function status], "statusCode": 200, "statusMessage": "OK", "type": [Function contentType], "vary": [Function vary], "writableEnded": false, "writableFinished": false, "write": [Function write], "writeHead": [Function writeHead]},
    - [Error: Your account is still inactive/under processing],
    + [Error: Invalid OTP],
      [Function mockConstructor],

    Number of calls: 1

    [0m [90m 90 |[39m     [36mawait[39m updatePassword(global[33m.[39mmockReq[33m,[39m global[33m.[39mmockRes[33m,[39m global[33m.[39mmockNext)[33m;[39m
     [90m 91 |[39m
    [31m[1m>[22m[39m[90m 92 |[39m     expect(createFailResponse)[33m.[39mtoHaveBeenCalledWith(
     [90m    |[39m                                [31m[1m^[22m[39m
     [90m 93 |[39m       global[33m.[39mmockReq[33m,[39m
     [90m 94 |[39m       global[33m.[39mmockRes[33m,[39m
     [90m 95 |[39m       [36mnew[39m [33mHttpException[39m([33mHTTPResponses[39m[33m.[39m[33mBusinessError[39m[33m,[39m [33mHTTPErrorMessages[39m[33m.[39m[33mAccountInactive[39m[33m,[39m {[0m

      at Object.<anonymous> (src/controllers/users/updatePassword.controller.spec.ts:92:32)

FAIL src/controllers/orders/getOrderTotalAmountStatements.controller.spec.ts (10.014 s)
  ‚óè orders/getOrderTotalAmount ‚Ä∫ Should success and return the order

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

    [0m [90m 42 |[39m     [36mawait[39m getOrderTotalAmountStatements(global[33m.[39mmockReq[33m,[39m global[33m.[39mmockRes[33m,[39m global[33m.[39mmockNext)[33m;[39m
     [90m 43 |[39m
    [31m[1m>[22m[39m[90m 44 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledTimes([35m1[39m)[33m;[39m
     [90m    |[39m                                   [31m[1m^[22m[39m
     [90m 45 |[39m
     [90m 46 |[39m     [90m//@ts-ignore[39m
     [90m 47 |[39m     [36mconst[39m returnResult [33m=[39m createSuccessResponse[33m.[39mmock[33m.[39mcalls[[35m0[39m][[35m2[39m][33m;[39m[0m

      at Object.<anonymous> (src/controllers/orders/getOrderTotalAmountStatements.controller.spec.ts:44:35)

FAIL src/controllers/orders/getOneOrder.controller.spec.ts (10.07 s)
  ‚óè orders/getOneOrder ‚Ä∫ Should success and return the order

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

    [0m [90m 16 |[39m     [36mawait[39m getOneOrder(global[33m.[39mmockReq[33m,[39m global[33m.[39mmockRes[33m,[39m global[33m.[39mmockNext)[33m;[39m
     [90m 17 |[39m
    [31m[1m>[22m[39m[90m 18 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledTimes([35m1[39m)[33m;[39m
     [90m    |[39m                                   [31m[1m^[22m[39m
     [90m 19 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledWith(global[33m.[39mmockReq[33m,[39m global[33m.[39mmockRes[33m,[39m { 
     [90m 20 |[39m       id[33m:[39m [35m111[39m[33m,[39m
     [90m 21 |[39m       paymentMethods[33m:[39m {[0m

      at Object.<anonymous> (src/controllers/orders/getOneOrder.controller.spec.ts:18:35)

  ‚óè orders/getOneOrder ‚Ä∫ Should fail because no order

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

    [0m [90m 32 |[39m     [36mawait[39m getOneOrder(global[33m.[39mmockReq[33m,[39m global[33m.[39mmockRes[33m,[39m global[33m.[39mmockNext)[33m;[39m
     [90m 33 |[39m
    [31m[1m>[22m[39m[90m 34 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledTimes([35m1[39m)[33m;[39m
     [90m    |[39m                                   [31m[1m^[22m[39m
     [90m 35 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledWith(global[33m.[39mmockReq[33m,[39m global[33m.[39mmockRes[33m,[39m {}[33m,[39m global[33m.[39mmockNext)[33m;[39m
     [90m 36 |[39m   })[33m;[39m
     [90m 37 |[39m })[33m;[39m[0m

      at Object.<anonymous> (src/controllers/orders/getOneOrder.controller.spec.ts:34:35)

FAIL src/controllers/orders/addOrder.controller.spec.ts (10.056 s)
  ‚óè orders/addOrder ‚Ä∫ Should succeed

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

    [0m [90m 35 |[39m     [36mawait[39m addOrder(global[33m.[39mmockReq[33m,[39m global[33m.[39mmockRes[33m,[39m global[33m.[39mmockNext)[33m;[39m
     [90m 36 |[39m
    [31m[1m>[22m[39m[90m 37 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledTimes([35m1[39m)[33m;[39m
     [90m    |[39m                                   [31m[1m^[22m[39m
     [90m 38 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledWith(
     [90m 39 |[39m       global[33m.[39mmockReq[33m,[39m
     [90m 40 |[39m       global[33m.[39mmockRes[33m,[39m[0m

      at Object.<anonymous> (src/controllers/orders/addOrder.controller.spec.ts:37:35)

FAIL src/controllers/users/register.controller.spec.ts
  ‚óè users/register ‚Ä∫ Should success

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

      {"_addBody": [Function _addBody], "_events": {}, "_eventsCount": 0, "_maxListeners": undefined, "_setBaseUrl": [Function _setBaseUrl], "_setBody": [Function _setBody], "_setCookiesVariable": [Function _setCookiesVariable], "_setFilesVariable": [Function _setFilesVariable], "_setHeadersVariable": [Function _setHeadersVariable], "_setMethod": [Function _setMethod], "_setOriginalUrl": [Function _setOriginalUrl], "_setParameter": [Function _setParameter], "_setSessionVariable": [Function _setSessionVariable], "_setSignedCookiesVariable": [Function _setSignedCookiesVariable], "_setURL": [Function _setURL], "accepts": [Function acceptsTypes], "acceptsCharsets": [Function acceptsCharsets], "acceptsEncodings": [Function acceptsEncodings], "acceptsLanguages": [Function acceptsLanguages], "baseUrl": "", "body": {"Password": "Test", "UserTypeName": "Test"}, "cookies": {}, "destroy": [Function anonymous], "files": {}, "get": [Function getHeader], "getHeader": [Function getHeader], "header": [Function getHeader], "headers": {}, "hostname": "", "ip": "127.0.0.1", "ips": ["127.0.0.1"], "is": [Function isContentType], "logger": {"error": [Function mockConstructor], "info": [Function mockConstructor], "warn": [Function mockConstructor]}, "method": "GET", "originalUrl": "", "param": [Function param], "params": {}, "path": "", "prisma": undefined, "query": {}, "range": [Function isRange], "send": [Function send], "socket": {}, "subdomains": [], "url": "", "user": {}, Symbol(shapeMode): false, Symbol(kCapture): false, Symbol(Symbol.asyncIterator): [Function asyncIterator]},
      {"_getBuffer": [Function _getBuffer], "_getChunks": [Function _getChunks], "_getData": [Function _getData], "_getHeaders": [Function _getHeaders], "_getJSONData": [Function _getJSONData], "_getLocals": [Function _getLocals], "_getRedirectUrl": [Function _getRedirectUrl], "_getRenderData": [Function _getRenderData], "_getRenderView": [Function _getRenderView], "_getStatusCode": [Function _getStatusCode], "_getStatusMessage": [Function _getStatusMessage], "_headers": {}, "_isDataLengthValid": [Function _isDataLengthValid], "_isEndCalled": [Function _isEndCalled], "_isJSON": [Function _isJSON], "_isUTF8": [Function _isUTF8], "append": [Function append], "appendHeader": [Function appendHeader], "attachment": [Function attachment], "clearCookie": [Function clearCookie], "contentType": [Function contentType], "cookie": [Function cookie], "cookies": {}, "destroy": [Function destroy], "destroySoon": [Function destroySoon], "end": [Function end], "finished": false, "format": [Function format], "get": [Function getHeader], "getEncoding": [Function getEncoding], "getHeader": [Function getHeader], "getHeaderNames": [Function getHeaderNames], "getHeaders": [Function getHeaders], "hasHeader": [Function hasHeader], "header": [Function header], "headersSent": false, "json": [Function json], "jsonp": [Function jsonp], "locals": {}, "location": [Function setLocation], "redirect": [Function redirect], "removeHeader": [Function removeHeader], "render": [Function render], "send": [Function send], "sendStatus": [Function sendStatus], "set": [Function header], "setEncoding": [Function setEncoding], "setHeader": [Function setHeader], "status": [Function status], "statusCode": 200, "statusMessage": "OK", "type": [Function contentType], "vary": [Function vary], "writableEnded": false, "writableFinished": false, "write": [Function write], "writeHead": [Function writeHead]},
      Object {
    +   "emailSent": false,
        "id": 1,
        "result": true,
      },
      [Function mockConstructor],

    Number of calls: 1

    [0m [90m 10 |[39m
     [90m 11 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledTimes([35m1[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 12 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledWith(
     [90m    |[39m                                   [31m[1m^[22m[39m
     [90m 13 |[39m       global[33m.[39mmockReq[33m,[39m
     [90m 14 |[39m       global[33m.[39mmockRes[33m,[39m
     [90m 15 |[39m       { result[33m:[39m [36mtrue[39m[33m,[39m id[33m:[39m [35m1[39m }[33m,[39m[0m

      at Object.<anonymous> (src/controllers/users/register.controller.spec.ts:12:35)

FAIL src/web-socket/index.functions.spec.ts (10.7 s)
  ‚óè web-socket/index.ts [Socket functions] ‚Ä∫ [broadcastOnlineProviders] Should pass and send online providers to all online users

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "online-users", Anything

    Number of calls: 0

    [0m [90m 32 |[39m   it([32m'[broadcastOnlineProviders] Should pass and send online providers to all online users'[39m[33m,[39m () [33m=>[39m {
     [90m 33 |[39m     socketFunctions[33m.[39mbroadcastOnlineProvider(mockSocket [36mas[39m any)[33m;[39m
    [31m[1m>[22m[39m[90m 34 |[39m     expect(mockSocket[33m.[39mbroadcast[33m.[39memit)[33m.[39mtoHaveBeenCalledWith([32m'online-users'[39m[33m,[39m expect[33m.[39manything())[33m;[39m
     [90m    |[39m                                       [31m[1m^[22m[39m
     [90m 35 |[39m     expect(mockSocket[33m.[39memit)[33m.[39mtoHaveBeenCalledWith([32m'online-users'[39m[33m,[39m expect[33m.[39manything())[33m;[39m
     [90m 36 |[39m   })[33m;[39m
     [90m 37 |[39m })[33m;[39m[0m

      at Object.<anonymous> (src/web-socket/index.functions.spec.ts:34:39)

FAIL src/controllers/users/login.controller.spec.ts (11.222 s)
  ‚óè users/login ‚Ä∫ Should return fail because allowed clients is not right

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

      {"_addBody": [Function _addBody], "_events": {}, "_eventsCount": 0, "_maxListeners": undefined, "_setBaseUrl": [Function _setBaseUrl], "_setBody": [Function _setBody], "_setCookiesVariable": [Function _setCookiesVariable], "_setFilesVariable": [Function _setFilesVariable], "_setHeadersVariable": [Function _setHeadersVariable], "_setMethod": [Function _setMethod], "_setOriginalUrl": [Function _setOriginalUrl], "_setParameter": [Function _setParameter], "_setSessionVariable": [Function _setSessionVariable], "_setSignedCookiesVariable": [Function _setSignedCookiesVariable], "_setURL": [Function _setURL], "accepts": [Function acceptsTypes], "acceptsCharsets": [Function acceptsCharsets], "acceptsEncodings": [Function acceptsEncodings], "acceptsLanguages": [Function acceptsLanguages], "baseUrl": "", "body": {"email": "1", "password": "1"}, "cookies": {}, "destroy": [Function anonymous], "files": {}, "get": [Function getHeader], "getHeader": [Function getHeader], "header": [Function getHeader], "headers": {"allowed-client": "U2FsdGVkX19IZh4q3/l4XjfAcws56BixpCn9h9ri66U="}, "hostname": "", "ip": "127.0.0.1", "ips": ["127.0.0.1"], "is": [Function isContentType], "logger": {"error": [Function mockConstructor], "info": [Function mockConstructor], "warn": [Function mockConstructor]}, "method": "GET", "originalUrl": "", "param": [Function param], "params": {}, "path": "", "prisma": undefined, "query": {}, "range": [Function isRange], "send": [Function send], "socket": {}, "subdomains": [], "url": "", "user": {}, Symbol(shapeMode): false, Symbol(kCapture): false, Symbol(Symbol.asyncIterator): [Function asyncIterator]},
      {"_getBuffer": [Function _getBuffer], "_getChunks": [Function _getChunks], "_getData": [Function _getData], "_getHeaders": [Function _getHeaders], "_getJSONData": [Function _getJSONData], "_getLocals": [Function _getLocals], "_getRedirectUrl": [Function _getRedirectUrl], "_getRenderData": [Function _getRenderData], "_getRenderView": [Function _getRenderView], "_getStatusCode": [Function _getStatusCode], "_getStatusMessage": [Function _getStatusMessage], "_headers": {}, "_isDataLengthValid": [Function _isDataLengthValid], "_isEndCalled": [Function _isEndCalled], "_isJSON": [Function _isJSON], "_isUTF8": [Function _isUTF8], "append": [Function append], "appendHeader": [Function appendHeader], "attachment": [Function attachment], "clearCookie": [Function clearCookie], "contentType": [Function contentType], "cookie": [Function cookie], "cookies": {}, "destroy": [Function destroy], "destroySoon": [Function destroySoon], "end": [Function end], "finished": false, "format": [Function format], "get": [Function getHeader], "getEncoding": [Function getEncoding], "getHeader": [Function getHeader], "getHeaderNames": [Function getHeaderNames], "getHeaders": [Function getHeaders], "hasHeader": [Function hasHeader], "header": [Function header], "headersSent": false, "json": [Function json], "jsonp": [Function jsonp], "locals": {}, "location": [Function setLocation], "redirect": [Function redirect], "removeHeader": [Function removeHeader], "render": [Function render], "send": [Function send], "sendStatus": [Function sendStatus], "set": [Function header], "setEncoding": [Function setEncoding], "setHeader": [Function setHeader], "status": [Function status], "statusCode": 200, "statusMessage": "OK", "type": [Function contentType], "vary": [Function vary], "writableEnded": false, "writableFinished": false, "write": [Function write], "writeHead": [Function writeHead]},
    - [Error: No sufficient permission],
    + [Error: Email not verified],
      [Function mockConstructor],

    Number of calls: 1

    [0m [90m 75 |[39m
     [90m 76 |[39m     expect(createFailResponse)[33m.[39mtoHaveBeenCalledTimes([35m1[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 77 |[39m     expect(createFailResponse)[33m.[39mtoHaveBeenCalledWith(
     [90m    |[39m                                [31m[1m^[22m[39m
     [90m 78 |[39m       global[33m.[39mmockReq[33m,[39m
     [90m 79 |[39m       global[33m.[39mmockRes[33m,[39m
     [90m 80 |[39m[0m

      at Object.<anonymous> (src/controllers/users/login.controller.spec.ts:77:32)

  ‚óè users/login ‚Ä∫ Should succeed

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

    [0m [90m 105 |[39m     [36mawait[39m login(global[33m.[39mmockReq[33m,[39m global[33m.[39mmockRes[33m,[39m global[33m.[39mmockNext)[33m;[39m
     [90m 106 |[39m
    [31m[1m>[22m[39m[90m 107 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledTimes([35m1[39m)[33m;[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 108 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledWith(
     [90m 109 |[39m       global[33m.[39mmockReq[33m,[39m
     [90m 110 |[39m       global[33m.[39mmockRes[33m,[39m[0m

      at Object.<anonymous> (src/controllers/users/login.controller.spec.ts:107:35)

  ‚óè users/login ‚Ä∫ Should succeed and return isUserActive as atrue

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

    [0m [90m 135 |[39m     [36mawait[39m login(global[33m.[39mmockReq[33m,[39m global[33m.[39mmockRes[33m,[39m global[33m.[39mmockNext)[33m;[39m
     [90m 136 |[39m
    [31m[1m>[22m[39m[90m 137 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledTimes([35m1[39m)[33m;[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 138 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledWith(
     [90m 139 |[39m       global[33m.[39mmockReq[33m,[39m
     [90m 140 |[39m       global[33m.[39mmockRes[33m,[39m[0m

      at Object.<anonymous> (src/controllers/users/login.controller.spec.ts:137:35)

  ‚óè users/login ‚Ä∫ Should succeed and return isUserActive as true and document fullfilled true

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

    [0m [90m 169 |[39m     [36mawait[39m login(global[33m.[39mmockReq[33m,[39m global[33m.[39mmockRes[33m,[39m global[33m.[39mmockNext)[33m;[39m
     [90m 170 |[39m     [32m``[39m[33m;[39m
    [31m[1m>[22m[39m[90m 171 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledTimes([35m1[39m)[33m;[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 172 |[39m     expect(createSuccessResponse)[33m.[39mtoHaveBeenCalledWith(
     [90m 173 |[39m       global[33m.[39mmockReq[33m,[39m
     [90m 174 |[39m       global[33m.[39mmockRes[33m,[39m[0m

      at Object.<anonymous> (src/controllers/users/login.controller.spec.ts:171:35)

FAIL src/web-socket/index.spec.ts (50.891 s)
  ‚óè web-socket/index.ts [Socket logic] ‚Ä∫ [Provider-online] get all online providers

    expect(received).toEqual(expected) // deep equality

    Expected: 0
    Received: 1

    [0m [90m 247 |[39m     [90m// Broadcast online user[39m
     [90m 248 |[39m     socketClientCustomer[33m.[39mon([32m'online-users'[39m[33m,[39m (online) [33m=>[39m {
    [31m[1m>[22m[39m[90m 249 |[39m       expect(online[33m.[39mlength)[33m.[39mtoEqual([35m0[39m)[33m;[39m
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 250 |[39m       done()[33m;[39m
     [90m 251 |[39m     })[33m;[39m
     [90m 252 |[39m     socketClientCustomer[33m.[39memit([32m'all-online-providers'[39m[33m,[39m [35m1[39m)[33m;[39m[0m

      at Socket.<anonymous> (src/web-socket/index.spec.ts:249:29)
      at Socket.Object.<anonymous>.Emitter.emit (node_modules/@socket.io/component-emitter/lib/cjs/index.js:143:20)
      at Socket.emitEvent (node_modules/socket.io-client/build/cjs/socket.js:559:20)
      at Socket.onevent (node_modules/socket.io-client/build/cjs/socket.js:546:18)
      at Socket.onpacket (node_modules/socket.io-client/build/cjs/socket.js:514:22)
      at Manager.Object.<anonymous>.Emitter.emit (node_modules/@socket.io/component-emitter/lib/cjs/index.js:143:20)
      at node_modules/socket.io-client/build/cjs/manager.js:246:18

  ‚óè web-socket/index.ts [Socket logic] ‚Ä∫ [Provider-online] get all online providers

    thrown: "Exceeded timeout of 20000 ms for a test while waiting for `done()` to be called.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 243 |[39m   })[33m;[39m
     [90m 244 |[39m
    [31m[1m>[22m[39m[90m 245 |[39m   it([32m'[Provider-online] get all online providers'[39m[33m,[39m (done) [33m=>[39m {
     [90m     |[39m   [31m[1m^[22m[39m
     [90m 246 |[39m     console[33m.[39mlog([32m'Start 4'[39m)[33m;[39m
     [90m 247 |[39m     [90m// Broadcast online user[39m
     [90m 248 |[39m     socketClientCustomer[33m.[39mon([32m'online-users'[39m[33m,[39m (online) [33m=>[39m {[0m

      at src/web-socket/index.spec.ts:245:3
      at Object.<anonymous> (src/web-socket/index.spec.ts:94:1)


Test Suites: 17 failed, 37 passed, 54 total
Tests:       17 failed, 114 passed, 131 total
Snapshots:   0 total
Time:        51.922 s
Ran all test suites.
Force exiting Jest: Have you considered using `--detectOpenHandles` to detect async operations that kept running after all tests finished?
